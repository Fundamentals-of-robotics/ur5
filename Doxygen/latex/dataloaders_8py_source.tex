\doxysection{dataloaders.\+py}
\hypertarget{dataloaders_8py_source}{}\label{dataloaders_8py_source}\index{C:/Users/dorij/OneDrive/Desktop/ur5/vision/yolo/utils/dataloaders.py@{C:/Users/dorij/OneDrive/Desktop/ur5/vision/yolo/utils/dataloaders.py}}
\mbox{\hyperlink{dataloaders_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00001}\mbox{\hyperlink{namespaceutils_1_1dataloaders}{00001}}\ \textcolor{comment}{\#\ YOLOv5\ 🚀\ by\ Ultralytics,\ AGPL-\/3.0\ license}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00002}00002\ \textcolor{stringliteral}{"{}"{}"{}Dataloaders\ and\ dataset\ utils."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00004}00004\ \textcolor{keyword}{import}\ contextlib}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00005}00005\ \textcolor{keyword}{import}\ glob}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00006}00006\ \textcolor{keyword}{import}\ hashlib}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00007}00007\ \textcolor{keyword}{import}\ json}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00008}00008\ \textcolor{keyword}{import}\ math}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00009}00009\ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00010}00010\ \textcolor{keyword}{import}\ random}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00011}00011\ \textcolor{keyword}{import}\ shutil}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00012}00012\ \textcolor{keyword}{import}\ time}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00013}00013\ \textcolor{keyword}{from}\ itertools\ \textcolor{keyword}{import}\ repeat}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00014}00014\ \textcolor{keyword}{from}\ multiprocessing.pool\ \textcolor{keyword}{import}\ Pool,\ ThreadPool}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00015}00015\ \textcolor{keyword}{from}\ pathlib\ \textcolor{keyword}{import}\ Path}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00016}00016\ \textcolor{keyword}{from}\ threading\ \textcolor{keyword}{import}\ Thread}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00017}00017\ \textcolor{keyword}{from}\ urllib.parse\ \textcolor{keyword}{import}\ urlparse}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00019}00019\ \textcolor{keyword}{import}\ numpy\ \textcolor{keyword}{as}\ np}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00020}00020\ \textcolor{keyword}{import}\ psutil}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00021}00021\ \textcolor{keyword}{import}\ torch}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00022}00022\ \textcolor{keyword}{import}\ torch.nn.functional\ \textcolor{keyword}{as}\ F}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00023}00023\ \textcolor{keyword}{import}\ torchvision}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00024}00024\ \textcolor{keyword}{import}\ yaml}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00025}00025\ \textcolor{keyword}{from}\ PIL\ \textcolor{keyword}{import}\ ExifTags,\ Image,\ ImageOps}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00026}00026\ \textcolor{keyword}{from}\ torch.utils.data\ \textcolor{keyword}{import}\ DataLoader,\ Dataset,\ dataloader,\ distributed}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00027}00027\ \textcolor{keyword}{from}\ tqdm\ \textcolor{keyword}{import}\ tqdm}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00029}00029\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceutils_1_1augmentations}{utils.augmentations}}\ \textcolor{keyword}{import}\ (}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00030}00030\ \ \ \ \ Albumentations,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00031}00031\ \ \ \ \ augment\_hsv,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00032}00032\ \ \ \ \ classify\_albumentations,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00033}00033\ \ \ \ \ classify\_transforms,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00034}00034\ \ \ \ \ copy\_paste,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00035}00035\ \ \ \ \ letterbox,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00036}00036\ \ \ \ \ mixup,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00037}00037\ \ \ \ \ random\_perspective,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00038}00038\ )}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00039}00039\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceutils_1_1general}{utils.general}}\ \textcolor{keyword}{import}\ (}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00040}00040\ \ \ \ \ DATASETS\_DIR,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00041}00041\ \ \ \ \ LOGGER,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00042}00042\ \ \ \ \ NUM\_THREADS,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00043}00043\ \ \ \ \ TQDM\_BAR\_FORMAT,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00044}00044\ \ \ \ \ check\_dataset,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00045}00045\ \ \ \ \ check\_requirements,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00046}00046\ \ \ \ \ check\_yaml,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00047}00047\ \ \ \ \ clean\_str,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00048}00048\ \ \ \ \ cv2,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00049}00049\ \ \ \ \ is\_colab,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00050}00050\ \ \ \ \ is\_kaggle,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00051}00051\ \ \ \ \ segments2boxes,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00052}00052\ \ \ \ \ unzip\_file,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00053}00053\ \ \ \ \ xyn2xy,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00054}00054\ \ \ \ \ xywh2xyxy,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00055}00055\ \ \ \ \ xywhn2xyxy,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00056}00056\ \ \ \ \ xyxy2xywhn,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00057}00057\ )}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00058}00058\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceutils_1_1torch__utils}{utils.torch\_utils}}\ \textcolor{keyword}{import}\ torch\_distributed\_zero\_first}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00060}00060\ \textcolor{comment}{\#\ Parameters}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00061}\mbox{\hyperlink{namespaceutils_1_1dataloaders_a76e968ffeb2a34459334cabbe6398f49}{00061}}\ HELP\_URL\ =\ \textcolor{stringliteral}{"{}See\ https://docs.ultralytics.com/yolov5/tutorials/train\_custom\_data"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00062}\mbox{\hyperlink{namespaceutils_1_1dataloaders_a6acfaffc64df638399f94571364a9b18}{00062}}\ IMG\_FORMATS\ =\ \textcolor{stringliteral}{"{}bmp"{}},\ \textcolor{stringliteral}{"{}dng"{}},\ \textcolor{stringliteral}{"{}jpeg"{}},\ \textcolor{stringliteral}{"{}jpg"{}},\ \textcolor{stringliteral}{"{}mpo"{}},\ \textcolor{stringliteral}{"{}png"{}},\ \textcolor{stringliteral}{"{}tif"{}},\ \textcolor{stringliteral}{"{}tiff"{}},\ \textcolor{stringliteral}{"{}webp"{}},\ \textcolor{stringliteral}{"{}pfm"{}}\ \ \textcolor{comment}{\#\ include\ image\ suffixes}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00063}\mbox{\hyperlink{namespaceutils_1_1dataloaders_aac23467e6cef2723bd11999244a053a5}{00063}}\ VID\_FORMATS\ =\ \textcolor{stringliteral}{"{}asf"{}},\ \textcolor{stringliteral}{"{}avi"{}},\ \textcolor{stringliteral}{"{}gif"{}},\ \textcolor{stringliteral}{"{}m4v"{}},\ \textcolor{stringliteral}{"{}mkv"{}},\ \textcolor{stringliteral}{"{}mov"{}},\ \textcolor{stringliteral}{"{}mp4"{}},\ \textcolor{stringliteral}{"{}mpeg"{}},\ \textcolor{stringliteral}{"{}mpg"{}},\ \textcolor{stringliteral}{"{}ts"{}},\ \textcolor{stringliteral}{"{}wmv"{}}\ \ \textcolor{comment}{\#\ include\ video\ suffixes}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00064}\mbox{\hyperlink{namespaceutils_1_1dataloaders_aeeca508603811db48e02cceaa25c8ac2}{00064}}\ LOCAL\_RANK\ =\ int(os.getenv(\textcolor{stringliteral}{"{}LOCAL\_RANK"{}},\ -\/1))\ \ \textcolor{comment}{\#\ https://pytorch.org/docs/stable/elastic/run.html}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00065}\mbox{\hyperlink{namespaceutils_1_1dataloaders_a40c7b24e4d43d768cc17b711eb7e8aea}{00065}}\ RANK\ =\ int(os.getenv(\textcolor{stringliteral}{"{}RANK"{}},\ -\/1))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00066}\mbox{\hyperlink{namespaceutils_1_1dataloaders_ab36bf2f08141111d0205a73ea38b9971}{00066}}\ WORLD\_SIZE\ =\ int(os.getenv(\textcolor{stringliteral}{"{}WORLD\_SIZE"{}},\ 1))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00067}\mbox{\hyperlink{namespaceutils_1_1dataloaders_a1a750bb6de07858417bb2a0692014a50}{00067}}\ PIN\_MEMORY\ =\ str(os.getenv(\textcolor{stringliteral}{"{}PIN\_MEMORY"{}},\ \textcolor{keyword}{True})).lower()\ ==\ \textcolor{stringliteral}{"{}true"{}}\ \ \textcolor{comment}{\#\ global\ pin\_memory\ for\ dataloaders}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00068}00068\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00069}00069\ \textcolor{comment}{\#\ Get\ orientation\ exif\ tag}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00070}00070\ \textcolor{keywordflow}{for}\ orientation\ \textcolor{keywordflow}{in}\ ExifTags.TAGS.keys():}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00071}00071\ \ \ \ \ \textcolor{keywordflow}{if}\ ExifTags.TAGS[orientation]\ ==\ \textcolor{stringliteral}{"{}Orientation"{}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00072}00072\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00073}00073\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00074}00074\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00075}\mbox{\hyperlink{namespaceutils_1_1dataloaders_a040e2e64822c6005809f7923a69f9df6}{00075}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceutils_1_1dataloaders_a040e2e64822c6005809f7923a69f9df6}{get\_hash}}(paths):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00076}00076\ \ \ \ \ \textcolor{comment}{\#\ Returns\ a\ single\ hash\ value\ of\ a\ list\ of\ paths\ (files\ or\ dirs)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00077}00077\ \ \ \ \ size\ =\ sum(os.path.getsize(p)\ \textcolor{keywordflow}{for}\ p\ \textcolor{keywordflow}{in}\ paths\ \textcolor{keywordflow}{if}\ os.path.exists(p))\ \ \textcolor{comment}{\#\ sizes}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00078}00078\ \ \ \ \ h\ =\ hashlib.sha256(str(size).encode())\ \ \textcolor{comment}{\#\ hash\ sizes}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00079}00079\ \ \ \ \ h.update(\textcolor{stringliteral}{"{}"{}}.join(paths).encode())\ \ \textcolor{comment}{\#\ hash\ paths}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00080}00080\ \ \ \ \ \textcolor{keywordflow}{return}\ h.hexdigest()\ \ \textcolor{comment}{\#\ return\ hash}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00081}00081\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00082}00082\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00083}\mbox{\hyperlink{namespaceutils_1_1dataloaders_ade261da3ecb2c5b735ec54bbf44c8272}{00083}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceutils_1_1dataloaders_ade261da3ecb2c5b735ec54bbf44c8272}{exif\_size}}(img):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00084}00084\ \ \ \ \ \textcolor{comment}{\#\ Returns\ exif-\/corrected\ PIL\ size}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00085}00085\ \ \ \ \ s\ =\ img.size\ \ \textcolor{comment}{\#\ (width,\ height)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00086}00086\ \ \ \ \ \textcolor{keyword}{with}\ contextlib.suppress(Exception):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00087}00087\ \ \ \ \ \ \ \ \ rotation\ =\ dict(img.\_getexif().items())[orientation]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00088}00088\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ rotation\ \textcolor{keywordflow}{in}\ [6,\ 8]:\ \ \textcolor{comment}{\#\ rotation\ 270\ or\ 90}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ s\ =\ (s[1],\ s[0])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00090}00090\ \ \ \ \ \textcolor{keywordflow}{return}\ s}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00091}00091\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00092}00092\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00093}\mbox{\hyperlink{namespaceutils_1_1dataloaders_a8f7e5e1057932e74cb53b21366c7fe7a}{00093}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceutils_1_1dataloaders_a8f7e5e1057932e74cb53b21366c7fe7a}{exif\_transpose}}(image):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00094}00094\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00095}00095\ \textcolor{stringliteral}{\ \ \ \ Transpose\ a\ PIL\ image\ accordingly\ if\ it\ has\ an\ EXIF\ Orientation\ tag.}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00096}00096\ \textcolor{stringliteral}{\ \ \ \ Inplace\ version\ of\ https://github.com/python-\/pillow/Pillow/blob/master/src/PIL/ImageOps.py\ exif\_transpose()}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00097}00097\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00098}00098\ \textcolor{stringliteral}{\ \ \ \ :param\ image:\ The\ image\ to\ transpose.}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00099}00099\ \textcolor{stringliteral}{\ \ \ \ :return:\ An\ image.}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00100}00100\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00101}00101\ \ \ \ \ exif\ =\ image.getexif()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00102}00102\ \ \ \ \ orientation\ =\ exif.get(0x0112,\ 1)\ \ \textcolor{comment}{\#\ default\ 1}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00103}00103\ \ \ \ \ \textcolor{keywordflow}{if}\ orientation\ >\ 1:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00104}00104\ \ \ \ \ \ \ \ \ method\ =\ \{}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00105}00105\ \ \ \ \ \ \ \ \ \ \ \ \ 2:\ Image.FLIP\_LEFT\_RIGHT,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00106}00106\ \ \ \ \ \ \ \ \ \ \ \ \ 3:\ Image.ROTATE\_180,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00107}00107\ \ \ \ \ \ \ \ \ \ \ \ \ 4:\ Image.FLIP\_TOP\_BOTTOM,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00108}00108\ \ \ \ \ \ \ \ \ \ \ \ \ 5:\ Image.TRANSPOSE,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00109}00109\ \ \ \ \ \ \ \ \ \ \ \ \ 6:\ Image.ROTATE\_270,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ 7:\ Image.TRANSVERSE,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \ \ \ 8:\ Image.ROTATE\_90,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00112}00112\ \ \ \ \ \ \ \ \ \}.get(orientation)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00113}00113\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ method\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \ \ \ image\ =\ image.transpose(method)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00115}00115\ \ \ \ \ \ \ \ \ \ \ \ \ del\ exif[0x0112]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00116}00116\ \ \ \ \ \ \ \ \ \ \ \ \ image.info[\textcolor{stringliteral}{"{}exif"{}}]\ =\ exif.tobytes()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00117}00117\ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00118}00118\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00119}00119\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00120}\mbox{\hyperlink{namespaceutils_1_1dataloaders_adfbf8914f42064b736671168ee028a46}{00120}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceutils_1_1dataloaders_adfbf8914f42064b736671168ee028a46}{seed\_worker}}(worker\_id):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00121}00121\ \ \ \ \ \textcolor{comment}{\#\ Set\ dataloader\ worker\ seed\ https://pytorch.org/docs/stable/notes/randomness.html\#dataloader}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00122}00122\ \ \ \ \ worker\_seed\ =\ torch.initial\_seed()\ \%\ 2**32}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00123}00123\ \ \ \ \ np.random.seed(worker\_seed)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00124}00124\ \ \ \ \ random.seed(worker\_seed)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00125}00125\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00126}00126\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00127}00127\ \textcolor{comment}{\#\ Inherit\ from\ DistributedSampler\ and\ override\ iterator}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00128}00128\ \textcolor{comment}{\#\ https://github.com/pytorch/pytorch/blob/master/torch/utils/data/distributed.py}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00129}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_smart_distributed_sampler}{00129}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_smart_distributed_sampler}{SmartDistributedSampler}}(distributed.DistributedSampler):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00130}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_smart_distributed_sampler_add2eafcd1dfe7c5ac3bd03f533752238}{00130}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_smart_distributed_sampler_add2eafcd1dfe7c5ac3bd03f533752238}{\_\_iter\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00131}00131\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ deterministically\ shuffle\ based\ on\ epoch\ and\ seed}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00132}00132\ \ \ \ \ \ \ \ \ g\ =\ torch.Generator()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00133}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_smart_distributed_sampler_a1e50189ea4fa79695983bf30d8018c35}{00133}}\ \ \ \ \ \ \ \ \ g.manual\_seed(self.seed\ +\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_smart_distributed_sampler_a1e50189ea4fa79695983bf30d8018c35}{epoch}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00134}00134\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00135}00135\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ determine\ the\ the\ eventual\ size\ (n)\ of\ self.indices\ (DDP\ indices)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00136}00136\ \ \ \ \ \ \ \ \ n\ =\ int((len(self.dataset)\ -\/\ self.rank\ -\/\ 1)\ /\ self.num\_replicas)\ +\ 1\ \ \textcolor{comment}{\#\ num\_replicas\ ==\ WORLD\_SIZE}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00137}00137\ \ \ \ \ \ \ \ \ idx\ =\ torch.randperm(n,\ generator=g)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ self.shuffle:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00139}00139\ \ \ \ \ \ \ \ \ \ \ \ \ idx\ =\ idx.sort()[0]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00140}00140\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00141}00141\ \ \ \ \ \ \ \ \ idx\ =\ idx.tolist()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00142}00142\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.drop\_last:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00143}00143\ \ \ \ \ \ \ \ \ \ \ \ \ idx\ =\ idx[:\ self.num\_samples]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00144}00144\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00145}00145\ \ \ \ \ \ \ \ \ \ \ \ \ padding\_size\ =\ self.num\_samples\ -\/\ len(idx)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00146}00146\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ padding\_size\ <=\ len(idx):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00147}00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idx\ +=\ idx[:padding\_size]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00148}00148\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ idx\ +=\ (idx\ *\ math.ceil(padding\_size\ /\ len(idx)))[:padding\_size]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00150}00150\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00151}00151\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ iter(idx)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00152}00152\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00153}00153\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00154}\mbox{\hyperlink{namespaceutils_1_1dataloaders_a3ad607bbbe46da322b8a78479e5c9d8e}{00154}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceutils_1_1dataloaders_a3ad607bbbe46da322b8a78479e5c9d8e}{create\_dataloader}}(}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00155}00155\ \ \ \ \ path,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00156}00156\ \ \ \ \ imgsz,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00157}00157\ \ \ \ \ batch\_size,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00158}00158\ \ \ \ \ stride,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00159}00159\ \ \ \ \ single\_cls=False,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00160}00160\ \ \ \ \ hyp=None,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00161}00161\ \ \ \ \ augment=False,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00162}00162\ \ \ \ \ cache=False,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00163}00163\ \ \ \ \ pad=0.0,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00164}00164\ \ \ \ \ rect=False,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00165}00165\ \ \ \ \ rank=-\/1,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00166}00166\ \ \ \ \ workers=8,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00167}00167\ \ \ \ \ image\_weights=False,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00168}00168\ \ \ \ \ quad=False,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00169}00169\ \ \ \ \ prefix="{}"{},}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00170}00170\ \ \ \ \ shuffle=False,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00171}00171\ \ \ \ \ seed=0,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00172}00172\ ):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00173}00173\ \ \ \ \ \textcolor{keywordflow}{if}\ rect\ \textcolor{keywordflow}{and}\ shuffle:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00174}00174\ \ \ \ \ \ \ \ \ LOGGER.warning(\textcolor{stringliteral}{"{}WARNING\ ⚠️\ -\/-\/rect\ is\ incompatible\ with\ DataLoader\ shuffle,\ setting\ shuffle=False"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00175}00175\ \ \ \ \ \ \ \ \ shuffle\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00176}00176\ \ \ \ \ \textcolor{keyword}{with}\ torch\_distributed\_zero\_first(rank):\ \ \textcolor{comment}{\#\ init\ dataset\ *.cache\ only\ once\ if\ DDP}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00177}00177\ \ \ \ \ \ \ \ \ dataset\ =\ \mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels}{LoadImagesAndLabels}}(}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \ \ \ path,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00179}00179\ \ \ \ \ \ \ \ \ \ \ \ \ imgsz,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00180}00180\ \ \ \ \ \ \ \ \ \ \ \ \ batch\_size,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \ \ \ augment=augment,\ \ \textcolor{comment}{\#\ augmentation}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00182}00182\ \ \ \ \ \ \ \ \ \ \ \ \ hyp=hyp,\ \ \textcolor{comment}{\#\ hyperparameters}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00183}00183\ \ \ \ \ \ \ \ \ \ \ \ \ rect=rect,\ \ \textcolor{comment}{\#\ rectangular\ batches}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00184}00184\ \ \ \ \ \ \ \ \ \ \ \ \ cache\_images=cache,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00185}00185\ \ \ \ \ \ \ \ \ \ \ \ \ single\_cls=single\_cls,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00186}00186\ \ \ \ \ \ \ \ \ \ \ \ \ stride=int(stride),}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00187}00187\ \ \ \ \ \ \ \ \ \ \ \ \ pad=pad,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00188}00188\ \ \ \ \ \ \ \ \ \ \ \ \ image\_weights=image\_weights,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00189}00189\ \ \ \ \ \ \ \ \ \ \ \ \ prefix=prefix,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00190}00190\ \ \ \ \ \ \ \ \ \ \ \ \ rank=rank,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00191}00191\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00193}00193\ \ \ \ \ batch\_size\ =\ min(batch\_size,\ len(dataset))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00194}00194\ \ \ \ \ nd\ =\ torch.cuda.device\_count()\ \ \textcolor{comment}{\#\ number\ of\ CUDA\ devices}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00195}00195\ \ \ \ \ nw\ =\ min([os.cpu\_count()\ //\ max(nd,\ 1),\ batch\_size\ \textcolor{keywordflow}{if}\ batch\_size\ >\ 1\ \textcolor{keywordflow}{else}\ 0,\ workers])\ \ \textcolor{comment}{\#\ number\ of\ workers}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00196}00196\ \ \ \ \ sampler\ =\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{if}\ rank\ ==\ -\/1\ \textcolor{keywordflow}{else}\ \mbox{\hyperlink{classutils_1_1dataloaders_1_1_smart_distributed_sampler}{SmartDistributedSampler}}(dataset,\ shuffle=shuffle)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00197}00197\ \ \ \ \ loader\ =\ DataLoader\ \textcolor{keywordflow}{if}\ image\_weights\ \textcolor{keywordflow}{else}\ InfiniteDataLoader\ \ \textcolor{comment}{\#\ only\ DataLoader\ allows\ for\ attribute\ updates}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00198}00198\ \ \ \ \ generator\ =\ torch.Generator()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00199}00199\ \ \ \ \ generator.manual\_seed(6148914691236517205\ +\ seed\ +\ RANK)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00200}00200\ \ \ \ \ \textcolor{keywordflow}{return}\ loader(}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00201}00201\ \ \ \ \ \ \ \ \ dataset,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00202}00202\ \ \ \ \ \ \ \ \ batch\_size=batch\_size,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00203}00203\ \ \ \ \ \ \ \ \ shuffle=shuffle\ \textcolor{keywordflow}{and}\ sampler\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None},}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00204}00204\ \ \ \ \ \ \ \ \ num\_workers=nw,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00205}00205\ \ \ \ \ \ \ \ \ sampler=sampler,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00206}00206\ \ \ \ \ \ \ \ \ pin\_memory=PIN\_MEMORY,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00207}00207\ \ \ \ \ \ \ \ \ collate\_fn=LoadImagesAndLabels.collate\_fn4\ \textcolor{keywordflow}{if}\ quad\ \textcolor{keywordflow}{else}\ LoadImagesAndLabels.collate\_fn,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00208}00208\ \ \ \ \ \ \ \ \ worker\_init\_fn=seed\_worker,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00209}00209\ \ \ \ \ \ \ \ \ generator=generator,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00210}00210\ \ \ \ \ ),\ dataset}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00211}00211\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00212}00212\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00213}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader}{00213}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader}{InfiniteDataLoader}}(dataloader.DataLoader):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00214}00214\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00215}00215\ \textcolor{stringliteral}{\ \ \ \ Dataloader\ that\ reuses\ workers.}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00216}00216\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00217}00217\ \textcolor{stringliteral}{\ \ \ \ Uses\ same\ syntax\ as\ vanilla\ DataLoader}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00218}00218\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00219}00219\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00220}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_a964c2d3658c5056c5236b8bda6aee4c4}{00220}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_a964c2d3658c5056c5236b8bda6aee4c4}{\_\_init\_\_}}(self,\ *args,\ **kwargs):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00221}00221\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_a964c2d3658c5056c5236b8bda6aee4c4}{\_\_init\_\_}}(*args,\ **kwargs)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00222}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_a2a0b4a60de66bb7ac384a8a4e3347d49}{00222}}\ \ \ \ \ \ \ \ \ object.\_\_setattr\_\_(self,\ \textcolor{stringliteral}{"{}batch\_sampler"{}},\ \mbox{\hyperlink{classutils_1_1dataloaders_1_1___repeat_sampler}{\_RepeatSampler}}(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_a2a0b4a60de66bb7ac384a8a4e3347d49}{batch\_sampler}}))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00223}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_a5b32ae158687f465b81b1118a79a8322}{00223}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_a5b32ae158687f465b81b1118a79a8322}{iterator}}\ =\ super().\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_a855a6b0055da54890a9b697c756e013f}{\_\_iter\_\_}}()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00224}00224\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00225}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_ae66b82212d0fc16fa8c5505f16b434d4}{00225}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_ae66b82212d0fc16fa8c5505f16b434d4}{\_\_len\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00226}00226\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ len(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_a2a0b4a60de66bb7ac384a8a4e3347d49}{batch\_sampler}}.sampler)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00227}00227\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00228}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_a855a6b0055da54890a9b697c756e013f}{00228}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_a855a6b0055da54890a9b697c756e013f}{\_\_iter\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00229}00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ \_\ \textcolor{keywordflow}{in}\ range(len(self)):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00230}00230\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ next(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader_a5b32ae158687f465b81b1118a79a8322}{iterator}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00231}00231\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00232}00232\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00233}\mbox{\hyperlink{classutils_1_1dataloaders_1_1___repeat_sampler}{00233}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1___repeat_sampler}{\_RepeatSampler}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00234}00234\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00235}00235\ \textcolor{stringliteral}{\ \ \ \ Sampler\ that\ repeats\ forever.}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00236}00236\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00237}00237\ \textcolor{stringliteral}{\ \ \ \ Args:}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00238}00238\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ sampler\ (Sampler)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00239}00239\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00240}00240\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00241}\mbox{\hyperlink{classutils_1_1dataloaders_1_1___repeat_sampler_ae7355141ba7fd604bf4389bb72fb76cb}{00241}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1___repeat_sampler_ae7355141ba7fd604bf4389bb72fb76cb}{\_\_init\_\_}}(self,\ sampler):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00242}\mbox{\hyperlink{classutils_1_1dataloaders_1_1___repeat_sampler_a08e381eae435720e8f35a279edc67974}{00242}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1___repeat_sampler_a08e381eae435720e8f35a279edc67974}{sampler}}\ =\ sampler}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00243}00243\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00244}\mbox{\hyperlink{classutils_1_1dataloaders_1_1___repeat_sampler_ada07a4c4de164aa3487bd96ae07d78c7}{00244}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1___repeat_sampler_ada07a4c4de164aa3487bd96ae07d78c7}{\_\_iter\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00245}00245\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ \textcolor{keyword}{True}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00246}00246\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ \textcolor{keyword}{from}\ iter(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1___repeat_sampler_a08e381eae435720e8f35a279edc67974}{sampler}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00247}00247\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00248}00248\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00249}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots}{00249}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots}{LoadScreenshots}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00250}00250\ \ \ \ \ \textcolor{comment}{\#\ YOLOv5\ screenshot\ dataloader,\ i.e.\ \`{}python\ detect.py\ -\/-\/source\ "{}screen\ 0\ 100\ 100\ 512\ 256"{}`}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00251}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a972f8f7074c713bfe9170c38f63c75bc}{00251}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a972f8f7074c713bfe9170c38f63c75bc}{\_\_init\_\_}}(self,\ source,\ img\_size=640,\ stride=32,\ auto=True,\ transforms=None):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00252}00252\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ source\ =\ [screen\_number\ left\ top\ width\ height]\ (pixels)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00253}00253\ \ \ \ \ \ \ \ \ check\_requirements(\textcolor{stringliteral}{"{}mss"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00254}00254\ \ \ \ \ \ \ \ \ \textcolor{keyword}{import}\ mss}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00255}00255\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00256}00256\ \ \ \ \ \ \ \ \ source,\ *params\ =\ source.split()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00257}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a1398d44e4ba8943718241531eaac3d3f}{00257}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a1398d44e4ba8943718241531eaac3d3f}{screen}},\ left,\ top,\ width,\ height\ =\ 0,\ \textcolor{keywordtype}{None},\ \textcolor{keywordtype}{None},\ \textcolor{keywordtype}{None},\ \textcolor{keywordtype}{None}\ \ \textcolor{comment}{\#\ default\ to\ full\ screen\ 0}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00258}00258\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(params)\ ==\ 1:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00259}00259\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a1398d44e4ba8943718241531eaac3d3f}{screen}}\ =\ int(params[0])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00260}00260\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ len(params)\ ==\ 4:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00261}00261\ \ \ \ \ \ \ \ \ \ \ \ \ left,\ top,\ width,\ height\ =\ (int(x)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ params)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00262}00262\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ len(params)\ ==\ 5:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00263}00263\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a1398d44e4ba8943718241531eaac3d3f}{screen}},\ left,\ top,\ width,\ height\ =\ (int(x)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ params)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00264}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a8d78e46a44ba57e3a7485614dff7067a}{00264}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a8d78e46a44ba57e3a7485614dff7067a}{img\_size}}\ =\ img\_size}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00265}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a719e966ed0f38ab9641bd49e5d14958e}{00265}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a719e966ed0f38ab9641bd49e5d14958e}{stride}}\ =\ stride}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00266}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_abfb530d0a890799fda2a00d44f2b3718}{00266}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_abfb530d0a890799fda2a00d44f2b3718}{transforms}}\ =\ transforms}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00267}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a4bf54bdb454bfbe05db520a1faf5ecce}{00267}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a4bf54bdb454bfbe05db520a1faf5ecce}{auto}}\ =\ auto}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00268}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a561aa65c7be263f69d1f65234ba49d43}{00268}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a561aa65c7be263f69d1f65234ba49d43}{mode}}\ =\ \textcolor{stringliteral}{"{}stream"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00269}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a14ad85e15dd62927fb0aa4c4f70a3df2}{00269}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a14ad85e15dd62927fb0aa4c4f70a3df2}{frame}}\ =\ 0}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00270}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_acafb3dd29de8c22cc972a86a32447162}{00270}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_acafb3dd29de8c22cc972a86a32447162}{sct}}\ =\ mss.mss()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00271}00271\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00272}00272\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Parse\ monitor\ shape}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00273}00273\ \ \ \ \ \ \ \ \ monitor\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_acafb3dd29de8c22cc972a86a32447162}{sct}}.monitors[self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a1398d44e4ba8943718241531eaac3d3f}{screen}}]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00274}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_ac402c4c5fb9ddb484424a17365540886}{00274}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_ac402c4c5fb9ddb484424a17365540886}{top}}\ =\ monitor[\textcolor{stringliteral}{"{}top"{}}]\ \textcolor{keywordflow}{if}\ top\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{else}\ (monitor[\textcolor{stringliteral}{"{}top"{}}]\ +\ top)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00275}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a7a3027d3dadcd01cc20c9ad6d01050dd}{00275}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a7a3027d3dadcd01cc20c9ad6d01050dd}{left}}\ =\ monitor[\textcolor{stringliteral}{"{}left"{}}]\ \textcolor{keywordflow}{if}\ left\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{else}\ (monitor[\textcolor{stringliteral}{"{}left"{}}]\ +\ left)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00276}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a761a6e99d4489be7420c10f3be6d9000}{00276}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a761a6e99d4489be7420c10f3be6d9000}{width}}\ =\ width\ \textcolor{keywordflow}{or}\ monitor[\textcolor{stringliteral}{"{}width"{}}]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00277}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a284c3ee38180183eadd6451367ef08cc}{00277}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a284c3ee38180183eadd6451367ef08cc}{height}}\ =\ height\ \textcolor{keywordflow}{or}\ monitor[\textcolor{stringliteral}{"{}height"{}}]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00278}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_ab75fb6823689c5f4d631739830cb992d}{00278}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_ab75fb6823689c5f4d631739830cb992d}{monitor}}\ =\ \{\textcolor{stringliteral}{"{}left"{}}:\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a7a3027d3dadcd01cc20c9ad6d01050dd}{left}},\ \textcolor{stringliteral}{"{}top"{}}:\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_ac402c4c5fb9ddb484424a17365540886}{top}},\ \textcolor{stringliteral}{"{}width"{}}:\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a761a6e99d4489be7420c10f3be6d9000}{width}},\ \textcolor{stringliteral}{"{}height"{}}:\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a284c3ee38180183eadd6451367ef08cc}{height}}\}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00279}00279\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00280}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a799c7f01a7e80dd9f9bd5123e54dc885}{00280}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a799c7f01a7e80dd9f9bd5123e54dc885}{\_\_iter\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00281}00281\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00282}00282\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00283}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a87d939a866676c725d428e5cac80914f}{00283}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a87d939a866676c725d428e5cac80914f}{\_\_next\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00284}00284\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ mss\ screen\ capture:\ get\ raw\ pixels\ from\ the\ screen\ as\ np\ array}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00285}00285\ \ \ \ \ \ \ \ \ im0\ =\ np.array(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_acafb3dd29de8c22cc972a86a32447162}{sct}}.grab(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_ab75fb6823689c5f4d631739830cb992d}{monitor}}))[:,\ :,\ :3]\ \ \textcolor{comment}{\#\ [:,\ :,\ :3]\ BGRA\ to\ BGR}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00286}00286\ \ \ \ \ \ \ \ \ s\ =\ f\textcolor{stringliteral}{"{}screen\ \{self.screen\}\ (LTWH):\ \{self.left\},\{self.top\},\{self.width\},\{self.height\}:\ "{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00287}00287\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00288}00288\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_abfb530d0a890799fda2a00d44f2b3718}{transforms}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00289}00289\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_abfb530d0a890799fda2a00d44f2b3718}{transforms}}(im0)\ \ \textcolor{comment}{\#\ transforms}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00290}00290\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00291}00291\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ letterbox(im0,\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a8d78e46a44ba57e3a7485614dff7067a}{img\_size}},\ stride=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a719e966ed0f38ab9641bd49e5d14958e}{stride}},\ auto=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a4bf54bdb454bfbe05db520a1faf5ecce}{auto}})[0]\ \ \textcolor{comment}{\#\ padded\ resize}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00292}00292\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im.transpose((2,\ 0,\ 1))[::-\/1]\ \ \textcolor{comment}{\#\ HWC\ to\ CHW,\ BGR\ to\ RGB}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00293}00293\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ np.ascontiguousarray(im)\ \ \textcolor{comment}{\#\ contiguous}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00294}00294\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a14ad85e15dd62927fb0aa4c4f70a3df2}{frame}}\ +=\ 1}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00295}00295\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ str(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_screenshots_a1398d44e4ba8943718241531eaac3d3f}{screen}}),\ im,\ im0,\ \textcolor{keywordtype}{None},\ s\ \ \textcolor{comment}{\#\ screen,\ img,\ original\ img,\ im0s,\ s}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00296}00296\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00297}00297\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00298}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images}{00298}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images}{LoadImages}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00299}00299\ \ \ \ \ \textcolor{comment}{\#\ YOLOv5\ image/video\ dataloader,\ i.e.\ \`{}python\ detect.py\ -\/-\/source\ image.jpg/vid.mp4`}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00300}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a5e8ccc2d8601ea884e487bd93f138332}{00300}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a5e8ccc2d8601ea884e487bd93f138332}{\_\_init\_\_}}(self,\ path,\ img\_size=640,\ stride=32,\ auto=True,\ transforms=None,\ vid\_stride=1):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00301}00301\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ isinstance(path,\ str)\ \textcolor{keywordflow}{and}\ Path(path).suffix\ ==\ \textcolor{stringliteral}{"{}.txt"{}}:\ \ \textcolor{comment}{\#\ *.txt\ file\ with\ img/vid/dir\ on\ each\ line}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00302}00302\ \ \ \ \ \ \ \ \ \ \ \ \ path\ =\ Path(path).read\_text().rsplit()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00303}00303\ \ \ \ \ \ \ \ \ files\ =\ []}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00304}00304\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ p\ \textcolor{keywordflow}{in}\ sorted(path)\ \textcolor{keywordflow}{if}\ isinstance(path,\ (list,\ tuple))\ \textcolor{keywordflow}{else}\ [path]:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00305}00305\ \ \ \ \ \ \ \ \ \ \ \ \ p\ =\ str(Path(p).resolve())}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00306}00306\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}*"{}}\ \textcolor{keywordflow}{in}\ p:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00307}00307\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ files.extend(sorted(glob.glob(p,\ recursive=\textcolor{keyword}{True})))\ \ \textcolor{comment}{\#\ glob}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00308}00308\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ os.path.isdir(p):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00309}00309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ files.extend(sorted(glob.glob(os.path.join(p,\ \textcolor{stringliteral}{"{}*.*"{}}))))\ \ \textcolor{comment}{\#\ dir}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00310}00310\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ os.path.isfile(p):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00311}00311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ files.append(p)\ \ \textcolor{comment}{\#\ files}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00312}00312\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00313}00313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ FileNotFoundError(f\textcolor{stringliteral}{"{}\{p\}\ does\ not\ exist"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00314}00314\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00315}00315\ \ \ \ \ \ \ \ \ images\ =\ [x\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ files\ \textcolor{keywordflow}{if}\ x.split(\textcolor{stringliteral}{"{}."{}})[-\/1].lower()\ \textcolor{keywordflow}{in}\ IMG\_FORMATS]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00316}00316\ \ \ \ \ \ \ \ \ videos\ =\ [x\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ files\ \textcolor{keywordflow}{if}\ x.split(\textcolor{stringliteral}{"{}."{}})[-\/1].lower()\ \textcolor{keywordflow}{in}\ VID\_FORMATS]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00317}00317\ \ \ \ \ \ \ \ \ ni,\ nv\ =\ len(images),\ len(videos)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00318}00318\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00319}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_ae524f79f67a283f78a0cf363988efbd6}{00319}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_ae524f79f67a283f78a0cf363988efbd6}{img\_size}}\ =\ img\_size}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00320}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a3fc6c411e50745ddde54db23d8a3d843}{00320}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a3fc6c411e50745ddde54db23d8a3d843}{stride}}\ =\ stride}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00321}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_ab6804f0edd710e480b0c24d4aa403196}{00321}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_ab6804f0edd710e480b0c24d4aa403196}{files}}\ =\ images\ +\ videos}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00322}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a54564c002a02af0d6681ebf953b9afdb}{00322}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a54564c002a02af0d6681ebf953b9afdb}{nf}}\ =\ ni\ +\ nv\ \ \textcolor{comment}{\#\ number\ of\ files}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00323}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_ad54b9cafc72344bb9617cdc157b9f194}{00323}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_ad54b9cafc72344bb9617cdc157b9f194}{video\_flag}}\ =\ [\textcolor{keyword}{False}]\ *\ ni\ +\ [\textcolor{keyword}{True}]\ *\ nv}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00324}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_aec856fe4cfa026b4e71c74b4655c3ae1}{00324}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_aec856fe4cfa026b4e71c74b4655c3ae1}{mode}}\ =\ \textcolor{stringliteral}{"{}image"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00325}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a4a5fdfe1e88667bef343b0ab9a372823}{00325}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a4a5fdfe1e88667bef343b0ab9a372823}{auto}}\ =\ auto}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00326}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a99315ac82646d41a6d756a0d2c706ae2}{00326}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a99315ac82646d41a6d756a0d2c706ae2}{transforms}}\ =\ transforms\ \ \textcolor{comment}{\#\ optional}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00327}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a5d76713bb2bae590a28ca5736290d60d}{00327}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a5d76713bb2bae590a28ca5736290d60d}{vid\_stride}}\ =\ vid\_stride\ \ \textcolor{comment}{\#\ video\ frame-\/rate\ stride}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00328}00328\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ any(videos):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00329}00329\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_aee94159700f385a4f488f13e06e6bf0c}{\_new\_video}}(videos[0])\ \ \textcolor{comment}{\#\ new\ video}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00330}00330\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00331}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a00657acc63165f59e1fd03aeada5038f}{00331}}\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a00657acc63165f59e1fd03aeada5038f}{cap}}\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00332}00332\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a54564c002a02af0d6681ebf953b9afdb}{nf}}\ >\ 0,\ (}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00333}00333\ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}No\ images\ or\ videos\ found\ in\ \{p\}.\ "{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00334}00334\ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}Supported\ formats\ are:\(\backslash\)nimages:\ \{IMG\_FORMATS\}\(\backslash\)nvideos:\ \{VID\_FORMATS\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00335}00335\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00336}00336\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00337}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a25714e03fed266a5f8cf8caeb866dea9}{00337}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a25714e03fed266a5f8cf8caeb866dea9}{\_\_iter\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00338}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a261652cd87269f704c75557085e58bcf}{00338}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a261652cd87269f704c75557085e58bcf}{count}}\ =\ 0}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00339}00339\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00340}00340\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00341}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a46ef80129c789a1a9daaed00e5b70c0e}{00341}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a46ef80129c789a1a9daaed00e5b70c0e}{\_\_next\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00342}00342\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a261652cd87269f704c75557085e58bcf}{count}}\ ==\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a54564c002a02af0d6681ebf953b9afdb}{nf}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00343}00343\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ StopIteration}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00344}00344\ \ \ \ \ \ \ \ \ path\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_ab6804f0edd710e480b0c24d4aa403196}{files}}[self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a261652cd87269f704c75557085e58bcf}{count}}]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00345}00345\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00346}00346\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_ad54b9cafc72344bb9617cdc157b9f194}{video\_flag}}[self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a261652cd87269f704c75557085e58bcf}{count}}]:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00347}00347\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Read\ video}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00348}00348\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_aec856fe4cfa026b4e71c74b4655c3ae1}{mode}}\ =\ \textcolor{stringliteral}{"{}video"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00349}00349\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ \_\ \textcolor{keywordflow}{in}\ range(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a5d76713bb2bae590a28ca5736290d60d}{vid\_stride}}):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00350}00350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a00657acc63165f59e1fd03aeada5038f}{cap}}.grab()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00351}00351\ \ \ \ \ \ \ \ \ \ \ \ \ ret\_val,\ im0\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a00657acc63165f59e1fd03aeada5038f}{cap}}.retrieve()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00352}00352\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ \textcolor{keywordflow}{not}\ ret\_val:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00353}00353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a261652cd87269f704c75557085e58bcf}{count}}\ +=\ 1}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00354}00354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a00657acc63165f59e1fd03aeada5038f}{cap}}.release()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00355}00355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a261652cd87269f704c75557085e58bcf}{count}}\ ==\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a54564c002a02af0d6681ebf953b9afdb}{nf}}:\ \ \textcolor{comment}{\#\ last\ video}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00356}00356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ StopIteration}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00357}00357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ path\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_ab6804f0edd710e480b0c24d4aa403196}{files}}[self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a261652cd87269f704c75557085e58bcf}{count}}]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00358}00358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_aee94159700f385a4f488f13e06e6bf0c}{\_new\_video}}(path)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00359}00359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ret\_val,\ im0\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a00657acc63165f59e1fd03aeada5038f}{cap}}.read()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00360}00360\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00361}00361\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a27ad39b688ffaa0b806b759a2c278ca9}{frame}}\ +=\ 1}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00362}00362\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ im0\ =\ self.\_cv2\_rotate(im0)\ \ \#\ for\ use\ if\ cv2\ autorotation\ is\ False}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00363}00363\ \ \ \ \ \ \ \ \ \ \ \ \ s\ =\ f\textcolor{stringliteral}{"{}video\ \{self.count\ +\ 1\}/\{self.nf\}\ (\{self.frame\}/\{self.frames\})\ \{path\}:\ "{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00364}00364\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00365}00365\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00366}00366\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Read\ image}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00367}00367\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a261652cd87269f704c75557085e58bcf}{count}}\ +=\ 1}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00368}00368\ \ \ \ \ \ \ \ \ \ \ \ \ im0\ =\ cv2.imread(path)\ \ \textcolor{comment}{\#\ BGR}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00369}00369\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ im0\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ f\textcolor{stringliteral}{"{}Image\ Not\ Found\ \{path\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00370}00370\ \ \ \ \ \ \ \ \ \ \ \ \ s\ =\ f\textcolor{stringliteral}{"{}image\ \{self.count\}/\{self.nf\}\ \{path\}:\ "{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00371}00371\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00372}00372\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a99315ac82646d41a6d756a0d2c706ae2}{transforms}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00373}00373\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a99315ac82646d41a6d756a0d2c706ae2}{transforms}}(im0)\ \ \textcolor{comment}{\#\ transforms}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00374}00374\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00375}00375\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ letterbox(im0,\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_ae524f79f67a283f78a0cf363988efbd6}{img\_size}},\ stride=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a3fc6c411e50745ddde54db23d8a3d843}{stride}},\ auto=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a4a5fdfe1e88667bef343b0ab9a372823}{auto}})[0]\ \ \textcolor{comment}{\#\ padded\ resize}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00376}00376\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im.transpose((2,\ 0,\ 1))[::-\/1]\ \ \textcolor{comment}{\#\ HWC\ to\ CHW,\ BGR\ to\ RGB}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00377}00377\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ np.ascontiguousarray(im)\ \ \textcolor{comment}{\#\ contiguous}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00378}00378\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00379}00379\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ path,\ im,\ im0,\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a00657acc63165f59e1fd03aeada5038f}{cap}},\ s}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00380}00380\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00381}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_aee94159700f385a4f488f13e06e6bf0c}{00381}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_aee94159700f385a4f488f13e06e6bf0c}{\_new\_video}}(self,\ path):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00382}00382\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Create\ a\ new\ video\ capture\ object}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00383}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a27ad39b688ffaa0b806b759a2c278ca9}{00383}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a27ad39b688ffaa0b806b759a2c278ca9}{frame}}\ =\ 0}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00384}00384\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a00657acc63165f59e1fd03aeada5038f}{cap}}\ =\ cv2.VideoCapture(path)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00385}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a5aa311b11b1201fb26623962dde8f22e}{00385}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a5aa311b11b1201fb26623962dde8f22e}{frames}}\ =\ int(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a00657acc63165f59e1fd03aeada5038f}{cap}}.get(cv2.CAP\_PROP\_FRAME\_COUNT)\ /\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a5d76713bb2bae590a28ca5736290d60d}{vid\_stride}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00386}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a020638704fcf82479d0f34efd085c531}{00386}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a020638704fcf82479d0f34efd085c531}{orientation}}\ =\ int(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a00657acc63165f59e1fd03aeada5038f}{cap}}.get(cv2.CAP\_PROP\_ORIENTATION\_META))\ \ \textcolor{comment}{\#\ rotation\ degrees}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00387}00387\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ self.cap.set(cv2.CAP\_PROP\_ORIENTATION\_AUTO,\ 0)\ \ \#\ disable\ https://github.com/ultralytics/yolov5/issues/8493}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00388}00388\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00389}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a8c5b2060aad2ef0f0cfb342dc8201bbd}{00389}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a8c5b2060aad2ef0f0cfb342dc8201bbd}{\_cv2\_rotate}}(self,\ im):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00390}00390\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Rotate\ a\ cv2\ video\ manually}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00391}00391\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a020638704fcf82479d0f34efd085c531}{orientation}}\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00392}00392\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ cv2.rotate(im,\ cv2.ROTATE\_90\_CLOCKWISE)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00393}00393\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a020638704fcf82479d0f34efd085c531}{orientation}}\ ==\ 180:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00394}00394\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ cv2.rotate(im,\ cv2.ROTATE\_90\_COUNTERCLOCKWISE)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00395}00395\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a020638704fcf82479d0f34efd085c531}{orientation}}\ ==\ 90:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00396}00396\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ cv2.rotate(im,\ cv2.ROTATE\_180)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00397}00397\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ im}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00398}00398\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00399}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a38e0c7d96d5a9ea677b17d2ff1d32a62}{00399}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a38e0c7d96d5a9ea677b17d2ff1d32a62}{\_\_len\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00400}00400\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_a54564c002a02af0d6681ebf953b9afdb}{nf}}\ \ \textcolor{comment}{\#\ number\ of\ files}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00401}00401\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00402}00402\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00403}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams}{00403}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams}{LoadStreams}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00404}00404\ \ \ \ \ \textcolor{comment}{\#\ YOLOv5\ streamloader,\ i.e.\ \`{}python\ detect.py\ -\/-\/source\ 'rtsp://example.com/media.mp4'\ \ \#\ RTSP,\ RTMP,\ HTTP\ streams`}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00405}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_ae4ae6975cd3a610023d8be1c195b9697}{00405}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_ae4ae6975cd3a610023d8be1c195b9697}{\_\_init\_\_}}(self,\ sources="{}file.streams"{},\ img\_size=640,\ stride=32,\ auto=True,\ transforms=None,\ vid\_stride=1):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00406}00406\ \ \ \ \ \ \ \ \ torch.backends.cudnn.benchmark\ =\ \textcolor{keyword}{True}\ \ \textcolor{comment}{\#\ faster\ for\ fixed-\/size\ inference}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00407}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_ab241dc52496f8efcab02c8fb00c0e3ca}{00407}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_ab241dc52496f8efcab02c8fb00c0e3ca}{mode}}\ =\ \textcolor{stringliteral}{"{}stream"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00408}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a1c3c481bb55684b28e4cd33e65ce2d82}{00408}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a1c3c481bb55684b28e4cd33e65ce2d82}{img\_size}}\ =\ img\_size}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00409}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_aa9686db88958386e109cac83330bcb78}{00409}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_aa9686db88958386e109cac83330bcb78}{stride}}\ =\ stride}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00410}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a1bc18414ae4afc05cee71fcfb0e64658}{00410}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a1bc18414ae4afc05cee71fcfb0e64658}{vid\_stride}}\ =\ vid\_stride\ \ \textcolor{comment}{\#\ video\ frame-\/rate\ stride}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00411}00411\ \ \ \ \ \ \ \ \ sources\ =\ Path(sources).read\_text().rsplit()\ \textcolor{keywordflow}{if}\ os.path.isfile(sources)\ \textcolor{keywordflow}{else}\ [sources]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00412}00412\ \ \ \ \ \ \ \ \ n\ =\ len(sources)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00413}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a226beb28f51fb40d6ddb7c4345794ff9}{00413}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a226beb28f51fb40d6ddb7c4345794ff9}{sources}}\ =\ [clean\_str(x)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ sources]\ \ \textcolor{comment}{\#\ clean\ source\ names\ for\ later}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00414}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_ae0086415665914e4ba7215d5a53192b1}{00414}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a4c104efb408874bb5731b799197dca22}{imgs}},\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_ae0086415665914e4ba7215d5a53192b1}{fps}},\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_ab348f344ba2c0f2cbc11260e0e0fbb51}{frames}},\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a1df5b65513df91086bb03fe06b635a81}{threads}}\ =\ [\textcolor{keywordtype}{None}]\ *\ n,\ [0]\ *\ n,\ [0]\ *\ n,\ [\textcolor{keywordtype}{None}]\ *\ n}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00415}00415\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ s\ \textcolor{keywordflow}{in}\ enumerate(sources):\ \ \textcolor{comment}{\#\ index,\ source}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00416}00416\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Start\ thread\ to\ read\ frames\ from\ video\ stream}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00417}00417\ \ \ \ \ \ \ \ \ \ \ \ \ st\ =\ f\textcolor{stringliteral}{"{}\{i\ +\ 1\}/\{n\}:\ \{s\}...\ "{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00418}00418\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ urlparse(s).hostname\ \textcolor{keywordflow}{in}\ (\textcolor{stringliteral}{"{}www.youtube.com"{}},\ \textcolor{stringliteral}{"{}youtube.com"{}},\ \textcolor{stringliteral}{"{}youtu.be"{}}):\ \ \textcolor{comment}{\#\ if\ source\ is\ YouTube\ video}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00419}00419\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ YouTube\ format\ i.e.\ 'https://www.youtube.com/watch?v=Zgi9g1ksQHc'\ or\ 'https://youtu.be/LNwODJXcvt4'}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00420}00420\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ check\_requirements((\textcolor{stringliteral}{"{}pafy"{}},\ \textcolor{stringliteral}{"{}youtube\_dl==2020.12.2"{}}))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00421}00421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{import}\ pafy}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00422}00422\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00423}00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ s\ =\ pafy.new(s).getbest(preftype=\textcolor{stringliteral}{"{}mp4"{}}).url\ \ \textcolor{comment}{\#\ YouTube\ URL}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00424}00424\ \ \ \ \ \ \ \ \ \ \ \ \ s\ =\ eval(s)\ \textcolor{keywordflow}{if}\ s.isnumeric()\ \textcolor{keywordflow}{else}\ s\ \ \textcolor{comment}{\#\ i.e.\ s\ =\ '0'\ local\ webcam}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00425}00425\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ s\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00426}00426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ \textcolor{keywordflow}{not}\ is\_colab(),\ \textcolor{stringliteral}{"{}-\/-\/source\ 0\ webcam\ unsupported\ on\ Colab.\ Rerun\ command\ in\ a\ local\ environment."{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00427}00427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ \textcolor{keywordflow}{not}\ is\_kaggle(),\ \textcolor{stringliteral}{"{}-\/-\/source\ 0\ webcam\ unsupported\ on\ Kaggle.\ Rerun\ command\ in\ a\ local\ environment."{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00428}00428\ \ \ \ \ \ \ \ \ \ \ \ \ cap\ =\ cv2.VideoCapture(s)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00429}00429\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ cap.isOpened(),\ f\textcolor{stringliteral}{"{}\{st\}Failed\ to\ open\ \{s\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00430}00430\ \ \ \ \ \ \ \ \ \ \ \ \ w\ =\ int(cap.get(cv2.CAP\_PROP\_FRAME\_WIDTH))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00431}00431\ \ \ \ \ \ \ \ \ \ \ \ \ h\ =\ int(cap.get(cv2.CAP\_PROP\_FRAME\_HEIGHT))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00432}00432\ \ \ \ \ \ \ \ \ \ \ \ \ fps\ =\ cap.get(cv2.CAP\_PROP\_FPS)\ \ \textcolor{comment}{\#\ warning:\ may\ return\ 0\ or\ nan}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00433}00433\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_ab348f344ba2c0f2cbc11260e0e0fbb51}{frames}}[i]\ =\ max(int(cap.get(cv2.CAP\_PROP\_FRAME\_COUNT)),\ 0)\ \textcolor{keywordflow}{or}\ float(\textcolor{stringliteral}{"{}inf"{}})\ \ \textcolor{comment}{\#\ infinite\ stream\ fallback}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00434}00434\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_ae0086415665914e4ba7215d5a53192b1}{fps}}[i]\ =\ max((fps\ \textcolor{keywordflow}{if}\ math.isfinite(fps)\ \textcolor{keywordflow}{else}\ 0)\ \%\ 100,\ 0)\ \textcolor{keywordflow}{or}\ 30\ \ \textcolor{comment}{\#\ 30\ FPS\ fallback}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00435}00435\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00436}00436\ \ \ \ \ \ \ \ \ \ \ \ \ \_,\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a4c104efb408874bb5731b799197dca22}{imgs}}[i]\ =\ cap.read()\ \ \textcolor{comment}{\#\ guarantee\ first\ frame}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00437}00437\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a1df5b65513df91086bb03fe06b635a81}{threads}}[i]\ =\ Thread(target=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_aedd0ae5ba3f9a773ac56c20338dea462}{update}},\ args=([i,\ cap,\ s]),\ daemon=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00438}00438\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}\{st\}\ Success\ (\{self.frames[i]\}\ frames\ \{w\}x\{h\}\ at\ \{self.fps[i]:.2f\}\ FPS)"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00439}00439\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a1df5b65513df91086bb03fe06b635a81}{threads}}[i].\mbox{\hyperlink{ur5__task__library_8h_a5d74787dedbc4e11c1ab15bf487e61f8a0e97c69c73117f6c0109b2d7d1d9cedc}{start}}()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00440}00440\ \ \ \ \ \ \ \ \ LOGGER.info(\textcolor{stringliteral}{"{}"{}})\ \ \textcolor{comment}{\#\ newline}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00441}00441\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00442}00442\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ check\ for\ common\ shapes}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00443}00443\ \ \ \ \ \ \ \ \ s\ =\ np.stack([letterbox(x,\ img\_size,\ stride=stride,\ auto=auto)[0].shape\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a4c104efb408874bb5731b799197dca22}{imgs}}])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00444}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a5739aff9d2d36783f743d4eeae97ee45}{00444}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a5739aff9d2d36783f743d4eeae97ee45}{rect}}\ =\ np.unique(s,\ axis=0).shape[0]\ ==\ 1\ \ \textcolor{comment}{\#\ rect\ inference\ if\ all\ shapes\ equal}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00445}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a4f3d55c35d696c9ad6d78997337257b3}{00445}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a4f3d55c35d696c9ad6d78997337257b3}{auto}}\ =\ auto\ \textcolor{keywordflow}{and}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a5739aff9d2d36783f743d4eeae97ee45}{rect}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00446}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_acdfb78e33e19a9c5407fdb1df77166b8}{00446}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_acdfb78e33e19a9c5407fdb1df77166b8}{transforms}}\ =\ transforms\ \ \textcolor{comment}{\#\ optional}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00447}00447\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a5739aff9d2d36783f743d4eeae97ee45}{rect}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00448}00448\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.warning(\textcolor{stringliteral}{"{}WARNING\ ⚠️\ Stream\ shapes\ differ.\ For\ optimal\ performance\ supply\ similarly-\/shaped\ streams."{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00449}00449\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00450}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_aedd0ae5ba3f9a773ac56c20338dea462}{00450}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_aedd0ae5ba3f9a773ac56c20338dea462}{update}}(self,\ i,\ cap,\ stream):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00451}00451\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Read\ stream\ \`{}i`\ frames\ in\ daemon\ thread}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00452}00452\ \ \ \ \ \ \ \ \ n,\ f\ =\ 0,\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_ab348f344ba2c0f2cbc11260e0e0fbb51}{frames}}[i]\ \ \textcolor{comment}{\#\ frame\ number,\ frame\ array}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00453}00453\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ cap.isOpened()\ \textcolor{keywordflow}{and}\ n\ <\ f:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00454}00454\ \ \ \ \ \ \ \ \ \ \ \ \ n\ +=\ 1}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00455}00455\ \ \ \ \ \ \ \ \ \ \ \ \ cap.grab()\ \ \textcolor{comment}{\#\ .read()\ =\ .grab()\ followed\ by\ .retrieve()}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00456}00456\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ n\ \%\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a1bc18414ae4afc05cee71fcfb0e64658}{vid\_stride}}\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00457}00457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ success,\ im\ =\ cap.retrieve()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00458}00458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ success:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00459}00459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a4c104efb408874bb5731b799197dca22}{imgs}}[i]\ =\ im}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00460}00460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00461}00461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.warning(\textcolor{stringliteral}{"{}WARNING\ ⚠️\ Video\ stream\ unresponsive,\ please\ check\ your\ IP\ camera\ connection."{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00462}00462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a4c104efb408874bb5731b799197dca22}{imgs}}[i]\ =\ np.zeros\_like(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a4c104efb408874bb5731b799197dca22}{imgs}}[i])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00463}00463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cap.open(stream)\ \ \textcolor{comment}{\#\ re-\/open\ stream\ if\ signal\ was\ lost}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00464}00464\ \ \ \ \ \ \ \ \ \ \ \ \ time.sleep(0.0)\ \ \textcolor{comment}{\#\ wait\ time}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00465}00465\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00466}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a9b968937d47e7626ad86ed3297060cab}{00466}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a9b968937d47e7626ad86ed3297060cab}{\_\_iter\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00467}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a5f3fd03864a7449004ca62a32de2c0fd}{00467}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a5f3fd03864a7449004ca62a32de2c0fd}{count}}\ =\ -\/1}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00468}00468\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00469}00469\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00470}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_abe6401966820ae105038541bfcf4c488}{00470}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_abe6401966820ae105038541bfcf4c488}{\_\_next\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00471}00471\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a5f3fd03864a7449004ca62a32de2c0fd}{count}}\ +=\ 1}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00472}00472\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ all(x.is\_alive()\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a1df5b65513df91086bb03fe06b635a81}{threads}})\ \textcolor{keywordflow}{or}\ cv2.waitKey(1)\ ==\ ord(\textcolor{stringliteral}{"{}q"{}}):\ \ \textcolor{comment}{\#\ q\ to\ quit}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00473}00473\ \ \ \ \ \ \ \ \ \ \ \ \ cv2.destroyAllWindows()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00474}00474\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ StopIteration}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00475}00475\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00476}00476\ \ \ \ \ \ \ \ \ im0\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a4c104efb408874bb5731b799197dca22}{imgs}}.copy()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00477}00477\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_acdfb78e33e19a9c5407fdb1df77166b8}{transforms}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00478}00478\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ np.stack([self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_acdfb78e33e19a9c5407fdb1df77166b8}{transforms}}(x)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ im0])\ \ \textcolor{comment}{\#\ transforms}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00479}00479\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00480}00480\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ np.stack([letterbox(x,\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a1c3c481bb55684b28e4cd33e65ce2d82}{img\_size}},\ stride=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_aa9686db88958386e109cac83330bcb78}{stride}},\ auto=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a4f3d55c35d696c9ad6d78997337257b3}{auto}})[0]\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ im0])\ \ \textcolor{comment}{\#\ resize}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00481}00481\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im[...,\ ::-\/1].transpose((0,\ 3,\ 1,\ 2))\ \ \textcolor{comment}{\#\ BGR\ to\ RGB,\ BHWC\ to\ BCHW}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00482}00482\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ np.ascontiguousarray(im)\ \ \textcolor{comment}{\#\ contiguous}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00483}00483\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00484}00484\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a226beb28f51fb40d6ddb7c4345794ff9}{sources}},\ im,\ im0,\ \textcolor{keywordtype}{None},\ \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00485}00485\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00486}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a872c303fd19993200de629ce40502f7b}{00486}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a872c303fd19993200de629ce40502f7b}{\_\_len\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00487}00487\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ len(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_streams_a226beb28f51fb40d6ddb7c4345794ff9}{sources}})\ \ \textcolor{comment}{\#\ 1E12\ frames\ =\ 32\ streams\ at\ 30\ FPS\ for\ 30\ years}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00488}00488\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00489}00489\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00490}\mbox{\hyperlink{namespaceutils_1_1dataloaders_acd133514ba80d553e414b3cd37522292}{00490}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceutils_1_1dataloaders_acd133514ba80d553e414b3cd37522292}{img2label\_paths}}(img\_paths):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00491}00491\ \ \ \ \ \textcolor{comment}{\#\ Define\ label\ paths\ as\ a\ function\ of\ image\ paths}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00492}00492\ \ \ \ \ sa,\ sb\ =\ f\textcolor{stringliteral}{"{}\{os.sep\}images\{os.sep\}"{}},\ f\textcolor{stringliteral}{"{}\{os.sep\}labels\{os.sep\}"{}}\ \ \textcolor{comment}{\#\ /images/,\ /labels/\ substrings}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00493}00493\ \ \ \ \ \textcolor{keywordflow}{return}\ [sb.join(x.rsplit(sa,\ 1)).rsplit(\textcolor{stringliteral}{"{}."{}},\ 1)[0]\ +\ \textcolor{stringliteral}{"{}.txt"{}}\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ img\_paths]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00494}00494\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00495}00495\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00496}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels}{00496}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels}{LoadImagesAndLabels}}(Dataset):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00497}00497\ \ \ \ \ \textcolor{comment}{\#\ YOLOv5\ train\_loader/val\_loader,\ loads\ images\ and\ labels\ for\ training\ and\ validation}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00498}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_af231f2f5a372a07e61d40f60c45267b5}{00498}}\ \ \ \ \ cache\_version\ =\ 0.6\ \ \textcolor{comment}{\#\ dataset\ labels\ *.cache\ version}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00499}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8de2f804c0b468be7d5f06e299ba70ce}{00499}}\ \ \ \ \ rand\_interp\_methods\ =\ [cv2.INTER\_NEAREST,\ cv2.INTER\_LINEAR,\ cv2.INTER\_CUBIC,\ cv2.INTER\_AREA,\ cv2.INTER\_LANCZOS4]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00500}00500\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00501}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a60cf35e515c904b464e3e441be21d792}{00501}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a60cf35e515c904b464e3e441be21d792}{\_\_init\_\_}}(}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00502}00502\ \ \ \ \ \ \ \ \ self,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00503}00503\ \ \ \ \ \ \ \ \ path,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00504}00504\ \ \ \ \ \ \ \ \ img\_size=640,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00505}00505\ \ \ \ \ \ \ \ \ batch\_size=16,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00506}00506\ \ \ \ \ \ \ \ \ augment=False,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00507}00507\ \ \ \ \ \ \ \ \ hyp=None,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00508}00508\ \ \ \ \ \ \ \ \ rect=False,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00509}00509\ \ \ \ \ \ \ \ \ image\_weights=False,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00510}00510\ \ \ \ \ \ \ \ \ cache\_images=False,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00511}00511\ \ \ \ \ \ \ \ \ single\_cls=False,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00512}00512\ \ \ \ \ \ \ \ \ stride=32,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00513}00513\ \ \ \ \ \ \ \ \ pad=0.0,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00514}00514\ \ \ \ \ \ \ \ \ min\_items=0,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00515}00515\ \ \ \ \ \ \ \ \ prefix="{}"{},}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00516}00516\ \ \ \ \ \ \ \ \ rank=-\/1,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00517}00517\ \ \ \ \ \ \ \ \ seed=0,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00518}00518\ \ \ \ \ ):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00519}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aaf2b9425db6c2fd723025393e181d3e3}{00519}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aaf2b9425db6c2fd723025393e181d3e3}{img\_size}}\ =\ img\_size}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00520}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_afe3013a59e9113d4007d92d3927c8235}{00520}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_afe3013a59e9113d4007d92d3927c8235}{augment}}\ =\ augment}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00521}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{00521}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}\ =\ hyp}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00522}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0976f6fc92e7d00617036e125f2baeb8}{00522}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0976f6fc92e7d00617036e125f2baeb8}{image\_weights}}\ =\ image\_weights}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00523}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8ee5d25bf251c3f9876adb21db5c04d0}{00523}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8ee5d25bf251c3f9876adb21db5c04d0}{rect}}\ =\ \textcolor{keyword}{False}\ \textcolor{keywordflow}{if}\ image\_weights\ \textcolor{keywordflow}{else}\ rect}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00524}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aecad2b4b731326aa073b5cdaaaa42c87}{00524}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aecad2b4b731326aa073b5cdaaaa42c87}{mosaic}}\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_afe3013a59e9113d4007d92d3927c8235}{augment}}\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8ee5d25bf251c3f9876adb21db5c04d0}{rect}}\ \ \textcolor{comment}{\#\ load\ 4\ images\ at\ a\ time\ into\ a\ mosaic\ (only\ during\ training)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00525}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a2ae5dfa3541d182ab5a3b5d559ec2f5b}{00525}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a2ae5dfa3541d182ab5a3b5d559ec2f5b}{mosaic\_border}}\ =\ [-\/img\_size\ //\ 2,\ -\/img\_size\ //\ 2]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00526}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8f72cc72fe46ce9bbb7f326e40525347}{00526}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8f72cc72fe46ce9bbb7f326e40525347}{stride}}\ =\ stride}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00527}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a17f2bcd33b25fbd941e29c83e58ff0c5}{00527}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a17f2bcd33b25fbd941e29c83e58ff0c5}{path}}\ =\ path}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00528}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a14b38a3ab35f3ae18690d1e26c8019a6}{00528}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a14b38a3ab35f3ae18690d1e26c8019a6}{albumentations}}\ =\ \mbox{\hyperlink{classutils_1_1augmentations_1_1_albumentations}{Albumentations}}(size=img\_size)\ \textcolor{keywordflow}{if}\ augment\ \textcolor{keywordflow}{else}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00529}00529\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00530}00530\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00531}00531\ \ \ \ \ \ \ \ \ \ \ \ \ f\ =\ []\ \ \textcolor{comment}{\#\ image\ files}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00532}00532\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ p\ \textcolor{keywordflow}{in}\ path\ \textcolor{keywordflow}{if}\ isinstance(path,\ list)\ \textcolor{keywordflow}{else}\ [path]:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00533}00533\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p\ =\ Path(p)\ \ \textcolor{comment}{\#\ os-\/agnostic}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00534}00534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ p.is\_dir():\ \ \textcolor{comment}{\#\ dir}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00535}00535\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\ +=\ glob.glob(str(p\ /\ \textcolor{stringliteral}{"{}**"{}}\ /\ \textcolor{stringliteral}{"{}*.*"{}}),\ recursive=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00536}00536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ f\ =\ list(p.rglob('*.*'))\ \ \#\ pathlib}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00537}00537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ p.is\_file():\ \ \textcolor{comment}{\#\ file}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00538}00538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ open(p)\ \textcolor{keyword}{as}\ t:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00539}00539\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t\ =\ t.read().strip().splitlines()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00540}00540\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ parent\ =\ str(p.parent)\ +\ os.sep}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00541}00541\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\ +=\ [x.replace(\textcolor{stringliteral}{"{}./"{}},\ parent,\ 1)\ \textcolor{keywordflow}{if}\ x.startswith(\textcolor{stringliteral}{"{}./"{}})\ \textcolor{keywordflow}{else}\ x\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ t]\ \ \textcolor{comment}{\#\ to\ global\ path}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00542}00542\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ f\ +=\ [p.parent\ /\ x.lstrip(os.sep)\ for\ x\ in\ t]\ \ \#\ to\ global\ path\ (pathlib)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00543}00543\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00544}00544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ FileNotFoundError(f\textcolor{stringliteral}{"{}\{prefix\}\{p\}\ does\ not\ exist"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00545}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{00545}}\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}}\ =\ sorted(x.replace(\textcolor{stringliteral}{"{}/"{}},\ os.sep)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ f\ \textcolor{keywordflow}{if}\ x.split(\textcolor{stringliteral}{"{}."{}})[-\/1].lower()\ \textcolor{keywordflow}{in}\ IMG\_FORMATS)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00546}00546\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ self.img\_files\ =\ sorted([x\ for\ x\ in\ f\ if\ x.suffix[1:].lower()\ in\ IMG\_FORMATS])\ \ \#\ pathlib}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00547}00547\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}},\ f\textcolor{stringliteral}{"{}\{prefix\}No\ images\ found"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00548}00548\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00549}00549\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ Exception(f\textcolor{stringliteral}{"{}\{prefix\}Error\ loading\ data\ from\ \{path\}:\ \{e\}\(\backslash\)n\{HELP\_URL\}"{}})\ \textcolor{keyword}{from}\ e}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00550}00550\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00551}00551\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Check\ cache}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00552}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0ce6bcf4b6bd14d2f86872e94247cacd}{00552}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0ce6bcf4b6bd14d2f86872e94247cacd}{label\_files}}\ =\ img2label\_paths(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}})\ \ \textcolor{comment}{\#\ labels}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00553}00553\ \ \ \ \ \ \ \ \ cache\_path\ =\ (p\ \textcolor{keywordflow}{if}\ p.is\_file()\ \textcolor{keywordflow}{else}\ Path(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0ce6bcf4b6bd14d2f86872e94247cacd}{label\_files}}[0]).parent).with\_suffix(\textcolor{stringliteral}{"{}.cache"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00554}00554\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00555}00555\ \ \ \ \ \ \ \ \ \ \ \ \ cache,\ exists\ =\ np.load(cache\_path,\ allow\_pickle=\textcolor{keyword}{True}).item(),\ \textcolor{keyword}{True}\ \ \textcolor{comment}{\#\ load\ dict}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00556}00556\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ cache[\textcolor{stringliteral}{"{}version"{}}]\ ==\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_af231f2f5a372a07e61d40f60c45267b5}{cache\_version}}\ \ \textcolor{comment}{\#\ matches\ current\ version}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00557}00557\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ cache[\textcolor{stringliteral}{"{}hash"{}}]\ ==\ \mbox{\hyperlink{namespaceutils_1_1dataloaders_a040e2e64822c6005809f7923a69f9df6}{get\_hash}}(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0ce6bcf4b6bd14d2f86872e94247cacd}{label\_files}}\ +\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}})\ \ \textcolor{comment}{\#\ identical\ hash}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00558}00558\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00559}00559\ \ \ \ \ \ \ \ \ \ \ \ \ cache,\ exists\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ae10e1aed6b82eb11604e6c1f39d23909}{cache\_labels}}(cache\_path,\ prefix),\ \textcolor{keyword}{False}\ \ \textcolor{comment}{\#\ run\ cache\ ops}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00560}00560\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00561}00561\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Display\ cache}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00562}00562\ \ \ \ \ \ \ \ \ nf,\ nm,\ ne,\ nc,\ n\ =\ cache.pop(\textcolor{stringliteral}{"{}results"{}})\ \ \textcolor{comment}{\#\ found,\ missing,\ empty,\ corrupt,\ total}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00563}00563\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ exists\ \textcolor{keywordflow}{and}\ LOCAL\_RANK\ \textcolor{keywordflow}{in}\ \{-\/1,\ 0\}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00564}00564\ \ \ \ \ \ \ \ \ \ \ \ \ d\ =\ f\textcolor{stringliteral}{"{}Scanning\ \{cache\_path\}...\ \{nf\}\ images,\ \{nm\ +\ ne\}\ backgrounds,\ \{nc\}\ corrupt"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00565}00565\ \ \ \ \ \ \ \ \ \ \ \ \ tqdm(\textcolor{keywordtype}{None},\ desc=prefix\ +\ d,\ total=n,\ initial=n,\ bar\_format=TQDM\_BAR\_FORMAT)\ \ \textcolor{comment}{\#\ display\ cache\ results}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00566}00566\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ cache[\textcolor{stringliteral}{"{}msgs"{}}]:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00567}00567\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(\textcolor{stringliteral}{"{}\(\backslash\)n"{}}.join(cache[\textcolor{stringliteral}{"{}msgs"{}}]))\ \ \textcolor{comment}{\#\ display\ warnings}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00568}00568\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ nf\ >\ 0\ \textcolor{keywordflow}{or}\ \textcolor{keywordflow}{not}\ augment,\ f\textcolor{stringliteral}{"{}\{prefix\}No\ labels\ found\ in\ \{cache\_path\},\ can\ not\ start\ training.\ \{HELP\_URL\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00569}00569\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00570}00570\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Read\ cache}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00571}00571\ \ \ \ \ \ \ \ \ [cache.pop(k)\ \textcolor{keywordflow}{for}\ k\ \textcolor{keywordflow}{in}\ (\textcolor{stringliteral}{"{}hash"{}},\ \textcolor{stringliteral}{"{}version"{}},\ \textcolor{stringliteral}{"{}msgs"{}})]\ \ \textcolor{comment}{\#\ remove\ items}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00572}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a26a6a58e1558930199cd96b5dc4adfb8}{00572}}\ \ \ \ \ \ \ \ \ labels,\ shapes,\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a26a6a58e1558930199cd96b5dc4adfb8}{segments}}\ =\ zip(*cache.values())}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00573}00573\ \ \ \ \ \ \ \ \ nl\ =\ len(np.concatenate(labels,\ 0))\ \ \textcolor{comment}{\#\ number\ of\ labels}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00574}00574\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ nl\ >\ 0\ \textcolor{keywordflow}{or}\ \textcolor{keywordflow}{not}\ augment,\ f\textcolor{stringliteral}{"{}\{prefix\}All\ labels\ empty\ in\ \{cache\_path\},\ can\ not\ start\ training.\ \{HELP\_URL\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00575}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{00575}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{labels}}\ =\ list(labels)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00576}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ac78ada45fce0dc8766c438edc4da8fb3}{00576}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ac78ada45fce0dc8766c438edc4da8fb3}{shapes}}\ =\ np.array(shapes)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00577}00577\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}}\ =\ list(cache.keys())\ \ \textcolor{comment}{\#\ update}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00578}00578\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0ce6bcf4b6bd14d2f86872e94247cacd}{label\_files}}\ =\ img2label\_paths(cache.keys())\ \ \textcolor{comment}{\#\ update}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00579}00579\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00580}00580\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Filter\ images}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00581}00581\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ min\_items:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00582}00582\ \ \ \ \ \ \ \ \ \ \ \ \ include\ =\ np.array([len(x)\ >=\ min\_items\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{labels}}]).nonzero()[0].astype(int)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00583}00583\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}\{prefix\}\{n\ -\/\ len(include)\}/\{n\}\ images\ filtered\ from\ dataset"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00584}00584\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}}\ =\ [self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}}[i]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ include]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00585}00585\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0ce6bcf4b6bd14d2f86872e94247cacd}{label\_files}}\ =\ [self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0ce6bcf4b6bd14d2f86872e94247cacd}{label\_files}}[i]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ include]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00586}00586\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{labels}}\ =\ [self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{labels}}[i]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ include]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00587}00587\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a26a6a58e1558930199cd96b5dc4adfb8}{segments}}\ =\ [self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a26a6a58e1558930199cd96b5dc4adfb8}{segments}}[i]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ include]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00588}00588\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ac78ada45fce0dc8766c438edc4da8fb3}{shapes}}\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ac78ada45fce0dc8766c438edc4da8fb3}{shapes}}[include]\ \ \textcolor{comment}{\#\ wh}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00589}00589\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00590}00590\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Create\ indices}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00591}00591\ \ \ \ \ \ \ \ \ n\ =\ len(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ac78ada45fce0dc8766c438edc4da8fb3}{shapes}})\ \ \textcolor{comment}{\#\ number\ of\ images}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00592}00592\ \ \ \ \ \ \ \ \ bi\ =\ np.floor(np.arange(n)\ /\ batch\_size).astype(int)\ \ \textcolor{comment}{\#\ batch\ index}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00593}00593\ \ \ \ \ \ \ \ \ nb\ =\ bi[-\/1]\ +\ 1\ \ \textcolor{comment}{\#\ number\ of\ batches}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00594}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ac094011a6d5fbbd57684856d17ba8fa3}{00594}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ac094011a6d5fbbd57684856d17ba8fa3}{batch}}\ =\ bi\ \ \textcolor{comment}{\#\ batch\ index\ of\ image}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00595}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a18d2380cd9dbbfb97b9144fa61f0257f}{00595}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a18d2380cd9dbbfb97b9144fa61f0257f}{n}}\ =\ n}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00596}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a47a24fb55010b45e7e863834344ff809}{00596}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a47a24fb55010b45e7e863834344ff809}{indices}}\ =\ np.arange(n)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00597}00597\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ rank\ >\ -\/1:\ \ \textcolor{comment}{\#\ DDP\ indices\ (see:\ SmartDistributedSampler)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00598}00598\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ force\ each\ rank\ (i.e.\ GPU\ process)\ to\ sample\ the\ same\ subset\ of\ data\ on\ every\ epoch}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00599}00599\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a47a24fb55010b45e7e863834344ff809}{indices}}\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a47a24fb55010b45e7e863834344ff809}{indices}}[np.random.RandomState(seed=seed).permutation(n)\ \%\ WORLD\_SIZE\ ==\ RANK]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00600}00600\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00601}00601\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Update\ labels}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00602}00602\ \ \ \ \ \ \ \ \ include\_class\ =\ []\ \ \textcolor{comment}{\#\ filter\ labels\ to\ include\ only\ these\ classes\ (optional)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00603}00603\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a26a6a58e1558930199cd96b5dc4adfb8}{segments}}\ =\ list(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a26a6a58e1558930199cd96b5dc4adfb8}{segments}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00604}00604\ \ \ \ \ \ \ \ \ include\_class\_array\ =\ np.array(include\_class).reshape(1,\ -\/1)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00605}00605\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ (label,\ segment)\ \textcolor{keywordflow}{in}\ enumerate(zip(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{labels}},\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a26a6a58e1558930199cd96b5dc4adfb8}{segments}})):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00606}00606\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ include\_class:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00607}00607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ j\ =\ (label[:,\ 0:1]\ ==\ include\_class\_array).any(1)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00608}00608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{labels}}[i]\ =\ label[j]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00609}00609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ segment:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00610}00610\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a26a6a58e1558930199cd96b5dc4adfb8}{segments}}[i]\ =\ [segment[idx]\ \textcolor{keywordflow}{for}\ idx,\ elem\ \textcolor{keywordflow}{in}\ enumerate(j)\ \textcolor{keywordflow}{if}\ elem]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00611}00611\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ single\_cls:\ \ \textcolor{comment}{\#\ single-\/class\ training,\ merge\ all\ classes\ into\ 0}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00612}00612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{labels}}[i][:,\ 0]\ =\ 0}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00613}00613\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00614}00614\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Rectangular\ Training}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00615}00615\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8ee5d25bf251c3f9876adb21db5c04d0}{rect}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00616}00616\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Sort\ by\ aspect\ ratio}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00617}00617\ \ \ \ \ \ \ \ \ \ \ \ \ s\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ac78ada45fce0dc8766c438edc4da8fb3}{shapes}}\ \ \textcolor{comment}{\#\ wh}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00618}00618\ \ \ \ \ \ \ \ \ \ \ \ \ ar\ =\ s[:,\ 1]\ /\ s[:,\ 0]\ \ \textcolor{comment}{\#\ aspect\ ratio}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00619}00619\ \ \ \ \ \ \ \ \ \ \ \ \ irect\ =\ ar.argsort()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00620}00620\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}}\ =\ [self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}}[i]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ irect]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00621}00621\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0ce6bcf4b6bd14d2f86872e94247cacd}{label\_files}}\ =\ [self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0ce6bcf4b6bd14d2f86872e94247cacd}{label\_files}}[i]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ irect]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00622}00622\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{labels}}\ =\ [self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{labels}}[i]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ irect]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00623}00623\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a26a6a58e1558930199cd96b5dc4adfb8}{segments}}\ =\ [self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a26a6a58e1558930199cd96b5dc4adfb8}{segments}}[i]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ irect]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00624}00624\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ac78ada45fce0dc8766c438edc4da8fb3}{shapes}}\ =\ s[irect]\ \ \textcolor{comment}{\#\ wh}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00625}00625\ \ \ \ \ \ \ \ \ \ \ \ \ ar\ =\ ar[irect]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00626}00626\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00627}00627\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Set\ training\ image\ shapes}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00628}00628\ \ \ \ \ \ \ \ \ \ \ \ \ shapes\ =\ [[1,\ 1]]\ *\ nb}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00629}00629\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(nb):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00630}00630\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ari\ =\ ar[bi\ ==\ i]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00631}00631\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mini,\ maxi\ =\ ari.min(),\ ari.max()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00632}00632\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ maxi\ <\ 1:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00633}00633\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ shapes[i]\ =\ [maxi,\ 1]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00634}00634\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ mini\ >\ 1:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00635}00635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ shapes[i]\ =\ [1,\ 1\ /\ mini]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00636}00636\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00637}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a63a772948a9add3d46a2a15d087b3c3d}{00637}}\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a63a772948a9add3d46a2a15d087b3c3d}{batch\_shapes}}\ =\ np.ceil(np.array(shapes)\ *\ img\_size\ /\ stride\ +\ pad).astype(int)\ *\ stride}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00638}00638\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00639}00639\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Cache\ images\ into\ RAM/disk\ for\ faster\ training}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00640}00640\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ cache\_images\ ==\ \textcolor{stringliteral}{"{}ram"{}}\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8125e04131e6f2508907618d42610f94}{check\_cache\_ram}}(prefix=prefix):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00641}00641\ \ \ \ \ \ \ \ \ \ \ \ \ cache\_images\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00642}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aa5ed0e8e4bbdb2939d09261978c917cb}{00642}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aa5ed0e8e4bbdb2939d09261978c917cb}{ims}}\ =\ [\textcolor{keywordtype}{None}]\ *\ n}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00643}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aecf870b5dadeb708567c7740087c57e7}{00643}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aecf870b5dadeb708567c7740087c57e7}{npy\_files}}\ =\ [Path(f).with\_suffix(\textcolor{stringliteral}{"{}.npy"{}})\ \textcolor{keywordflow}{for}\ f\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}}]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00644}00644\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ cache\_images:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00645}00645\ \ \ \ \ \ \ \ \ \ \ \ \ b,\ gb\ =\ 0,\ 1\ <<\ 30\ \ \textcolor{comment}{\#\ bytes\ of\ cached\ images,\ bytes\ per\ gigabytes}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00646}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8e7b8806a960bd7b4d66a53e2441f85e}{00646}}\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a216bfcd914c8fc83e50a223891057108}{im\_hw0}},\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8e7b8806a960bd7b4d66a53e2441f85e}{im\_hw}}\ =\ [\textcolor{keywordtype}{None}]\ *\ n,\ [\textcolor{keywordtype}{None}]\ *\ n}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00647}00647\ \ \ \ \ \ \ \ \ \ \ \ \ fcn\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aaea3ac121e523ee3c57b9f97f00ad68b}{cache\_images\_to\_disk}}\ \textcolor{keywordflow}{if}\ cache\_images\ ==\ \textcolor{stringliteral}{"{}disk"{}}\ \textcolor{keywordflow}{else}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ad7355c09718eacd1e94296447e55ea8a}{load\_image}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00648}00648\ \ \ \ \ \ \ \ \ \ \ \ \ results\ =\ ThreadPool(NUM\_THREADS).imap(\textcolor{keyword}{lambda}\ i:\ (i,\ fcn(i)),\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a47a24fb55010b45e7e863834344ff809}{indices}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00649}00649\ \ \ \ \ \ \ \ \ \ \ \ \ pbar\ =\ tqdm(results,\ total=len(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a47a24fb55010b45e7e863834344ff809}{indices}}),\ bar\_format=TQDM\_BAR\_FORMAT,\ disable=LOCAL\_RANK\ >\ 0)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00650}00650\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ x\ \textcolor{keywordflow}{in}\ pbar:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00651}00651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ cache\_images\ ==\ \textcolor{stringliteral}{"{}disk"{}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00652}00652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b\ +=\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aecf870b5dadeb708567c7740087c57e7}{npy\_files}}[i].stat().st\_size}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00653}00653\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:\ \ \textcolor{comment}{\#\ 'ram'}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00654}00654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aa5ed0e8e4bbdb2939d09261978c917cb}{ims}}[i],\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a216bfcd914c8fc83e50a223891057108}{im\_hw0}}[i],\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8e7b8806a960bd7b4d66a53e2441f85e}{im\_hw}}[i]\ =\ x\ \ \textcolor{comment}{\#\ im,\ hw\_orig,\ hw\_resized\ =\ load\_image(self,\ i)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00655}00655\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b\ +=\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aa5ed0e8e4bbdb2939d09261978c917cb}{ims}}[i].nbytes\ *\ WORLD\_SIZE}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00656}00656\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pbar.desc\ =\ f\textcolor{stringliteral}{"{}\{prefix\}Caching\ images\ (\{b\ /\ gb:.1f\}GB\ \{cache\_images\})"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00657}00657\ \ \ \ \ \ \ \ \ \ \ \ \ pbar.close()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00658}00658\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00659}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8125e04131e6f2508907618d42610f94}{00659}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8125e04131e6f2508907618d42610f94}{check\_cache\_ram}}(self,\ safety\_margin=0.1,\ prefix="{}"{}):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00660}00660\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Check\ image\ caching\ requirements\ vs\ available\ memory}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00661}00661\ \ \ \ \ \ \ \ \ b,\ gb\ =\ 0,\ 1\ <<\ 30\ \ \textcolor{comment}{\#\ bytes\ of\ cached\ images,\ bytes\ per\ gigabytes}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00662}00662\ \ \ \ \ \ \ \ \ n\ =\ min(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a18d2380cd9dbbfb97b9144fa61f0257f}{n}},\ 30)\ \ \textcolor{comment}{\#\ extrapolate\ from\ 30\ random\ images}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00663}00663\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ \_\ \textcolor{keywordflow}{in}\ range(n):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00664}00664\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ cv2.imread(random.choice(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}}))\ \ \textcolor{comment}{\#\ sample\ image}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00665}00665\ \ \ \ \ \ \ \ \ \ \ \ \ ratio\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aaf2b9425db6c2fd723025393e181d3e3}{img\_size}}\ /\ max(im.shape[0],\ im.shape[1])\ \ \textcolor{comment}{\#\ max(h,\ w)\ \ \#\ ratio}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00666}00666\ \ \ \ \ \ \ \ \ \ \ \ \ b\ +=\ im.nbytes\ *\ ratio**2}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00667}00667\ \ \ \ \ \ \ \ \ mem\_required\ =\ b\ *\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a18d2380cd9dbbfb97b9144fa61f0257f}{n}}\ /\ n\ \ \textcolor{comment}{\#\ GB\ required\ to\ cache\ dataset\ into\ RAM}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00668}00668\ \ \ \ \ \ \ \ \ mem\ =\ psutil.virtual\_memory()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00669}00669\ \ \ \ \ \ \ \ \ cache\ =\ mem\_required\ *\ (1\ +\ safety\_margin)\ <\ mem.available\ \ \textcolor{comment}{\#\ to\ cache\ or\ not\ to\ cache,\ that\ is\ the\ question}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00670}00670\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ cache:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00671}00671\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00672}00672\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{'\{prefix\}\{mem\_required\ /\ gb:.1f\}GB\ RAM\ required,\ '}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00673}00673\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{'\{mem.available\ /\ gb:.1f\}/\{mem.total\ /\ gb:.1f\}GB\ available,\ '}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00674}00674\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}\{'caching\ images\ ✅'\ if\ cache\ else\ 'not\ caching\ images\ ⚠️'\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00675}00675\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00676}00676\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ cache}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00677}00677\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00678}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ae10e1aed6b82eb11604e6c1f39d23909}{00678}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ae10e1aed6b82eb11604e6c1f39d23909}{cache\_labels}}(self,\ path=Path(\textcolor{stringliteral}{"{}./labels.cache"{}}),\ prefix=\textcolor{stringliteral}{"{}"{}}):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00679}00679\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Cache\ dataset\ labels,\ check\ images\ and\ read\ shapes}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00680}00680\ \ \ \ \ \ \ \ \ x\ =\ \{\}\ \ \textcolor{comment}{\#\ dict}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00681}00681\ \ \ \ \ \ \ \ \ nm,\ nf,\ ne,\ nc,\ msgs\ =\ 0,\ 0,\ 0,\ 0,\ []\ \ \textcolor{comment}{\#\ number\ missing,\ found,\ empty,\ corrupt,\ messages}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00682}00682\ \ \ \ \ \ \ \ \ desc\ =\ f\textcolor{stringliteral}{"{}\{prefix\}Scanning\ \{path.parent\ /\ path.stem\}..."{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00683}00683\ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ Pool(NUM\_THREADS)\ \textcolor{keyword}{as}\ pool:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00684}00684\ \ \ \ \ \ \ \ \ \ \ \ \ pbar\ =\ tqdm(}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00685}00685\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pool.imap(verify\_image\_label,\ zip(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}},\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0ce6bcf4b6bd14d2f86872e94247cacd}{label\_files}},\ repeat(prefix))),}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00686}00686\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ desc=desc,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00687}00687\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ total=len(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}}),}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00688}00688\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bar\_format=TQDM\_BAR\_FORMAT,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00689}00689\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00690}00690\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ im\_file,\ lb,\ shape,\ segments,\ nm\_f,\ nf\_f,\ ne\_f,\ nc\_f,\ msg\ \textcolor{keywordflow}{in}\ pbar:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00691}00691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nm\ +=\ nm\_f}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00692}00692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nf\ +=\ nf\_f}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00693}00693\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ne\ +=\ ne\_f}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00694}00694\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nc\ +=\ nc\_f}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00695}00695\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ im\_file:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00696}00696\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x[im\_file]\ =\ [lb,\ shape,\ segments]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00697}00697\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ msg:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00698}00698\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ msgs.append(msg)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00699}00699\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pbar.desc\ =\ f\textcolor{stringliteral}{"{}\{desc\}\ \{nf\}\ images,\ \{nm\ +\ ne\}\ backgrounds,\ \{nc\}\ corrupt"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00700}00700\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00701}00701\ \ \ \ \ \ \ \ \ pbar.close()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00702}00702\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ msgs:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00703}00703\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(\textcolor{stringliteral}{"{}\(\backslash\)n"{}}.join(msgs))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00704}00704\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ nf\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00705}00705\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.warning(f\textcolor{stringliteral}{"{}\{prefix\}WARNING\ ⚠️\ No\ labels\ found\ in\ \{path\}.\ \{HELP\_URL\}"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00706}00706\ \ \ \ \ \ \ \ \ x[\textcolor{stringliteral}{"{}hash"{}}]\ =\ \mbox{\hyperlink{namespaceutils_1_1dataloaders_a040e2e64822c6005809f7923a69f9df6}{get\_hash}}(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a0ce6bcf4b6bd14d2f86872e94247cacd}{label\_files}}\ +\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00707}00707\ \ \ \ \ \ \ \ \ x[\textcolor{stringliteral}{"{}results"{}}]\ =\ nf,\ nm,\ ne,\ nc,\ len(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00708}00708\ \ \ \ \ \ \ \ \ x[\textcolor{stringliteral}{"{}msgs"{}}]\ =\ msgs\ \ \textcolor{comment}{\#\ warnings}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00709}00709\ \ \ \ \ \ \ \ \ x[\textcolor{stringliteral}{"{}version"{}}]\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_af231f2f5a372a07e61d40f60c45267b5}{cache\_version}}\ \ \textcolor{comment}{\#\ cache\ version}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00710}00710\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00711}00711\ \ \ \ \ \ \ \ \ \ \ \ \ np.save(path,\ x)\ \ \textcolor{comment}{\#\ save\ cache\ for\ next\ time}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00712}00712\ \ \ \ \ \ \ \ \ \ \ \ \ path.with\_suffix(\textcolor{stringliteral}{"{}.cache.npy"{}}).rename(path)\ \ \textcolor{comment}{\#\ remove\ .npy\ suffix}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00713}00713\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}\{prefix\}New\ cache\ created:\ \{path\}"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00714}00714\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00715}00715\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.warning(f\textcolor{stringliteral}{"{}\{prefix\}WARNING\ ⚠️\ Cache\ directory\ \{path.parent\}\ is\ not\ writeable:\ \{e\}"{}})\ \ \textcolor{comment}{\#\ not\ writeable}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00716}00716\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ x}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00717}00717\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00718}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ae8545167bde95c851a4539c5a7f0a8ed}{00718}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ae8545167bde95c851a4539c5a7f0a8ed}{\_\_len\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00719}00719\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ len(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00720}00720\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00721}00721\ \ \ \ \ \textcolor{comment}{\#\ def\ \_\_iter\_\_(self):}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00722}00722\ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ self.count\ =\ -\/1}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00723}00723\ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ print('ran\ dataset\ iter')}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00724}00724\ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ \#self.shuffled\_vector\ =\ np.random.permutation(self.nF)\ if\ self.augment\ else\ np.arange(self.nF)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00725}00725\ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ return\ self}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00726}00726\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00727}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ab9a607c69c53e268e55684a8f9a65f63}{00727}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ab9a607c69c53e268e55684a8f9a65f63}{\_\_getitem\_\_}}(self,\ index):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00728}00728\ \ \ \ \ \ \ \ \ index\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a47a24fb55010b45e7e863834344ff809}{indices}}[index]\ \ \textcolor{comment}{\#\ linear,\ shuffled,\ or\ image\_weights}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00729}00729\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00730}00730\ \ \ \ \ \ \ \ \ hyp\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00731}00731\ \ \ \ \ \ \ \ \ mosaic\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aecad2b4b731326aa073b5cdaaaa42c87}{mosaic}}\ \textcolor{keywordflow}{and}\ random.random()\ <\ hyp[\textcolor{stringliteral}{"{}mosaic"{}}]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00732}00732\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ mosaic:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00733}00733\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Load\ mosaic}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00734}00734\ \ \ \ \ \ \ \ \ \ \ \ \ img,\ labels\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a6610f7b878a6088e3c476b9dde13c85d}{load\_mosaic}}(index)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00735}00735\ \ \ \ \ \ \ \ \ \ \ \ \ shapes\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00736}00736\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00737}00737\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ MixUp\ augmentation}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00738}00738\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ random.random()\ <\ hyp[\textcolor{stringliteral}{"{}mixup"{}}]:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00739}00739\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ img,\ labels\ =\ mixup(img,\ labels,\ *self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a6610f7b878a6088e3c476b9dde13c85d}{load\_mosaic}}(random.choice(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a47a24fb55010b45e7e863834344ff809}{indices}})))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00740}00740\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00741}00741\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00742}00742\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Load\ image}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00743}00743\ \ \ \ \ \ \ \ \ \ \ \ \ img,\ (h0,\ w0),\ (h,\ w)\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ad7355c09718eacd1e94296447e55ea8a}{load\_image}}(index)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00744}00744\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00745}00745\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Letterbox}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00746}00746\ \ \ \ \ \ \ \ \ \ \ \ \ shape\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a63a772948a9add3d46a2a15d087b3c3d}{batch\_shapes}}[self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ac094011a6d5fbbd57684856d17ba8fa3}{batch}}[index]]\ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8ee5d25bf251c3f9876adb21db5c04d0}{rect}}\ \textcolor{keywordflow}{else}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aaf2b9425db6c2fd723025393e181d3e3}{img\_size}}\ \ \textcolor{comment}{\#\ final\ letterboxed\ shape}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00747}00747\ \ \ \ \ \ \ \ \ \ \ \ \ img,\ ratio,\ pad\ =\ letterbox(img,\ shape,\ auto=\textcolor{keyword}{False},\ scaleup=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_afe3013a59e9113d4007d92d3927c8235}{augment}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00748}00748\ \ \ \ \ \ \ \ \ \ \ \ \ shapes\ =\ (h0,\ w0),\ ((h\ /\ h0,\ w\ /\ w0),\ pad)\ \ \textcolor{comment}{\#\ for\ COCO\ mAP\ rescaling}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00749}00749\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00750}00750\ \ \ \ \ \ \ \ \ \ \ \ \ labels\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{labels}}[index].copy()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00751}00751\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ labels.size:\ \ \textcolor{comment}{\#\ normalized\ xywh\ to\ pixel\ xyxy\ format}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00752}00752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ labels[:,\ 1:]\ =\ xywhn2xyxy(labels[:,\ 1:],\ ratio[0]\ *\ w,\ ratio[1]\ *\ h,\ padw=pad[0],\ padh=pad[1])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00753}00753\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00754}00754\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_afe3013a59e9113d4007d92d3927c8235}{augment}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00755}00755\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ img,\ labels\ =\ random\_perspective(}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00756}00756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ img,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00757}00757\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ labels,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00758}00758\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ degrees=hyp[\textcolor{stringliteral}{"{}degrees"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00759}00759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ translate=hyp[\textcolor{stringliteral}{"{}translate"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00760}00760\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ scale=hyp[\textcolor{stringliteral}{"{}scale"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00761}00761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ shear=hyp[\textcolor{stringliteral}{"{}shear"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00762}00762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ perspective=hyp[\textcolor{stringliteral}{"{}perspective"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00763}00763\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00764}00764\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00765}00765\ \ \ \ \ \ \ \ \ nl\ =\ len(labels)\ \ \textcolor{comment}{\#\ number\ of\ labels}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00766}00766\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ nl:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00767}00767\ \ \ \ \ \ \ \ \ \ \ \ \ labels[:,\ 1:5]\ =\ xyxy2xywhn(labels[:,\ 1:5],\ w=img.shape[1],\ h=img.shape[0],\ clip=\textcolor{keyword}{True},\ eps=1e-\/3)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00768}00768\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00769}00769\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_afe3013a59e9113d4007d92d3927c8235}{augment}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00770}00770\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Albumentations}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00771}00771\ \ \ \ \ \ \ \ \ \ \ \ \ img,\ labels\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a14b38a3ab35f3ae18690d1e26c8019a6}{albumentations}}(img,\ labels)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00772}00772\ \ \ \ \ \ \ \ \ \ \ \ \ nl\ =\ len(labels)\ \ \textcolor{comment}{\#\ update\ after\ albumentations}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00773}00773\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00774}00774\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ HSV\ color-\/space}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00775}00775\ \ \ \ \ \ \ \ \ \ \ \ \ augment\_hsv(img,\ hgain=hyp[\textcolor{stringliteral}{"{}hsv\_h"{}}],\ sgain=hyp[\textcolor{stringliteral}{"{}hsv\_s"{}}],\ vgain=hyp[\textcolor{stringliteral}{"{}hsv\_v"{}}])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00776}00776\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00777}00777\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Flip\ up-\/down}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00778}00778\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ random.random()\ <\ hyp[\textcolor{stringliteral}{"{}flipud"{}}]:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00779}00779\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ img\ =\ np.flipud(img)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00780}00780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ nl:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00781}00781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ labels[:,\ 2]\ =\ 1\ -\/\ labels[:,\ 2]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00782}00782\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00783}00783\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Flip\ left-\/right}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00784}00784\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ random.random()\ <\ hyp[\textcolor{stringliteral}{"{}fliplr"{}}]:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00785}00785\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ img\ =\ np.fliplr(img)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00786}00786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ nl:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00787}00787\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ labels[:,\ 1]\ =\ 1\ -\/\ labels[:,\ 1]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00788}00788\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00789}00789\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Cutouts}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00790}00790\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ labels\ =\ cutout(img,\ labels,\ p=0.5)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00791}00791\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ nl\ =\ len(labels)\ \ \#\ update\ after\ cutout}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00792}00792\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00793}00793\ \ \ \ \ \ \ \ \ labels\_out\ =\ torch.zeros((nl,\ 6))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00794}00794\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ nl:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00795}00795\ \ \ \ \ \ \ \ \ \ \ \ \ labels\_out[:,\ 1:]\ =\ torch.from\_numpy(labels)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00796}00796\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00797}00797\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Convert}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00798}00798\ \ \ \ \ \ \ \ \ img\ =\ img.transpose((2,\ 0,\ 1))[::-\/1]\ \ \textcolor{comment}{\#\ HWC\ to\ CHW,\ BGR\ to\ RGB}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00799}00799\ \ \ \ \ \ \ \ \ img\ =\ np.ascontiguousarray(img)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00800}00800\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00801}00801\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ torch.from\_numpy(img),\ labels\_out,\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}}[index],\ shapes}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00802}00802\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00803}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ad7355c09718eacd1e94296447e55ea8a}{00803}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ad7355c09718eacd1e94296447e55ea8a}{load\_image}}(self,\ i):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00804}00804\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Loads\ 1\ image\ from\ dataset\ index\ 'i',\ returns\ (im,\ original\ hw,\ resized\ hw)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00805}00805\ \ \ \ \ \ \ \ \ im,\ f,\ fn\ =\ (}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00806}00806\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aa5ed0e8e4bbdb2939d09261978c917cb}{ims}}[i],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00807}00807\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}}[i],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00808}00808\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aecf870b5dadeb708567c7740087c57e7}{npy\_files}}[i],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00809}00809\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00810}00810\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ im\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:\ \ \textcolor{comment}{\#\ not\ cached\ in\ RAM}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00811}00811\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ fn.exists():\ \ \textcolor{comment}{\#\ load\ npy}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00812}00812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ np.load(fn)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00813}00813\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:\ \ \textcolor{comment}{\#\ read\ image}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00814}00814\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ cv2.imread(f)\ \ \textcolor{comment}{\#\ BGR}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00815}00815\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ im\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ f\textcolor{stringliteral}{"{}Image\ Not\ Found\ \{f\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00816}00816\ \ \ \ \ \ \ \ \ \ \ \ \ h0,\ w0\ =\ im.shape[:2]\ \ \textcolor{comment}{\#\ orig\ hw}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00817}00817\ \ \ \ \ \ \ \ \ \ \ \ \ r\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aaf2b9425db6c2fd723025393e181d3e3}{img\_size}}\ /\ max(h0,\ w0)\ \ \textcolor{comment}{\#\ ratio}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00818}00818\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ r\ !=\ 1:\ \ \textcolor{comment}{\#\ if\ sizes\ are\ not\ equal}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00819}00819\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interp\ =\ cv2.INTER\_LINEAR\ \textcolor{keywordflow}{if}\ (self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_afe3013a59e9113d4007d92d3927c8235}{augment}}\ \textcolor{keywordflow}{or}\ r\ >\ 1)\ \textcolor{keywordflow}{else}\ cv2.INTER\_AREA}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00820}00820\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ cv2.resize(im,\ (math.ceil(w0\ *\ r),\ math.ceil(h0\ *\ r)),\ interpolation=interp)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00821}00821\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ im,\ (h0,\ w0),\ im.shape[:2]\ \ \textcolor{comment}{\#\ im,\ hw\_original,\ hw\_resized}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00822}00822\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aa5ed0e8e4bbdb2939d09261978c917cb}{ims}}[i],\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a216bfcd914c8fc83e50a223891057108}{im\_hw0}}[i],\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a8e7b8806a960bd7b4d66a53e2441f85e}{im\_hw}}[i]\ \ \textcolor{comment}{\#\ im,\ hw\_original,\ hw\_resized}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00823}00823\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00824}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aaea3ac121e523ee3c57b9f97f00ad68b}{00824}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aaea3ac121e523ee3c57b9f97f00ad68b}{cache\_images\_to\_disk}}(self,\ i):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00825}00825\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Saves\ an\ image\ as\ an\ *.npy\ file\ for\ faster\ loading}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00826}00826\ \ \ \ \ \ \ \ \ f\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aecf870b5dadeb708567c7740087c57e7}{npy\_files}}[i]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00827}00827\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ f.exists():}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00828}00828\ \ \ \ \ \ \ \ \ \ \ \ \ np.save(f.as\_posix(),\ cv2.imread(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_adac320e6aa8d3e54823489f6826433d3}{im\_files}}[i]))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00829}00829\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00830}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a6610f7b878a6088e3c476b9dde13c85d}{00830}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a6610f7b878a6088e3c476b9dde13c85d}{load\_mosaic}}(self,\ index):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00831}00831\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ YOLOv5\ 4-\/mosaic\ loader.\ Loads\ 1\ image\ +\ 3\ random\ images\ into\ a\ 4-\/image\ mosaic}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00832}00832\ \ \ \ \ \ \ \ \ labels4,\ segments4\ =\ [],\ []}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00833}00833\ \ \ \ \ \ \ \ \ s\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aaf2b9425db6c2fd723025393e181d3e3}{img\_size}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00834}00834\ \ \ \ \ \ \ \ \ yc,\ xc\ =\ (int(random.uniform(-\/x,\ 2\ *\ s\ +\ x))\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a2ae5dfa3541d182ab5a3b5d559ec2f5b}{mosaic\_border}})\ \ \textcolor{comment}{\#\ mosaic\ center\ x,\ y}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00835}00835\ \ \ \ \ \ \ \ \ indices\ =\ [index]\ +\ random.choices(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a47a24fb55010b45e7e863834344ff809}{indices}},\ k=3)\ \ \textcolor{comment}{\#\ 3\ additional\ image\ indices}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00836}00836\ \ \ \ \ \ \ \ \ random.shuffle(indices)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00837}00837\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ index\ \textcolor{keywordflow}{in}\ enumerate(indices):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00838}00838\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Load\ image}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00839}00839\ \ \ \ \ \ \ \ \ \ \ \ \ img,\ \_,\ (h,\ w)\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ad7355c09718eacd1e94296447e55ea8a}{load\_image}}(index)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00840}00840\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00841}00841\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ place\ img\ in\ img4}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00842}00842\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ i\ ==\ 0:\ \ \textcolor{comment}{\#\ top\ left}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00843}00843\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ img4\ =\ np.full((s\ *\ 2,\ s\ *\ 2,\ img.shape[2]),\ 114,\ dtype=np.uint8)\ \ \textcolor{comment}{\#\ base\ image\ with\ 4\ tiles}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00844}00844\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x1a,\ y1a,\ x2a,\ y2a\ =\ max(xc\ -\/\ w,\ 0),\ max(yc\ -\/\ h,\ 0),\ xc,\ yc\ \ \textcolor{comment}{\#\ xmin,\ ymin,\ xmax,\ ymax\ (large\ image)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00845}00845\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x1b,\ y1b,\ x2b,\ y2b\ =\ w\ -\/\ (x2a\ -\/\ x1a),\ h\ -\/\ (y2a\ -\/\ y1a),\ w,\ h\ \ \textcolor{comment}{\#\ xmin,\ ymin,\ xmax,\ ymax\ (small\ image)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00846}00846\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ i\ ==\ 1:\ \ \textcolor{comment}{\#\ top\ right}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00847}00847\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x1a,\ y1a,\ x2a,\ y2a\ =\ xc,\ max(yc\ -\/\ h,\ 0),\ min(xc\ +\ w,\ s\ *\ 2),\ yc}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00848}00848\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x1b,\ y1b,\ x2b,\ y2b\ =\ 0,\ h\ -\/\ (y2a\ -\/\ y1a),\ min(w,\ x2a\ -\/\ x1a),\ h}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00849}00849\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ i\ ==\ 2:\ \ \textcolor{comment}{\#\ bottom\ left}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00850}00850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x1a,\ y1a,\ x2a,\ y2a\ =\ max(xc\ -\/\ w,\ 0),\ yc,\ xc,\ min(s\ *\ 2,\ yc\ +\ h)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00851}00851\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x1b,\ y1b,\ x2b,\ y2b\ =\ w\ -\/\ (x2a\ -\/\ x1a),\ 0,\ w,\ min(y2a\ -\/\ y1a,\ h)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00852}00852\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ i\ ==\ 3:\ \ \textcolor{comment}{\#\ bottom\ right}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00853}00853\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x1a,\ y1a,\ x2a,\ y2a\ =\ xc,\ yc,\ min(xc\ +\ w,\ s\ *\ 2),\ min(s\ *\ 2,\ yc\ +\ h)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00854}00854\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x1b,\ y1b,\ x2b,\ y2b\ =\ 0,\ 0,\ min(w,\ x2a\ -\/\ x1a),\ min(y2a\ -\/\ y1a,\ h)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00855}00855\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00856}00856\ \ \ \ \ \ \ \ \ \ \ \ \ img4[y1a:y2a,\ x1a:x2a]\ =\ img[y1b:y2b,\ x1b:x2b]\ \ \textcolor{comment}{\#\ img4[ymin:ymax,\ xmin:xmax]}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00857}00857\ \ \ \ \ \ \ \ \ \ \ \ \ padw\ =\ x1a\ -\/\ x1b}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00858}00858\ \ \ \ \ \ \ \ \ \ \ \ \ padh\ =\ y1a\ -\/\ y1b}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00859}00859\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00860}00860\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Labels}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00861}00861\ \ \ \ \ \ \ \ \ \ \ \ \ labels,\ segments\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{labels}}[index].copy(),\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a26a6a58e1558930199cd96b5dc4adfb8}{segments}}[index].copy()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00862}00862\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ labels.size:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00863}00863\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ labels[:,\ 1:]\ =\ xywhn2xyxy(labels[:,\ 1:],\ w,\ h,\ padw,\ padh)\ \ \textcolor{comment}{\#\ normalized\ xywh\ to\ pixel\ xyxy\ format}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00864}00864\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segments\ =\ [xyn2xy(x,\ w,\ h,\ padw,\ padh)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ segments]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00865}00865\ \ \ \ \ \ \ \ \ \ \ \ \ labels4.append(labels)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00866}00866\ \ \ \ \ \ \ \ \ \ \ \ \ segments4.extend(segments)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00867}00867\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00868}00868\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Concat/clip\ labels}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00869}00869\ \ \ \ \ \ \ \ \ labels4\ =\ np.concatenate(labels4,\ 0)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00870}00870\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ (labels4[:,\ 1:],\ *segments4):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00871}00871\ \ \ \ \ \ \ \ \ \ \ \ \ np.clip(x,\ 0,\ 2\ *\ s,\ out=x)\ \ \textcolor{comment}{\#\ clip\ when\ using\ random\_perspective()}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00872}00872\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ img4,\ labels4\ =\ replicate(img4,\ labels4)\ \ \#\ replicate}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00873}00873\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00874}00874\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Augment}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00875}00875\ \ \ \ \ \ \ \ \ img4,\ labels4,\ segments4\ =\ copy\_paste(img4,\ labels4,\ segments4,\ p=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}[\textcolor{stringliteral}{"{}copy\_paste"{}}])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00876}00876\ \ \ \ \ \ \ \ \ img4,\ labels4\ =\ random\_perspective(}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00877}00877\ \ \ \ \ \ \ \ \ \ \ \ \ img4,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00878}00878\ \ \ \ \ \ \ \ \ \ \ \ \ labels4,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00879}00879\ \ \ \ \ \ \ \ \ \ \ \ \ segments4,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00880}00880\ \ \ \ \ \ \ \ \ \ \ \ \ degrees=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}[\textcolor{stringliteral}{"{}degrees"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00881}00881\ \ \ \ \ \ \ \ \ \ \ \ \ translate=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}[\textcolor{stringliteral}{"{}translate"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00882}00882\ \ \ \ \ \ \ \ \ \ \ \ \ scale=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}[\textcolor{stringliteral}{"{}scale"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00883}00883\ \ \ \ \ \ \ \ \ \ \ \ \ shear=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}[\textcolor{stringliteral}{"{}shear"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00884}00884\ \ \ \ \ \ \ \ \ \ \ \ \ perspective=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}[\textcolor{stringliteral}{"{}perspective"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00885}00885\ \ \ \ \ \ \ \ \ \ \ \ \ border=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a2ae5dfa3541d182ab5a3b5d559ec2f5b}{mosaic\_border}},}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00886}00886\ \ \ \ \ \ \ \ \ )\ \ \textcolor{comment}{\#\ border\ to\ remove}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00887}00887\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00888}00888\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ img4,\ labels4}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00889}00889\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00890}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a156fbc1a6ccab1ee4c998e7a4f7cf8d0}{00890}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a156fbc1a6ccab1ee4c998e7a4f7cf8d0}{load\_mosaic9}}(self,\ index):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00891}00891\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ YOLOv5\ 9-\/mosaic\ loader.\ Loads\ 1\ image\ +\ 8\ random\ images\ into\ a\ 9-\/image\ mosaic}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00892}00892\ \ \ \ \ \ \ \ \ labels9,\ segments9\ =\ [],\ []}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00893}00893\ \ \ \ \ \ \ \ \ s\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_aaf2b9425db6c2fd723025393e181d3e3}{img\_size}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00894}00894\ \ \ \ \ \ \ \ \ indices\ =\ [index]\ +\ random.choices(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a47a24fb55010b45e7e863834344ff809}{indices}},\ k=8)\ \ \textcolor{comment}{\#\ 8\ additional\ image\ indices}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00895}00895\ \ \ \ \ \ \ \ \ random.shuffle(indices)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00896}00896\ \ \ \ \ \ \ \ \ hp,\ wp\ =\ -\/1,\ -\/1\ \ \textcolor{comment}{\#\ height,\ width\ previous}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00897}00897\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ index\ \textcolor{keywordflow}{in}\ enumerate(indices):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00898}00898\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Load\ image}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00899}00899\ \ \ \ \ \ \ \ \ \ \ \ \ img,\ \_,\ (h,\ w)\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_ad7355c09718eacd1e94296447e55ea8a}{load\_image}}(index)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00900}00900\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00901}00901\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ place\ img\ in\ img9}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00902}00902\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ i\ ==\ 0:\ \ \textcolor{comment}{\#\ center}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00903}00903\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ img9\ =\ np.full((s\ *\ 3,\ s\ *\ 3,\ img.shape[2]),\ 114,\ dtype=np.uint8)\ \ \textcolor{comment}{\#\ base\ image\ with\ 4\ tiles}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00904}00904\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ h0,\ w0\ =\ h,\ w}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00905}00905\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ c\ =\ s,\ s,\ s\ +\ w,\ s\ +\ h\ \ \textcolor{comment}{\#\ xmin,\ ymin,\ xmax,\ ymax\ (base)\ coordinates}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00906}00906\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ i\ ==\ 1:\ \ \textcolor{comment}{\#\ top}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00907}00907\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ c\ =\ s,\ s\ -\/\ h,\ s\ +\ w,\ s}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00908}00908\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ i\ ==\ 2:\ \ \textcolor{comment}{\#\ top\ right}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00909}00909\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ c\ =\ s\ +\ wp,\ s\ -\/\ h,\ s\ +\ wp\ +\ w,\ s}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00910}00910\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ i\ ==\ 3:\ \ \textcolor{comment}{\#\ right}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00911}00911\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ c\ =\ s\ +\ w0,\ s,\ s\ +\ w0\ +\ w,\ s\ +\ h}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00912}00912\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ i\ ==\ 4:\ \ \textcolor{comment}{\#\ bottom\ right}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00913}00913\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ c\ =\ s\ +\ w0,\ s\ +\ hp,\ s\ +\ w0\ +\ w,\ s\ +\ hp\ +\ h}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00914}00914\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ i\ ==\ 5:\ \ \textcolor{comment}{\#\ bottom}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00915}00915\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ c\ =\ s\ +\ w0\ -\/\ w,\ s\ +\ h0,\ s\ +\ w0,\ s\ +\ h0\ +\ h}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00916}00916\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ i\ ==\ 6:\ \ \textcolor{comment}{\#\ bottom\ left}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00917}00917\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ c\ =\ s\ +\ w0\ -\/\ wp\ -\/\ w,\ s\ +\ h0,\ s\ +\ w0\ -\/\ wp,\ s\ +\ h0\ +\ h}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00918}00918\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ i\ ==\ 7:\ \ \textcolor{comment}{\#\ left}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00919}00919\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ c\ =\ s\ -\/\ w,\ s\ +\ h0\ -\/\ h,\ s,\ s\ +\ h0}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00920}00920\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ i\ ==\ 8:\ \ \textcolor{comment}{\#\ top\ left}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00921}00921\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ c\ =\ s\ -\/\ w,\ s\ +\ h0\ -\/\ hp\ -\/\ h,\ s,\ s\ +\ h0\ -\/\ hp}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00922}00922\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00923}00923\ \ \ \ \ \ \ \ \ \ \ \ \ padx,\ pady\ =\ c[:2]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00924}00924\ \ \ \ \ \ \ \ \ \ \ \ \ x1,\ y1,\ x2,\ y2\ =\ (max(x,\ 0)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ c)\ \ \textcolor{comment}{\#\ allocate\ coords}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00925}00925\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00926}00926\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Labels}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00927}00927\ \ \ \ \ \ \ \ \ \ \ \ \ labels,\ segments\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a843c4c56e009b9d10da92c54324d5888}{labels}}[index].copy(),\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a26a6a58e1558930199cd96b5dc4adfb8}{segments}}[index].copy()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00928}00928\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ labels.size:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00929}00929\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ labels[:,\ 1:]\ =\ xywhn2xyxy(labels[:,\ 1:],\ w,\ h,\ padx,\ pady)\ \ \textcolor{comment}{\#\ normalized\ xywh\ to\ pixel\ xyxy\ format}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00930}00930\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segments\ =\ [xyn2xy(x,\ w,\ h,\ padx,\ pady)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ segments]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00931}00931\ \ \ \ \ \ \ \ \ \ \ \ \ labels9.append(labels)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00932}00932\ \ \ \ \ \ \ \ \ \ \ \ \ segments9.extend(segments)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00933}00933\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00934}00934\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Image}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00935}00935\ \ \ \ \ \ \ \ \ \ \ \ \ img9[y1:y2,\ x1:x2]\ =\ img[y1\ -\/\ pady\ :,\ x1\ -\/\ padx\ :]\ \ \textcolor{comment}{\#\ img9[ymin:ymax,\ xmin:xmax]}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00936}00936\ \ \ \ \ \ \ \ \ \ \ \ \ hp,\ wp\ =\ h,\ w\ \ \textcolor{comment}{\#\ height,\ width\ previous}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00937}00937\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00938}00938\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Offset}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00939}00939\ \ \ \ \ \ \ \ \ yc,\ xc\ =\ (int(random.uniform(0,\ s))\ \textcolor{keywordflow}{for}\ \_\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a2ae5dfa3541d182ab5a3b5d559ec2f5b}{mosaic\_border}})\ \ \textcolor{comment}{\#\ mosaic\ center\ x,\ y}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00940}00940\ \ \ \ \ \ \ \ \ img9\ =\ img9[yc\ :\ yc\ +\ 2\ *\ s,\ xc\ :\ xc\ +\ 2\ *\ s]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00941}00941\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00942}00942\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Concat/clip\ labels}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00943}00943\ \ \ \ \ \ \ \ \ labels9\ =\ np.concatenate(labels9,\ 0)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00944}00944\ \ \ \ \ \ \ \ \ labels9[:,\ [1,\ 3]]\ -\/=\ xc}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00945}00945\ \ \ \ \ \ \ \ \ labels9[:,\ [2,\ 4]]\ -\/=\ yc}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00946}00946\ \ \ \ \ \ \ \ \ c\ =\ np.array([xc,\ yc])\ \ \textcolor{comment}{\#\ centers}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00947}00947\ \ \ \ \ \ \ \ \ segments9\ =\ [x\ -\/\ c\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ segments9]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00948}00948\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00949}00949\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ (labels9[:,\ 1:],\ *segments9):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00950}00950\ \ \ \ \ \ \ \ \ \ \ \ \ np.clip(x,\ 0,\ 2\ *\ s,\ out=x)\ \ \textcolor{comment}{\#\ clip\ when\ using\ random\_perspective()}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00951}00951\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ img9,\ labels9\ =\ replicate(img9,\ labels9)\ \ \#\ replicate}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00952}00952\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00953}00953\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Augment}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00954}00954\ \ \ \ \ \ \ \ \ img9,\ labels9,\ segments9\ =\ copy\_paste(img9,\ labels9,\ segments9,\ p=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}[\textcolor{stringliteral}{"{}copy\_paste"{}}])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00955}00955\ \ \ \ \ \ \ \ \ img9,\ labels9\ =\ random\_perspective(}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00956}00956\ \ \ \ \ \ \ \ \ \ \ \ \ img9,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00957}00957\ \ \ \ \ \ \ \ \ \ \ \ \ labels9,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00958}00958\ \ \ \ \ \ \ \ \ \ \ \ \ segments9,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00959}00959\ \ \ \ \ \ \ \ \ \ \ \ \ degrees=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}[\textcolor{stringliteral}{"{}degrees"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00960}00960\ \ \ \ \ \ \ \ \ \ \ \ \ translate=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}[\textcolor{stringliteral}{"{}translate"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00961}00961\ \ \ \ \ \ \ \ \ \ \ \ \ scale=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}[\textcolor{stringliteral}{"{}scale"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00962}00962\ \ \ \ \ \ \ \ \ \ \ \ \ shear=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}[\textcolor{stringliteral}{"{}shear"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00963}00963\ \ \ \ \ \ \ \ \ \ \ \ \ perspective=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a623dff973188744bac4bd52ef483c0f1}{hyp}}[\textcolor{stringliteral}{"{}perspective"{}}],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00964}00964\ \ \ \ \ \ \ \ \ \ \ \ \ border=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a2ae5dfa3541d182ab5a3b5d559ec2f5b}{mosaic\_border}},}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00965}00965\ \ \ \ \ \ \ \ \ )\ \ \textcolor{comment}{\#\ border\ to\ remove}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00966}00966\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00967}00967\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ img9,\ labels9}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00968}00968\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00969}00969\ \ \ \ \ \textcolor{preprocessor}{@staticmethod}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00970}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_abcd8303e7d83e384045cbf93af669074}{00970}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_abcd8303e7d83e384045cbf93af669074}{collate\_fn}}(batch):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00971}00971\ \ \ \ \ \ \ \ \ im,\ label,\ path,\ shapes\ =\ zip(*batch)\ \ \textcolor{comment}{\#\ transposed}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00972}00972\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ lb\ \textcolor{keywordflow}{in}\ enumerate(label):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00973}00973\ \ \ \ \ \ \ \ \ \ \ \ \ lb[:,\ 0]\ =\ i\ \ \textcolor{comment}{\#\ add\ target\ image\ index\ for\ build\_targets()}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00974}00974\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ torch.stack(im,\ 0),\ torch.cat(label,\ 0),\ path,\ shapes}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00975}00975\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00976}00976\ \ \ \ \ \textcolor{preprocessor}{@staticmethod}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00977}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a6b068bc507b0ca94fff2b619d58fb30f}{00977}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels_a6b068bc507b0ca94fff2b619d58fb30f}{collate\_fn4}}(batch):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00978}00978\ \ \ \ \ \ \ \ \ im,\ label,\ path,\ shapes\ =\ zip(*batch)\ \ \textcolor{comment}{\#\ transposed}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00979}00979\ \ \ \ \ \ \ \ \ n\ =\ len(shapes)\ //\ 4}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00980}00980\ \ \ \ \ \ \ \ \ im4,\ label4,\ path4,\ shapes4\ =\ [],\ [],\ path[:n],\ shapes[:n]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00981}00981\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00982}00982\ \ \ \ \ \ \ \ \ ho\ =\ torch.tensor([[0.0,\ 0,\ 0,\ 1,\ 0,\ 0]])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00983}00983\ \ \ \ \ \ \ \ \ wo\ =\ torch.tensor([[0.0,\ 0,\ 1,\ 0,\ 0,\ 0]])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00984}00984\ \ \ \ \ \ \ \ \ s\ =\ torch.tensor([[1,\ 1,\ 0.5,\ 0.5,\ 0.5,\ 0.5]])\ \ \textcolor{comment}{\#\ scale}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00985}00985\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(n):\ \ \textcolor{comment}{\#\ zidane\ torch.zeros(16,3,720,1280)\ \ \#\ BCHW}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00986}00986\ \ \ \ \ \ \ \ \ \ \ \ \ i\ *=\ 4}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00987}00987\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ random.random()\ <\ 0.5:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00988}00988\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im1\ =\ F.interpolate(im[i].unsqueeze(0).float(),\ scale\_factor=2.0,\ mode=\textcolor{stringliteral}{"{}bilinear"{}},\ align\_corners=\textcolor{keyword}{False})[}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00989}00989\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00990}00990\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ].type(im[i].type())}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00991}00991\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lb\ =\ label[i]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00992}00992\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00993}00993\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im1\ =\ torch.cat((torch.cat((im[i],\ im[i\ +\ 1]),\ 1),\ torch.cat((im[i\ +\ 2],\ im[i\ +\ 3]),\ 1)),\ 2)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00994}00994\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lb\ =\ torch.cat((label[i],\ label[i\ +\ 1]\ +\ ho,\ label[i\ +\ 2]\ +\ wo,\ label[i\ +\ 3]\ +\ ho\ +\ wo),\ 0)\ *\ s}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00995}00995\ \ \ \ \ \ \ \ \ \ \ \ \ im4.append(im1)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00996}00996\ \ \ \ \ \ \ \ \ \ \ \ \ label4.append(lb)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00997}00997\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00998}00998\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ lb\ \textcolor{keywordflow}{in}\ enumerate(label4):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l00999}00999\ \ \ \ \ \ \ \ \ \ \ \ \ lb[:,\ 0]\ =\ i\ \ \textcolor{comment}{\#\ add\ target\ image\ index\ for\ build\_targets()}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01000}01000\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01001}01001\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ torch.stack(im4,\ 0),\ torch.cat(label4,\ 0),\ path4,\ shapes4}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01002}01002\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01003}01003\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01004}01004\ \textcolor{comment}{\#\ Ancillary\ functions\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01005}\mbox{\hyperlink{namespaceutils_1_1dataloaders_a023a59d249d15081cd60ea57c6fa2650}{01005}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceutils_1_1dataloaders_a023a59d249d15081cd60ea57c6fa2650}{flatten\_recursive}}(path=DATASETS\_DIR\ /\ "{}coco128"{}):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01006}01006\ \ \ \ \ \textcolor{comment}{\#\ Flatten\ a\ recursive\ directory\ by\ bringing\ all\ files\ to\ top\ level}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01007}01007\ \ \ \ \ new\_path\ =\ Path(f\textcolor{stringliteral}{"{}\{str(path)\}\_flat"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01008}01008\ \ \ \ \ \textcolor{keywordflow}{if}\ os.path.exists(new\_path):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01009}01009\ \ \ \ \ \ \ \ \ shutil.rmtree(new\_path)\ \ \textcolor{comment}{\#\ delete\ output\ folder}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01010}01010\ \ \ \ \ os.makedirs(new\_path)\ \ \textcolor{comment}{\#\ make\ new\ output\ folder}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01011}01011\ \ \ \ \ \textcolor{keywordflow}{for}\ file\ \textcolor{keywordflow}{in}\ tqdm(glob.glob(f\textcolor{stringliteral}{"{}\{str(Path(path))\}/**/*.*"{}},\ recursive=\textcolor{keyword}{True})):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01012}01012\ \ \ \ \ \ \ \ \ shutil.copyfile(file,\ new\_path\ /\ Path(file).name)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01013}01013\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01014}01014\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01015}\mbox{\hyperlink{namespaceutils_1_1dataloaders_ace9543a13aae6b453128cb0ef4d2e64b}{01015}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceutils_1_1dataloaders_ace9543a13aae6b453128cb0ef4d2e64b}{extract\_boxes}}(path=DATASETS\_DIR\ /\ "{}coco128"{}):\ \ \textcolor{comment}{\#\ from\ utils.dataloaders\ import\ *;\ extract\_boxes()}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01016}01016\ \ \ \ \ \textcolor{comment}{\#\ Convert\ detection\ dataset\ into\ classification\ dataset,\ with\ one\ directory\ per\ class}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01017}01017\ \ \ \ \ path\ =\ Path(path)\ \ \textcolor{comment}{\#\ images\ dir}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01018}01018\ \ \ \ \ shutil.rmtree(path\ /\ \textcolor{stringliteral}{"{}classification"{}})\ \textcolor{keywordflow}{if}\ (path\ /\ \textcolor{stringliteral}{"{}classification"{}}).is\_dir()\ \textcolor{keywordflow}{else}\ \textcolor{keywordtype}{None}\ \ \textcolor{comment}{\#\ remove\ existing}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01019}01019\ \ \ \ \ files\ =\ list(path.rglob(\textcolor{stringliteral}{"{}*.*"{}}))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01020}01020\ \ \ \ \ n\ =\ len(files)\ \ \textcolor{comment}{\#\ number\ of\ files}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01021}01021\ \ \ \ \ \textcolor{keywordflow}{for}\ im\_file\ \textcolor{keywordflow}{in}\ tqdm(files,\ total=n):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01022}01022\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ im\_file.suffix[1:]\ \textcolor{keywordflow}{in}\ IMG\_FORMATS:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01023}01023\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ image}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01024}01024\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ cv2.imread(str(im\_file))[...,\ ::-\/1]\ \ \textcolor{comment}{\#\ BGR\ to\ RGB}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01025}01025\ \ \ \ \ \ \ \ \ \ \ \ \ h,\ w\ =\ im.shape[:2]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01026}01026\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01027}01027\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ labels}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01028}01028\ \ \ \ \ \ \ \ \ \ \ \ \ lb\_file\ =\ Path(img2label\_paths([str(im\_file)])[0])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01029}01029\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ Path(lb\_file).exists():}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01030}01030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ open(lb\_file)\ \textcolor{keyword}{as}\ f:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01031}01031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lb\ =\ np.array([x.split()\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ f.read().strip().splitlines()],\ dtype=np.float32)\ \ \textcolor{comment}{\#\ labels}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01032}01032\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01033}01033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ j,\ x\ \textcolor{keywordflow}{in}\ enumerate(lb):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01034}01034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ c\ =\ int(x[0])\ \ \textcolor{comment}{\#\ class}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01035}01035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\ =\ (path\ /\ \textcolor{stringliteral}{"{}classifier"{}})\ /\ f\textcolor{stringliteral}{"{}\{c\}"{}}\ /\ f\textcolor{stringliteral}{"{}\{path.stem\}\_\{im\_file.stem\}\_\{j\}.jpg"{}}\ \ \textcolor{comment}{\#\ new\ filename}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01036}01036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ f.parent.is\_dir():}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01037}01037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.parent.mkdir(parents=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01038}01038\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01039}01039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b\ =\ x[1:]\ *\ [w,\ h,\ w,\ h]\ \ \textcolor{comment}{\#\ box}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01040}01040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ b[2:]\ =\ b[2:].max()\ \ \#\ rectangle\ to\ square}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01041}01041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b[2:]\ =\ b[2:]\ *\ 1.2\ +\ 3\ \ \textcolor{comment}{\#\ pad}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01042}01042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b\ =\ xywh2xyxy(b.reshape(-\/1,\ 4)).ravel().astype(int)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01043}01043\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01044}01044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b[[0,\ 2]]\ =\ np.clip(b[[0,\ 2]],\ 0,\ w)\ \ \textcolor{comment}{\#\ clip\ boxes\ outside\ of\ image}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01045}01045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b[[1,\ 3]]\ =\ np.clip(b[[1,\ 3]],\ 0,\ h)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01046}01046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ cv2.imwrite(str(f),\ im[b[1]\ :\ b[3],\ b[0]\ :\ b[2]]),\ f\textcolor{stringliteral}{"{}box\ failure\ in\ \{f\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01047}01047\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01048}01048\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01049}\mbox{\hyperlink{namespaceutils_1_1dataloaders_abf4d95bb29771f56a14ee0d6c4008572}{01049}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceutils_1_1dataloaders_abf4d95bb29771f56a14ee0d6c4008572}{autosplit}}(path=DATASETS\_DIR\ /\ "{}coco128/images"{},\ weights=(0.9,\ 0.1,\ 0.0),\ annotated\_only=\textcolor{keyword}{False}):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01050}01050\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Autosplit\ a\ dataset\ into\ train/val/test\ splits\ and\ save\ path/autosplit\_*.txt\ files}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01051}01051\ \textcolor{stringliteral}{\ \ \ \ Usage:\ from\ utils.dataloaders\ import\ *;\ autosplit()}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01052}01052\ \textcolor{stringliteral}{\ \ \ \ Arguments}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01053}01053\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ path:\ \ \ \ \ \ \ \ \ \ \ \ Path\ to\ images\ directory}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01054}01054\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ weights:\ \ \ \ \ \ \ \ \ Train,\ val,\ test\ weights\ (list,\ tuple)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01055}01055\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ annotated\_only:\ \ Only\ use\ images\ with\ an\ annotated\ txt\ file}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01056}01056\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01057}01057\ \ \ \ \ path\ =\ Path(path)\ \ \textcolor{comment}{\#\ images\ dir}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01058}01058\ \ \ \ \ files\ =\ sorted(x\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ path.rglob(\textcolor{stringliteral}{"{}*.*"{}})\ \textcolor{keywordflow}{if}\ x.suffix[1:].lower()\ \textcolor{keywordflow}{in}\ IMG\_FORMATS)\ \ \textcolor{comment}{\#\ image\ files\ only}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01059}01059\ \ \ \ \ n\ =\ len(files)\ \ \textcolor{comment}{\#\ number\ of\ files}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01060}01060\ \ \ \ \ random.seed(0)\ \ \textcolor{comment}{\#\ for\ reproducibility}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01061}01061\ \ \ \ \ indices\ =\ random.choices([0,\ 1,\ 2],\ weights=weights,\ k=n)\ \ \textcolor{comment}{\#\ assign\ each\ image\ to\ a\ split}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01062}01062\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01063}01063\ \ \ \ \ txt\ =\ [\textcolor{stringliteral}{"{}autosplit\_train.txt"{}},\ \textcolor{stringliteral}{"{}autosplit\_val.txt"{}},\ \textcolor{stringliteral}{"{}autosplit\_test.txt"{}}]\ \ \textcolor{comment}{\#\ 3\ txt\ files}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01064}01064\ \ \ \ \ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ txt:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01065}01065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (path.parent\ /\ x).exists():}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01066}01066\ \ \ \ \ \ \ \ \ \ \ \ \ (path.parent\ /\ x).unlink()\ \ \textcolor{comment}{\#\ remove\ existing}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01067}01067\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01068}01068\ \ \ \ \ print(f\textcolor{stringliteral}{"{}Autosplitting\ images\ from\ \{path\}"{}}\ +\ \textcolor{stringliteral}{"{},\ using\ *.txt\ labeled\ images\ only"{}}\ *\ annotated\_only)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01069}01069\ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ img\ \textcolor{keywordflow}{in}\ tqdm(zip(indices,\ files),\ total=n):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01070}01070\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ annotated\_only\ \textcolor{keywordflow}{or}\ Path(img2label\_paths([str(img)])[0]).exists():\ \ \textcolor{comment}{\#\ check\ label}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01071}01071\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ open(path.parent\ /\ txt[i],\ \textcolor{stringliteral}{"{}a"{}})\ \textcolor{keyword}{as}\ f:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01072}01072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.write(f\textcolor{stringliteral}{"{}./\{img.relative\_to(path.parent).as\_posix()\}"{}}\ +\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}})\ \ \textcolor{comment}{\#\ add\ image\ to\ txt\ file}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01073}01073\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01074}01074\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01075}\mbox{\hyperlink{namespaceutils_1_1dataloaders_a91b90a548edecf858a0036853efdc6a1}{01075}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceutils_1_1dataloaders_a91b90a548edecf858a0036853efdc6a1}{verify\_image\_label}}(args):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01076}01076\ \ \ \ \ \textcolor{comment}{\#\ Verify\ one\ image-\/label\ pair}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01077}01077\ \ \ \ \ im\_file,\ lb\_file,\ prefix\ =\ args}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01078}01078\ \ \ \ \ nm,\ nf,\ ne,\ nc,\ msg,\ segments\ =\ 0,\ 0,\ 0,\ 0,\ \textcolor{stringliteral}{"{}"{}},\ []\ \ \textcolor{comment}{\#\ number\ (missing,\ found,\ empty,\ corrupt),\ message,\ segments}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01079}01079\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01080}01080\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ verify\ images}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01081}01081\ \ \ \ \ \ \ \ \ im\ =\ Image.open(im\_file)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01082}01082\ \ \ \ \ \ \ \ \ im.verify()\ \ \textcolor{comment}{\#\ PIL\ verify}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01083}01083\ \ \ \ \ \ \ \ \ shape\ =\ \mbox{\hyperlink{namespaceutils_1_1dataloaders_ade261da3ecb2c5b735ec54bbf44c8272}{exif\_size}}(im)\ \ \textcolor{comment}{\#\ image\ size}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01084}01084\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ (shape[0]\ >\ 9)\ \&\ (shape[1]\ >\ 9),\ f\textcolor{stringliteral}{"{}image\ size\ \{shape\}\ <10\ pixels"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01085}01085\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ im.format.lower()\ \textcolor{keywordflow}{in}\ IMG\_FORMATS,\ f\textcolor{stringliteral}{"{}invalid\ image\ format\ \{im.format\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01086}01086\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ im.format.lower()\ \textcolor{keywordflow}{in}\ (\textcolor{stringliteral}{"{}jpg"{}},\ \textcolor{stringliteral}{"{}jpeg"{}}):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01087}01087\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ open(im\_file,\ \textcolor{stringliteral}{"{}rb"{}})\ \textcolor{keyword}{as}\ f:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01088}01088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.seek(-\/2,\ 2)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01089}01089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ f.read()\ !=\ b\textcolor{stringliteral}{"{}\(\backslash\)xff\(\backslash\)xd9"{}}:\ \ \textcolor{comment}{\#\ corrupt\ JPEG}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01090}01090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ImageOps.exif\_transpose(Image.open(im\_file)).save(im\_file,\ \textcolor{stringliteral}{"{}JPEG"{}},\ subsampling=0,\ quality=100)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01091}01091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ f\textcolor{stringliteral}{"{}\{prefix\}WARNING\ ⚠️\ \{im\_file\}:\ corrupt\ JPEG\ restored\ and\ saved"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01092}01092\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01093}01093\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ verify\ labels}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01094}01094\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ os.path.isfile(lb\_file):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01095}01095\ \ \ \ \ \ \ \ \ \ \ \ \ nf\ =\ 1\ \ \textcolor{comment}{\#\ label\ found}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01096}01096\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ open(lb\_file)\ \textcolor{keyword}{as}\ f:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01097}01097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lb\ =\ [x.split()\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ f.read().strip().splitlines()\ \textcolor{keywordflow}{if}\ len(x)]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01098}01098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ any(len(x)\ >\ 6\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ lb):\ \ \textcolor{comment}{\#\ is\ segment}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01099}01099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ classes\ =\ np.array([x[0]\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ lb],\ dtype=np.float32)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01100}01100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segments\ =\ [np.array(x[1:],\ dtype=np.float32).reshape(-\/1,\ 2)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ lb]\ \ \textcolor{comment}{\#\ (cls,\ xy1...)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01101}01101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lb\ =\ np.concatenate((classes.reshape(-\/1,\ 1),\ segments2boxes(segments)),\ 1)\ \ \textcolor{comment}{\#\ (cls,\ xywh)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01102}01102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lb\ =\ np.array(lb,\ dtype=np.float32)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01103}01103\ \ \ \ \ \ \ \ \ \ \ \ \ nl\ =\ len(lb)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01104}01104\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ nl:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01105}01105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ lb.shape[1]\ ==\ 5,\ f\textcolor{stringliteral}{"{}labels\ require\ 5\ columns,\ \{lb.shape[1]\}\ columns\ detected"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01106}01106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ (lb\ >=\ 0).all(),\ f\textcolor{stringliteral}{"{}negative\ label\ values\ \{lb[lb\ <\ 0]\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01107}01107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ (lb[:,\ 1:]\ <=\ 1).all(),\ f\textcolor{stringliteral}{"{}non-\/normalized\ or\ out\ of\ bounds\ coordinates\ \{lb[:,\ 1:][lb[:,\ 1:]\ >\ 1]\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01108}01108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_,\ i\ =\ np.unique(lb,\ axis=0,\ return\_index=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01109}01109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(i)\ <\ nl:\ \ \textcolor{comment}{\#\ duplicate\ row\ check}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01110}01110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lb\ =\ lb[i]\ \ \textcolor{comment}{\#\ remove\ duplicates}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01111}01111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ segments:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01112}01112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segments\ =\ [segments[x]\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ i]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01113}01113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ f\textcolor{stringliteral}{"{}\{prefix\}WARNING\ ⚠️\ \{im\_file\}:\ \{nl\ -\/\ len(i)\}\ duplicate\ labels\ removed"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01114}01114\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01115}01115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ne\ =\ 1\ \ \textcolor{comment}{\#\ label\ empty}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01116}01116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lb\ =\ np.zeros((0,\ 5),\ dtype=np.float32)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01117}01117\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01118}01118\ \ \ \ \ \ \ \ \ \ \ \ \ nm\ =\ 1\ \ \textcolor{comment}{\#\ label\ missing}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01119}01119\ \ \ \ \ \ \ \ \ \ \ \ \ lb\ =\ np.zeros((0,\ 5),\ dtype=np.float32)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01120}01120\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ im\_file,\ lb,\ shape,\ segments,\ nm,\ nf,\ ne,\ nc,\ msg}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01121}01121\ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01122}01122\ \ \ \ \ \ \ \ \ nc\ =\ 1}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01123}01123\ \ \ \ \ \ \ \ \ msg\ =\ f\textcolor{stringliteral}{"{}\{prefix\}WARNING\ ⚠️\ \{im\_file\}:\ ignoring\ corrupt\ image/label:\ \{e\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01124}01124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [\textcolor{keywordtype}{None},\ \textcolor{keywordtype}{None},\ \textcolor{keywordtype}{None},\ \textcolor{keywordtype}{None},\ nm,\ nf,\ ne,\ nc,\ msg]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01125}01125\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01126}01126\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01127}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats}{01127}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats}{HUBDatasetStats}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01128}01128\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01129}01129\ \textcolor{stringliteral}{\ \ \ \ Class\ for\ generating\ HUB\ dataset\ JSON\ and\ \`{}-\/hub\`{}\ dataset\ directory.}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01130}01130\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01131}01131\ \textcolor{stringliteral}{\ \ \ \ Arguments}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01132}01132\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ path:\ \ \ \ \ \ \ \ \ \ \ Path\ to\ data.yaml\ or\ data.zip\ (with\ data.yaml\ inside\ data.zip)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01133}01133\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ autodownload:\ \ \ Attempt\ to\ download\ dataset\ if\ not\ found\ locally}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01134}01134\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01135}01135\ \textcolor{stringliteral}{\ \ \ \ Usage}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01136}01136\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ from\ utils.dataloaders\ import\ HUBDatasetStats}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01137}01137\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ stats\ =\ HUBDatasetStats('coco128.yaml',\ autodownload=True)\ \ \#\ usage\ 1}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01138}01138\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ stats\ =\ HUBDatasetStats('path/to/coco128.zip')\ \ \#\ usage\ 2}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01139}01139\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ stats.get\_json(save=False)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01140}01140\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ stats.process\_images()}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01141}01141\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01142}01142\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01143}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a021462d629d374fe8b906d6479c4eb04}{01143}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a021462d629d374fe8b906d6479c4eb04}{\_\_init\_\_}}(self,\ path="{}coco128.yaml"{},\ autodownload=False):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01144}01144\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Initialize\ class}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01145}01145\ \ \ \ \ \ \ \ \ zipped,\ data\_dir,\ yaml\_path\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_abc32456ecfaccd849ef86a129ddd9354}{\_unzip}}(Path(path))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01146}01146\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01147}01147\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ open(check\_yaml(yaml\_path),\ errors=\textcolor{stringliteral}{"{}ignore"{}})\ \textcolor{keyword}{as}\ f:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01148}01148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\ =\ yaml.safe\_load(f)\ \ \textcolor{comment}{\#\ data\ dict}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01149}01149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ zipped:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01150}01150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data[\textcolor{stringliteral}{"{}path"{}}]\ =\ data\_dir}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01151}01151\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01152}01152\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ Exception(\textcolor{stringliteral}{"{}error/HUB/dataset\_stats/yaml\_load"{}})\ \textcolor{keyword}{from}\ e}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01153}01153\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01154}01154\ \ \ \ \ \ \ \ \ check\_dataset(data,\ autodownload)\ \ \textcolor{comment}{\#\ download\ dataset\ if\ missing}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01155}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_acf32c825af98388fb39c0fd7136f6dcf}{01155}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_acf32c825af98388fb39c0fd7136f6dcf}{hub\_dir}}\ =\ Path(data[\textcolor{stringliteral}{"{}path"{}}]\ +\ \textcolor{stringliteral}{"{}-\/hub"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01156}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ab5646fc12e4fd28391cde8b136c39a2a}{01156}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ab5646fc12e4fd28391cde8b136c39a2a}{im\_dir}}\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_acf32c825af98388fb39c0fd7136f6dcf}{hub\_dir}}\ /\ \textcolor{stringliteral}{"{}images"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01157}01157\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ab5646fc12e4fd28391cde8b136c39a2a}{im\_dir}}.mkdir(parents=\textcolor{keyword}{True},\ exist\_ok=\textcolor{keyword}{True})\ \ \textcolor{comment}{\#\ makes\ /images}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01158}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a20bce62d18290293eb1f3511421e51e0}{01158}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a20bce62d18290293eb1f3511421e51e0}{stats}}\ =\ \{\textcolor{stringliteral}{"{}nc"{}}:\ data[\textcolor{stringliteral}{"{}nc"{}}],\ \textcolor{stringliteral}{"{}names"{}}:\ list(data[\textcolor{stringliteral}{"{}names"{}}].values())\}\ \ \textcolor{comment}{\#\ statistics\ dictionary}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01159}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ae9f7f5ae568ef863dc434607f3fd17d7}{01159}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ae9f7f5ae568ef863dc434607f3fd17d7}{data}}\ =\ data}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01160}01160\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01161}01161\ \ \ \ \ \textcolor{preprocessor}{@staticmethod}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01162}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a82509e32475e2dad74714d71dbdcd38e}{01162}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a82509e32475e2dad74714d71dbdcd38e}{\_find\_yaml}}(dir):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01163}01163\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Return\ data.yaml\ file}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01164}01164\ \ \ \ \ \ \ \ \ files\ =\ list(dir.glob(\textcolor{stringliteral}{"{}*.yaml"{}}))\ \textcolor{keywordflow}{or}\ list(dir.rglob(\textcolor{stringliteral}{"{}*.yaml"{}}))\ \ \textcolor{comment}{\#\ try\ root\ level\ first\ and\ then\ recursive}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01165}01165\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ files,\ f\textcolor{stringliteral}{"{}No\ *.yaml\ file\ found\ in\ \{dir\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01166}01166\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(files)\ >\ 1:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01167}01167\ \ \ \ \ \ \ \ \ \ \ \ \ files\ =\ [f\ \textcolor{keywordflow}{for}\ f\ \textcolor{keywordflow}{in}\ files\ \textcolor{keywordflow}{if}\ f.stem\ ==\ dir.stem]\ \ \textcolor{comment}{\#\ prefer\ *.yaml\ files\ that\ match\ dir\ name}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01168}01168\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ files,\ f\textcolor{stringliteral}{"{}Multiple\ *.yaml\ files\ found\ in\ \{dir\},\ only\ 1\ *.yaml\ file\ allowed"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01169}01169\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ len(files)\ ==\ 1,\ f\textcolor{stringliteral}{"{}Multiple\ *.yaml\ files\ found:\ \{files\},\ only\ 1\ *.yaml\ file\ allowed\ in\ \{dir\}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01170}01170\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ files[0]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01171}01171\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01172}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_abc32456ecfaccd849ef86a129ddd9354}{01172}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_abc32456ecfaccd849ef86a129ddd9354}{\_unzip}}(self,\ path):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01173}01173\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Unzip\ data.zip}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01174}01174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ str(path).endswith(\textcolor{stringliteral}{"{}.zip"{}}):\ \ \textcolor{comment}{\#\ path\ is\ data.yaml}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01175}01175\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{False},\ \textcolor{keywordtype}{None},\ path}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01176}01176\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ Path(path).is\_file(),\ f\textcolor{stringliteral}{"{}Error\ unzipping\ \{path\},\ file\ not\ found"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01177}01177\ \ \ \ \ \ \ \ \ unzip\_file(path,\ path=path.parent)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01178}01178\ \ \ \ \ \ \ \ \ dir\ =\ path.with\_suffix(\textcolor{stringliteral}{"{}"{}})\ \ \textcolor{comment}{\#\ dataset\ directory\ ==\ zip\ name}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01179}01179\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ dir.is\_dir(),\ f\textcolor{stringliteral}{"{}Error\ unzipping\ \{path\},\ \{dir\}\ not\ found.\ path/to/abc.zip\ MUST\ unzip\ to\ path/to/abc/"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01180}01180\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{True},\ str(dir),\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a82509e32475e2dad74714d71dbdcd38e}{\_find\_yaml}}(dir)\ \ \textcolor{comment}{\#\ zipped,\ data\_dir,\ yaml\_path}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01181}01181\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01182}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a0b8972bcefb343a8ac5f92a76e2622ca}{01182}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_aa5bc5284da56d4c98711a368c1234699}{\_hub\_ops}}(self,\ f,\ max\_dim=1920):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01183}01183\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ HUB\ ops\ for\ 1\ image\ 'f':\ resize\ and\ save\ at\ reduced\ quality\ in\ /dataset-\/hub\ for\ web/app\ viewing}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01184}01184\ \ \ \ \ \ \ \ \ f\_new\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ab5646fc12e4fd28391cde8b136c39a2a}{im\_dir}}\ /\ Path(f).name\ \ \textcolor{comment}{\#\ dataset-\/hub\ image\ filename}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01185}01185\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:\ \ \textcolor{comment}{\#\ use\ PIL}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01186}01186\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ Image.open(f)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01187}01187\ \ \ \ \ \ \ \ \ \ \ \ \ r\ =\ max\_dim\ /\ max(im.height,\ im.width)\ \ \textcolor{comment}{\#\ ratio}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01188}01188\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ r\ <\ 1.0:\ \ \textcolor{comment}{\#\ image\ too\ large}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01189}01189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im.resize((int(im.width\ *\ r),\ int(im.height\ *\ r)))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01190}01190\ \ \ \ \ \ \ \ \ \ \ \ \ im.save(f\_new,\ \textcolor{stringliteral}{"{}JPEG"{}},\ quality=50,\ optimize=\textcolor{keyword}{True})\ \ \textcolor{comment}{\#\ save}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01191}01191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:\ \ \textcolor{comment}{\#\ use\ OpenCV}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01192}01192\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}WARNING\ ⚠️\ HUB\ ops\ PIL\ failure\ \{f\}:\ \{e\}"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01193}01193\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ cv2.imread(f)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01194}01194\ \ \ \ \ \ \ \ \ \ \ \ \ im\_height,\ im\_width\ =\ im.shape[:2]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01195}01195\ \ \ \ \ \ \ \ \ \ \ \ \ r\ =\ max\_dim\ /\ max(im\_height,\ im\_width)\ \ \textcolor{comment}{\#\ ratio}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01196}01196\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ r\ <\ 1.0:\ \ \textcolor{comment}{\#\ image\ too\ large}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01197}01197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ cv2.resize(im,\ (int(im\_width\ *\ r),\ int(im\_height\ *\ r)),\ interpolation=cv2.INTER\_AREA)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01198}01198\ \ \ \ \ \ \ \ \ \ \ \ \ cv2.imwrite(str(f\_new),\ im)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01199}01199\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01200}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a6b1c9e1417b366a3b7e789675952bc1a}{01200}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a6b1c9e1417b366a3b7e789675952bc1a}{get\_json}}(self,\ save=False,\ verbose=False):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01201}01201\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Return\ dataset\ JSON\ for\ Ultralytics\ HUB}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01202}01202\ \ \ \ \ \ \ \ \ \textcolor{keyword}{def\ }\_round(labels):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01203}01203\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Update\ labels\ to\ integer\ class\ and\ 6\ decimal\ place\ floats}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01204}01204\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [[int(c),\ *(round(x,\ 4)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ points)]\ \textcolor{keywordflow}{for}\ c,\ *points\ \textcolor{keywordflow}{in}\ labels]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01205}01205\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01206}01206\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ split\ \textcolor{keywordflow}{in}\ \textcolor{stringliteral}{"{}train"{}},\ \textcolor{stringliteral}{"{}val"{}},\ \textcolor{stringliteral}{"{}test"{}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01207}01207\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ae9f7f5ae568ef863dc434607f3fd17d7}{data}}.get(split)\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01208}01208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a20bce62d18290293eb1f3511421e51e0}{stats}}[split]\ =\ \textcolor{keywordtype}{None}\ \ \textcolor{comment}{\#\ i.e.\ no\ test\ set}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01209}01209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01210}01210\ \ \ \ \ \ \ \ \ \ \ \ \ dataset\ =\ \mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels}{LoadImagesAndLabels}}(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ae9f7f5ae568ef863dc434607f3fd17d7}{data}}[split])\ \ \textcolor{comment}{\#\ load\ dataset}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01211}01211\ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ np.array(}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01212}01212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01213}01213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ np.bincount(label[:,\ 0].astype(int),\ minlength=self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ae9f7f5ae568ef863dc434607f3fd17d7}{data}}[\textcolor{stringliteral}{"{}nc"{}}])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01214}01214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ label\ \textcolor{keywordflow}{in}\ tqdm(dataset.labels,\ total=dataset.n,\ desc=\textcolor{stringliteral}{"{}Statistics"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01215}01215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01216}01216\ \ \ \ \ \ \ \ \ \ \ \ \ )\ \ \textcolor{comment}{\#\ shape(128x80)}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01217}01217\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a20bce62d18290293eb1f3511421e51e0}{stats}}[split]\ =\ \{}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01218}01218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}instance\_stats"{}}:\ \{\textcolor{stringliteral}{"{}total"{}}:\ int(x.sum()),\ \textcolor{stringliteral}{"{}per\_class"{}}:\ x.sum(0).tolist()\},}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01219}01219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}image\_stats"{}}:\ \{}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01220}01220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}total"{}}:\ dataset.n,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01221}01221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}unlabelled"{}}:\ int(np.all(x\ ==\ 0,\ 1).sum()),}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01222}01222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}per\_class"{}}:\ (x\ >\ 0).sum(0).tolist(),}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01223}01223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \},}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01224}01224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}labels"{}}:\ [\{str(Path(k).name):\ \_round(v.tolist())\}\ \textcolor{keywordflow}{for}\ k,\ v\ \textcolor{keywordflow}{in}\ zip(dataset.im\_files,\ dataset.labels)],}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01225}01225\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01226}01226\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01227}01227\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Save,\ print\ and\ return}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01228}01228\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ save:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01229}01229\ \ \ \ \ \ \ \ \ \ \ \ \ stats\_path\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_acf32c825af98388fb39c0fd7136f6dcf}{hub\_dir}}\ /\ \textcolor{stringliteral}{"{}stats.json"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01230}01230\ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}Saving\ \{stats\_path.resolve()\}..."{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01231}01231\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ open(stats\_path,\ \textcolor{stringliteral}{"{}w"{}})\ \textcolor{keyword}{as}\ f:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01232}01232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ json.dump(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a20bce62d18290293eb1f3511421e51e0}{stats}},\ f)\ \ \textcolor{comment}{\#\ save\ stats.json}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01233}01233\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ verbose:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01234}01234\ \ \ \ \ \ \ \ \ \ \ \ \ print(json.dumps(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a20bce62d18290293eb1f3511421e51e0}{stats}},\ indent=2,\ sort\_keys=\textcolor{keyword}{False}))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01235}01235\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a20bce62d18290293eb1f3511421e51e0}{stats}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01236}01236\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01237}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ac12b10b40154aa3927450f49df7b7260}{01237}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ac12b10b40154aa3927450f49df7b7260}{process\_images}}(self):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01238}01238\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Compress\ images\ for\ Ultralytics\ HUB}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01239}01239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ split\ \textcolor{keywordflow}{in}\ \textcolor{stringliteral}{"{}train"{}},\ \textcolor{stringliteral}{"{}val"{}},\ \textcolor{stringliteral}{"{}test"{}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01240}01240\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ae9f7f5ae568ef863dc434607f3fd17d7}{data}}.get(split)\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01241}01241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01242}01242\ \ \ \ \ \ \ \ \ \ \ \ \ dataset\ =\ \mbox{\hyperlink{classutils_1_1dataloaders_1_1_load_images_and_labels}{LoadImagesAndLabels}}(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ae9f7f5ae568ef863dc434607f3fd17d7}{data}}[split])\ \ \textcolor{comment}{\#\ load\ dataset}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01243}01243\ \ \ \ \ \ \ \ \ \ \ \ \ desc\ =\ f\textcolor{stringliteral}{"{}\{split\}\ images"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01244}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_aa5bc5284da56d4c98711a368c1234699}{01244}}\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ \_\ \textcolor{keywordflow}{in}\ tqdm(ThreadPool(NUM\_THREADS).imap(self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_aa5bc5284da56d4c98711a368c1234699}{\_hub\_ops}}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_a0b8972bcefb343a8ac5f92a76e2622ca}{\_hub\_ops}},\ dataset.im\_files),\ total=dataset.n,\ desc=desc):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01245}01245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01246}01246\ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}Done.\ All\ images\ saved\ to\ \{self.im\_dir\}"{}})}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01247}01247\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_h_u_b_dataset_stats_ab5646fc12e4fd28391cde8b136c39a2a}{im\_dir}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01248}01248\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01249}01249\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01250}01250\ \textcolor{comment}{\#\ Classification\ dataloaders\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01251}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset}{01251}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset}{ClassificationDataset}}(torchvision.datasets.ImageFolder):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01252}01252\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01253}01253\ \textcolor{stringliteral}{\ \ \ \ YOLOv5\ Classification\ Dataset.}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01254}01254\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01255}01255\ \textcolor{stringliteral}{\ \ \ \ Arguments}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01256}01256\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ root:\ \ Dataset\ path}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01257}01257\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ transform:\ \ torchvision\ transforms,\ used\ by\ default}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01258}01258\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ album\_transform:\ Albumentations\ transforms,\ used\ if\ installed}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01259}01259\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01260}01260\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01261}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a5353e25b0e779b228825d065edc99937}{01261}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a5353e25b0e779b228825d065edc99937}{\_\_init\_\_}}(self,\ root,\ augment,\ imgsz,\ cache=False):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01262}01262\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a5353e25b0e779b228825d065edc99937}{\_\_init\_\_}}(root=root)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01263}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a3e0dfb6f8c6af6ab3715573e27d42dbf}{01263}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a3e0dfb6f8c6af6ab3715573e27d42dbf}{torch\_transforms}}\ =\ classify\_transforms(imgsz)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01264}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a6a3a025e85995d4b8403aeb667f0e0a2}{01264}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a6a3a025e85995d4b8403aeb667f0e0a2}{album\_transforms}}\ =\ classify\_albumentations(augment,\ imgsz)\ \textcolor{keywordflow}{if}\ augment\ \textcolor{keywordflow}{else}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01265}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a4003343b17cc659d03644b04b3b99a66}{01265}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a4003343b17cc659d03644b04b3b99a66}{cache\_ram}}\ =\ cache\ \textcolor{keywordflow}{is}\ \textcolor{keyword}{True}\ \textcolor{keywordflow}{or}\ cache\ ==\ \textcolor{stringliteral}{"{}ram"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01266}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a9c4e49fac854438ac851ed92a5f85902}{01266}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a9c4e49fac854438ac851ed92a5f85902}{cache\_disk}}\ =\ cache\ ==\ \textcolor{stringliteral}{"{}disk"{}}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01267}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_af19d3f9898598632d2b14386943932d3}{01267}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_af19d3f9898598632d2b14386943932d3}{samples}}\ =\ [list(x)\ +\ [Path(x[0]).with\_suffix(\textcolor{stringliteral}{"{}.npy"{}}),\ \textcolor{keywordtype}{None}]\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_af19d3f9898598632d2b14386943932d3}{samples}}]\ \ \textcolor{comment}{\#\ file,\ index,\ npy,\ im}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01268}01268\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01269}\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a6524463dd3079640b1f3298f1c31139b}{01269}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a6524463dd3079640b1f3298f1c31139b}{\_\_getitem\_\_}}(self,\ i):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01270}01270\ \ \ \ \ \ \ \ \ f,\ j,\ fn,\ im\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_af19d3f9898598632d2b14386943932d3}{samples}}[i]\ \ \textcolor{comment}{\#\ filename,\ index,\ filename.with\_suffix('.npy'),\ image}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01271}01271\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a4003343b17cc659d03644b04b3b99a66}{cache\_ram}}\ \textcolor{keywordflow}{and}\ im\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01272}01272\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_af19d3f9898598632d2b14386943932d3}{samples}}[i][3]\ =\ cv2.imread(f)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01273}01273\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a9c4e49fac854438ac851ed92a5f85902}{cache\_disk}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01274}01274\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ fn.exists():\ \ \textcolor{comment}{\#\ load\ npy}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01275}01275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ np.save(fn.as\_posix(),\ cv2.imread(f))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01276}01276\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ np.load(fn)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01277}01277\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:\ \ \textcolor{comment}{\#\ read\ image}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01278}01278\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ cv2.imread(f)\ \ \textcolor{comment}{\#\ BGR}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01279}01279\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a6a3a025e85995d4b8403aeb667f0e0a2}{album\_transforms}}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01280}01280\ \ \ \ \ \ \ \ \ \ \ \ \ sample\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a6a3a025e85995d4b8403aeb667f0e0a2}{album\_transforms}}(image=cv2.cvtColor(im,\ cv2.COLOR\_BGR2RGB))[\textcolor{stringliteral}{"{}image"{}}]}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01281}01281\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01282}01282\ \ \ \ \ \ \ \ \ \ \ \ \ sample\ =\ self.\mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset_a3e0dfb6f8c6af6ab3715573e27d42dbf}{torch\_transforms}}(im)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01283}01283\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ sample,\ j}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01284}01284\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01285}01285\ }
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01286}\mbox{\hyperlink{namespaceutils_1_1dataloaders_a813b8a6adeedae49966c09e7cb877b24}{01286}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceutils_1_1dataloaders_a813b8a6adeedae49966c09e7cb877b24}{create\_classification\_dataloader}}(}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01287}01287\ \ \ \ \ path,\ imgsz=224,\ batch\_size=16,\ augment=True,\ cache=False,\ rank=-\/1,\ workers=8,\ shuffle=True}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01288}01288\ ):}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01289}01289\ \ \ \ \ \textcolor{comment}{\#\ Returns\ Dataloader\ object\ to\ be\ used\ with\ YOLOv5\ Classifier}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01290}01290\ \ \ \ \ \textcolor{keyword}{with}\ torch\_distributed\_zero\_first(rank):\ \ \textcolor{comment}{\#\ init\ dataset\ *.cache\ only\ once\ if\ DDP}}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01291}01291\ \ \ \ \ \ \ \ \ dataset\ =\ \mbox{\hyperlink{classutils_1_1dataloaders_1_1_classification_dataset}{ClassificationDataset}}(root=path,\ imgsz=imgsz,\ augment=augment,\ cache=cache)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01292}01292\ \ \ \ \ batch\_size\ =\ min(batch\_size,\ len(dataset))}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01293}01293\ \ \ \ \ nd\ =\ torch.cuda.device\_count()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01294}01294\ \ \ \ \ nw\ =\ min([os.cpu\_count()\ //\ max(nd,\ 1),\ batch\_size\ \textcolor{keywordflow}{if}\ batch\_size\ >\ 1\ \textcolor{keywordflow}{else}\ 0,\ workers])}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01295}01295\ \ \ \ \ sampler\ =\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{if}\ rank\ ==\ -\/1\ \textcolor{keywordflow}{else}\ distributed.DistributedSampler(dataset,\ shuffle=shuffle)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01296}01296\ \ \ \ \ generator\ =\ torch.Generator()}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01297}01297\ \ \ \ \ generator.manual\_seed(6148914691236517205\ +\ RANK)}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01298}01298\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classutils_1_1dataloaders_1_1_infinite_data_loader}{InfiniteDataLoader}}(}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01299}01299\ \ \ \ \ \ \ \ \ dataset,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01300}01300\ \ \ \ \ \ \ \ \ batch\_size=batch\_size,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01301}01301\ \ \ \ \ \ \ \ \ shuffle=shuffle\ \textcolor{keywordflow}{and}\ sampler\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None},}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01302}01302\ \ \ \ \ \ \ \ \ num\_workers=nw,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01303}01303\ \ \ \ \ \ \ \ \ sampler=sampler,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01304}01304\ \ \ \ \ \ \ \ \ pin\_memory=PIN\_MEMORY,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01305}01305\ \ \ \ \ \ \ \ \ worker\_init\_fn=seed\_worker,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01306}01306\ \ \ \ \ \ \ \ \ generator=generator,}
\DoxyCodeLine{\Hypertarget{dataloaders_8py_source_l01307}01307\ \ \ \ \ )\ \ \textcolor{comment}{\#\ or\ DataLoader(persistent\_workers=True)}}

\end{DoxyCode}
