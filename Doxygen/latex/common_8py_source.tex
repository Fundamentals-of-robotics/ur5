\doxysection{common.\+py}
\hypertarget{common_8py_source}{}\label{common_8py_source}\index{C:/Users/dorij/OneDrive/Desktop/ur5/vision/yolo/models/common.py@{C:/Users/dorij/OneDrive/Desktop/ur5/vision/yolo/models/common.py}}
\mbox{\hyperlink{common_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00001}\mbox{\hyperlink{namespacemodels}{00001}}\ \textcolor{comment}{\#\ YOLOv5\ ðŸš€\ by\ Ultralytics,\ AGPL-\/3.0\ license}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00002}00002\ \textcolor{stringliteral}{"{}"{}"{}Common\ modules."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00004}00004\ \textcolor{keyword}{import}\ ast}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00005}00005\ \textcolor{keyword}{import}\ contextlib}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00006}00006\ \textcolor{keyword}{import}\ json}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00007}00007\ \textcolor{keyword}{import}\ math}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00008}00008\ \textcolor{keyword}{import}\ platform}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00009}00009\ \textcolor{keyword}{import}\ warnings}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00010}00010\ \textcolor{keyword}{import}\ zipfile}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00011}00011\ \textcolor{keyword}{from}\ collections\ \textcolor{keyword}{import}\ OrderedDict,\ namedtuple}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00012}00012\ \textcolor{keyword}{from}\ copy\ \textcolor{keyword}{import}\ copy}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00013}00013\ \textcolor{keyword}{from}\ pathlib\ \textcolor{keyword}{import}\ Path}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00014}00014\ \textcolor{keyword}{from}\ urllib.parse\ \textcolor{keyword}{import}\ urlparse}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00016}00016\ \textcolor{keyword}{import}\ cv2}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00017}00017\ \textcolor{keyword}{import}\ numpy\ \textcolor{keyword}{as}\ np}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00018}00018\ \textcolor{keyword}{import}\ pandas\ \textcolor{keyword}{as}\ pd}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00019}00019\ \textcolor{keyword}{import}\ requests}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00020}00020\ \textcolor{keyword}{import}\ torch}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00021}00021\ \textcolor{keyword}{import}\ \mbox{\hyperlink{namespacetorch_1_1nn}{torch.nn}}\ \textcolor{keyword}{as}\ nn}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00022}00022\ \textcolor{keyword}{from}\ PIL\ \textcolor{keyword}{import}\ Image}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00023}00023\ \textcolor{keyword}{from}\ torch.cuda\ \textcolor{keyword}{import}\ amp}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00025}00025\ \textcolor{comment}{\#\ Import\ 'ultralytics'\ package\ or\ install\ if\ if\ missing}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00026}00026\ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00027}00027\ \ \ \ \ \textcolor{keyword}{import}\ ultralytics}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00029}00029\ \ \ \ \ \textcolor{keyword}{assert}\ hasattr(ultralytics,\ \textcolor{stringliteral}{"{}\_\_version\_\_"{}})\ \ \textcolor{comment}{\#\ verify\ package\ is\ not\ directory}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00030}00030\ \textcolor{keywordflow}{except}\ (ImportError,\ AssertionError):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00031}00031\ \ \ \ \ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00033}00033\ \ \ \ \ os.system(\textcolor{stringliteral}{"{}pip\ install\ -\/U\ ultralytics"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00034}00034\ \ \ \ \ \textcolor{keyword}{import}\ ultralytics}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00035}00035\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00036}00036\ \textcolor{keyword}{from}\ ultralytics.utils.plotting\ \textcolor{keyword}{import}\ Annotator,\ colors,\ save\_one\_box}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00038}00038\ \textcolor{keyword}{from}\ utils\ \textcolor{keyword}{import}\ TryExcept}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00039}00039\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceutils_1_1dataloaders}{utils.dataloaders}}\ \textcolor{keyword}{import}\ exif\_transpose,\ letterbox}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00040}00040\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceutils_1_1general}{utils.general}}\ \textcolor{keyword}{import}\ (}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00041}00041\ \ \ \ \ LOGGER,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00042}00042\ \ \ \ \ ROOT,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00043}00043\ \ \ \ \ Profile,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00044}00044\ \ \ \ \ check\_requirements,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00045}00045\ \ \ \ \ check\_suffix,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00046}00046\ \ \ \ \ check\_version,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00047}00047\ \ \ \ \ colorstr,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00048}00048\ \ \ \ \ increment\_path,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00049}00049\ \ \ \ \ is\_jupyter,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00050}00050\ \ \ \ \ make\_divisible,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00051}00051\ \ \ \ \ non\_max\_suppression,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00052}00052\ \ \ \ \ scale\_boxes,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00053}00053\ \ \ \ \ xywh2xyxy,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00054}00054\ \ \ \ \ xyxy2xywh,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00055}00055\ \ \ \ \ yaml\_load,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00056}00056\ )}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00057}00057\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceutils_1_1torch__utils}{utils.torch\_utils}}\ \textcolor{keyword}{import}\ copy\_attr,\ smart\_inference\_mode}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00058}00058\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00060}\mbox{\hyperlink{namespacemodels_1_1common_acf5b5473affb9687e4a5e40286d7b82d}{00060}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacemodels_1_1common_acf5b5473affb9687e4a5e40286d7b82d}{autopad}}(k,\ p=None,\ d=1):\ \ \textcolor{comment}{\#\ kernel,\ padding,\ dilation}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00061}00061\ \ \ \ \ \textcolor{comment}{\#\ Pad\ to\ 'same'\ shape\ outputs}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00062}00062\ \ \ \ \ \textcolor{keywordflow}{if}\ d\ >\ 1:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00063}00063\ \ \ \ \ \ \ \ \ k\ =\ d\ *\ (k\ -\/\ 1)\ +\ 1\ \textcolor{keywordflow}{if}\ isinstance(k,\ int)\ \textcolor{keywordflow}{else}\ [d\ *\ (x\ -\/\ 1)\ +\ 1\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ k]\ \ \textcolor{comment}{\#\ actual\ kernel-\/size}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00064}00064\ \ \ \ \ \textcolor{keywordflow}{if}\ p\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00065}00065\ \ \ \ \ \ \ \ \ p\ =\ k\ //\ 2\ \textcolor{keywordflow}{if}\ isinstance(k,\ int)\ \textcolor{keywordflow}{else}\ [x\ //\ 2\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ k]\ \ \textcolor{comment}{\#\ auto-\/pad}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00066}00066\ \ \ \ \ \textcolor{keywordflow}{return}\ p}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00067}00067\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00068}00068\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00069}\mbox{\hyperlink{classmodels_1_1common_1_1_conv}{00069}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00070}00070\ \ \ \ \ \textcolor{comment}{\#\ Standard\ convolution\ with\ args(ch\_in,\ ch\_out,\ kernel,\ stride,\ padding,\ groups,\ dilation,\ activation)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00071}\mbox{\hyperlink{classmodels_1_1common_1_1_conv_abd42d41a48aaa24eff18614fbdaedf9b}{00071}}\ \ \ \ \ default\_act\ =\ nn.SiLU()\ \ \textcolor{comment}{\#\ default\ activation}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00073}\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a296d7c325afcba10b96c805881ecccd7}{00073}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a296d7c325afcba10b96c805881ecccd7}{\_\_init\_\_}}(self,\ c1,\ c2,\ k=1,\ s=1,\ p=None,\ g=1,\ d=1,\ act=True):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00074}00074\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a296d7c325afcba10b96c805881ecccd7}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00075}\mbox{\hyperlink{classmodels_1_1common_1_1_conv_af05dbccfb0cee829a00aa919031453d8}{00075}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_conv_af05dbccfb0cee829a00aa919031453d8}{conv}}\ =\ nn.Conv2d(c1,\ c2,\ k,\ s,\ autopad(k,\ p,\ d),\ groups=g,\ dilation=d,\ bias=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00076}\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a47a40e914352711d6480f80824ae88ea}{00076}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a47a40e914352711d6480f80824ae88ea}{bn}}\ =\ nn.BatchNorm2d(c2)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00077}\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a97581cd4592dcd5d3b0a829df6cbacf6}{00077}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a97581cd4592dcd5d3b0a829df6cbacf6}{act}}\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_conv_abd42d41a48aaa24eff18614fbdaedf9b}{default\_act}}\ \textcolor{keywordflow}{if}\ act\ \textcolor{keywordflow}{is}\ \textcolor{keyword}{True}\ \textcolor{keywordflow}{else}\ act\ \textcolor{keywordflow}{if}\ isinstance(act,\ nn.Module)\ \textcolor{keywordflow}{else}\ nn.Identity()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00078}00078\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00079}\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a68fd85fb3838db808ed609ac6f5949ad}{00079}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a68fd85fb3838db808ed609ac6f5949ad}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00080}00080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a97581cd4592dcd5d3b0a829df6cbacf6}{act}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a47a40e914352711d6480f80824ae88ea}{bn}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_conv_af05dbccfb0cee829a00aa919031453d8}{conv}}(x)))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00081}00081\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00082}\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a7ca2065ab3b7e5006d133ec73ce9e22c}{00082}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a7ca2065ab3b7e5006d133ec73ce9e22c}{forward\_fuse}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00083}00083\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_conv_a97581cd4592dcd5d3b0a829df6cbacf6}{act}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_conv_af05dbccfb0cee829a00aa919031453d8}{conv}}(x))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00084}00084\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00085}00085\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00086}\mbox{\hyperlink{classmodels_1_1common_1_1_d_w_conv}{00086}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_d_w_conv}{DWConv}}(\mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00087}00087\ \ \ \ \ \textcolor{comment}{\#\ Depth-\/wise\ convolution}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00088}\mbox{\hyperlink{classmodels_1_1common_1_1_d_w_conv_ae9b6dbb57f71ae14f72132765a18f0bc}{00088}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_d_w_conv_ae9b6dbb57f71ae14f72132765a18f0bc}{\_\_init\_\_}}(self,\ c1,\ c2,\ k=1,\ s=1,\ d=1,\ act=True):\ \ \textcolor{comment}{\#\ ch\_in,\ ch\_out,\ kernel,\ stride,\ dilation,\ activation}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00089}00089\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_d_w_conv_ae9b6dbb57f71ae14f72132765a18f0bc}{\_\_init\_\_}}(c1,\ c2,\ k,\ s,\ g=math.gcd(c1,\ c2),\ d=d,\ act=act)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00090}00090\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00091}00091\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00092}\mbox{\hyperlink{classmodels_1_1common_1_1_d_w_conv_transpose2d}{00092}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_d_w_conv_transpose2d}{DWConvTranspose2d}}(nn.ConvTranspose2d):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00093}00093\ \ \ \ \ \textcolor{comment}{\#\ Depth-\/wise\ transpose\ convolution}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00094}\mbox{\hyperlink{classmodels_1_1common_1_1_d_w_conv_transpose2d_a6d72803683b5813b9168f430cd0dd4e8}{00094}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_d_w_conv_transpose2d_a6d72803683b5813b9168f430cd0dd4e8}{\_\_init\_\_}}(self,\ c1,\ c2,\ k=1,\ s=1,\ p1=0,\ p2=0):\ \ \textcolor{comment}{\#\ ch\_in,\ ch\_out,\ kernel,\ stride,\ padding,\ padding\_out}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00095}00095\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_d_w_conv_transpose2d_a6d72803683b5813b9168f430cd0dd4e8}{\_\_init\_\_}}(c1,\ c2,\ k,\ s,\ p1,\ p2,\ groups=math.gcd(c1,\ c2))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00096}00096\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00097}00097\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00098}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer}{00098}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer}{TransformerLayer}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00099}00099\ \ \ \ \ \textcolor{comment}{\#\ Transformer\ layer\ https://arxiv.org/abs/2010.11929\ (LayerNorm\ layers\ removed\ for\ better\ performance)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00100}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a49a84ef11ce4aa6281433a1da45cbeac}{00100}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a49a84ef11ce4aa6281433a1da45cbeac}{\_\_init\_\_}}(self,\ c,\ num\_heads):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00101}00101\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a49a84ef11ce4aa6281433a1da45cbeac}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00102}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a489707f5df93ca5643e3d081777604cf}{00102}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a489707f5df93ca5643e3d081777604cf}{q}}\ =\ nn.Linear(c,\ c,\ bias=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00103}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a41fc3e36868f22924a6dbf2718e7093c}{00103}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a41fc3e36868f22924a6dbf2718e7093c}{k}}\ =\ nn.Linear(c,\ c,\ bias=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00104}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a7f976d5cb189571fcffe97b7e099304c}{00104}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a7f976d5cb189571fcffe97b7e099304c}{v}}\ =\ nn.Linear(c,\ c,\ bias=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00105}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a9caca012a8ba59435d57834f176e7234}{00105}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a9caca012a8ba59435d57834f176e7234}{ma}}\ =\ nn.MultiheadAttention(embed\_dim=c,\ num\_heads=num\_heads)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00106}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_ac55f67c862fe19a5920f4e19bfc25fb7}{00106}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_ac55f67c862fe19a5920f4e19bfc25fb7}{fc1}}\ =\ nn.Linear(c,\ c,\ bias=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00107}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a43b3a9c7c3b9efb07d6b35045089a017}{00107}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a43b3a9c7c3b9efb07d6b35045089a017}{fc2}}\ =\ nn.Linear(c,\ c,\ bias=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00108}00108\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00109}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a8237bf1aaab7a9a2c6d809cf66862270}{00109}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a8237bf1aaab7a9a2c6d809cf66862270}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00110}00110\ \ \ \ \ \ \ \ \ x\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a9caca012a8ba59435d57834f176e7234}{ma}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a489707f5df93ca5643e3d081777604cf}{q}}(x),\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a41fc3e36868f22924a6dbf2718e7093c}{k}}(x),\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a7f976d5cb189571fcffe97b7e099304c}{v}}(x))[0]\ +\ x}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00111}00111\ \ \ \ \ \ \ \ \ x\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_a43b3a9c7c3b9efb07d6b35045089a017}{fc2}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer_ac55f67c862fe19a5920f4e19bfc25fb7}{fc1}}(x))\ +\ x}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00112}00112\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ x}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00113}00113\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00114}00114\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00115}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block}{00115}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block}{TransformerBlock}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00116}00116\ \ \ \ \ \textcolor{comment}{\#\ Vision\ Transformer\ https://arxiv.org/abs/2010.11929}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00117}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a3bd5f1f40acad21f7db54955be0d10a0}{00117}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a3bd5f1f40acad21f7db54955be0d10a0}{\_\_init\_\_}}(self,\ c1,\ c2,\ num\_heads,\ num\_layers):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00118}00118\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a3bd5f1f40acad21f7db54955be0d10a0}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00119}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a1dd91a1432d312a3ed1c4f877661a625}{00119}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a1dd91a1432d312a3ed1c4f877661a625}{conv}}\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00120}00120\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ c1\ !=\ c2:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00121}00121\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a1dd91a1432d312a3ed1c4f877661a625}{conv}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1,\ c2)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00122}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a528e5ddba1a6e6197dc0a1f53cfc0d09}{00122}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a528e5ddba1a6e6197dc0a1f53cfc0d09}{linear}}\ =\ nn.Linear(c2,\ c2)\ \ \textcolor{comment}{\#\ learnable\ position\ embedding}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00123}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a1fb404c568e5da3ce171d8166a0ad461}{00123}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a1fb404c568e5da3ce171d8166a0ad461}{tr}}\ =\ nn.Sequential(*(\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_layer}{TransformerLayer}}(c2,\ num\_heads)\ \textcolor{keywordflow}{for}\ \_\ \textcolor{keywordflow}{in}\ range(num\_layers)))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00124}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a9deb7369cfc396500a598cd1a98b6bda}{00124}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a9deb7369cfc396500a598cd1a98b6bda}{c2}}\ =\ c2}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00125}00125\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00126}\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_acf9a63adf29ef60e1c58a36779bb627f}{00126}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_acf9a63adf29ef60e1c58a36779bb627f}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00127}00127\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a1dd91a1432d312a3ed1c4f877661a625}{conv}}\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00128}00128\ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a1dd91a1432d312a3ed1c4f877661a625}{conv}}(x)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00129}00129\ \ \ \ \ \ \ \ \ b,\ \_,\ w,\ h\ =\ x.shape}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00130}00130\ \ \ \ \ \ \ \ \ p\ =\ x.flatten(2).permute(2,\ 0,\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00131}00131\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a1fb404c568e5da3ce171d8166a0ad461}{tr}}(p\ +\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a528e5ddba1a6e6197dc0a1f53cfc0d09}{linear}}(p)).permute(1,\ 2,\ 0).reshape(b,\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block_a9deb7369cfc396500a598cd1a98b6bda}{c2}},\ w,\ h)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00132}00132\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00133}00133\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00134}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck}{00134}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck}{Bottleneck}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00135}00135\ \ \ \ \ \textcolor{comment}{\#\ Standard\ bottleneck}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00136}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_a2564b616fb909cbc95fc6c1757aa13ef}{00136}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_a2564b616fb909cbc95fc6c1757aa13ef}{\_\_init\_\_}}(self,\ c1,\ c2,\ shortcut=True,\ g=1,\ e=0.5):\ \ \textcolor{comment}{\#\ ch\_in,\ ch\_out,\ shortcut,\ groups,\ expansion}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00137}00137\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_a2564b616fb909cbc95fc6c1757aa13ef}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ c\_\ =\ int(c2\ *\ e)\ \ \textcolor{comment}{\#\ hidden\ channels}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00139}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_a424adcd9e98f1cb91cc3234bf40975ad}{00139}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_a424adcd9e98f1cb91cc3234bf40975ad}{cv1}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1,\ c\_,\ 1,\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00140}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_adebaf30425b9d55bf80795b90af022b6}{00140}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_adebaf30425b9d55bf80795b90af022b6}{cv2}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c\_,\ c2,\ 3,\ 1,\ g=g)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00141}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_afd3d258814dd96f1ca54e952222a926b}{00141}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_afd3d258814dd96f1ca54e952222a926b}{add}}\ =\ shortcut\ \textcolor{keywordflow}{and}\ c1\ ==\ c2}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00142}00142\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00143}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_a7129357bcb3c76f40ad04ad1398a1b73}{00143}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_a7129357bcb3c76f40ad04ad1398a1b73}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00144}00144\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ x\ +\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_adebaf30425b9d55bf80795b90af022b6}{cv2}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_a424adcd9e98f1cb91cc3234bf40975ad}{cv1}}(x))\ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_afd3d258814dd96f1ca54e952222a926b}{add}}\ \textcolor{keywordflow}{else}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_adebaf30425b9d55bf80795b90af022b6}{cv2}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_a424adcd9e98f1cb91cc3234bf40975ad}{cv1}}(x))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00145}00145\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00146}00146\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00147}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p}{00147}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p}{BottleneckCSP}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00148}00148\ \ \ \ \ \textcolor{comment}{\#\ CSP\ Bottleneck\ https://github.com/WongKinYiu/CrossStagePartialNetworks}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00149}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a407bef7b3b035dd78f9009b03c0437d4}{00149}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a407bef7b3b035dd78f9009b03c0437d4}{\_\_init\_\_}}(self,\ c1,\ c2,\ n=1,\ shortcut=True,\ g=1,\ e=0.5):\ \ \textcolor{comment}{\#\ ch\_in,\ ch\_out,\ number,\ shortcut,\ groups,\ expansion}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00150}00150\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a407bef7b3b035dd78f9009b03c0437d4}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00151}00151\ \ \ \ \ \ \ \ \ c\_\ =\ int(c2\ *\ e)\ \ \textcolor{comment}{\#\ hidden\ channels}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00152}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a1ea2a08f32db7e592206fb510dbd07fb}{00152}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a1ea2a08f32db7e592206fb510dbd07fb}{cv1}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1,\ c\_,\ 1,\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00153}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a82cf9a996a05f97e51b77d19dbcc5210}{00153}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a82cf9a996a05f97e51b77d19dbcc5210}{cv2}}\ =\ nn.Conv2d(c1,\ c\_,\ 1,\ 1,\ bias=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00154}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a8fbcaba8cf7a8a7a2dd28038bc7df450}{00154}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a8fbcaba8cf7a8a7a2dd28038bc7df450}{cv3}}\ =\ nn.Conv2d(c\_,\ c\_,\ 1,\ 1,\ bias=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00155}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a71bce892799dfdafabca4ffd81ab5c6c}{00155}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a71bce892799dfdafabca4ffd81ab5c6c}{cv4}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(2\ *\ c\_,\ c2,\ 1,\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00156}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a121b4f54705284c6813b750b60535bb8}{00156}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a121b4f54705284c6813b750b60535bb8}{bn}}\ =\ nn.BatchNorm2d(2\ *\ c\_)\ \ \textcolor{comment}{\#\ applied\ to\ cat(cv2,\ cv3)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00157}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a204e602b9506745d441c8beaf9903343}{00157}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a204e602b9506745d441c8beaf9903343}{act}}\ =\ nn.SiLU()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00158}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_ab3c05e98d71476c025ca8df45845535e}{00158}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_ab3c05e98d71476c025ca8df45845535e}{m}}\ =\ nn.Sequential(*(\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck}{Bottleneck}}(c\_,\ c\_,\ shortcut,\ g,\ e=1.0)\ \textcolor{keywordflow}{for}\ \_\ \textcolor{keywordflow}{in}\ range(n)))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00159}00159\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00160}\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a8c35e2307f881b47904515749155a355}{00160}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a8c35e2307f881b47904515749155a355}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00161}00161\ \ \ \ \ \ \ \ \ y1\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a8fbcaba8cf7a8a7a2dd28038bc7df450}{cv3}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_ab3c05e98d71476c025ca8df45845535e}{m}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a1ea2a08f32db7e592206fb510dbd07fb}{cv1}}(x)))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00162}00162\ \ \ \ \ \ \ \ \ y2\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a82cf9a996a05f97e51b77d19dbcc5210}{cv2}}(x)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00163}00163\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a71bce892799dfdafabca4ffd81ab5c6c}{cv4}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a204e602b9506745d441c8beaf9903343}{act}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck_c_s_p_a121b4f54705284c6813b750b60535bb8}{bn}}(torch.cat((y1,\ y2),\ 1))))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00164}00164\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00166}\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv}{00166}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv}{CrossConv}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00167}00167\ \ \ \ \ \textcolor{comment}{\#\ Cross\ Convolution\ Downsample}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00168}\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_ad947858c591cd1facd1343a6eec40543}{00168}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_ad947858c591cd1facd1343a6eec40543}{\_\_init\_\_}}(self,\ c1,\ c2,\ k=3,\ s=1,\ g=1,\ e=1.0,\ shortcut=False):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00169}00169\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ ch\_in,\ ch\_out,\ kernel,\ stride,\ groups,\ expansion,\ shortcut}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00170}00170\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_ad947858c591cd1facd1343a6eec40543}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00171}00171\ \ \ \ \ \ \ \ \ c\_\ =\ int(c2\ *\ e)\ \ \textcolor{comment}{\#\ hidden\ channels}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00172}\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_af7a65b744bc7774c4d33350d40183316}{00172}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_af7a65b744bc7774c4d33350d40183316}{cv1}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1,\ c\_,\ (1,\ k),\ (1,\ s))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00173}\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_a9784dfc74c74622f424c20041de82c30}{00173}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_a9784dfc74c74622f424c20041de82c30}{cv2}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c\_,\ c2,\ (k,\ 1),\ (s,\ 1),\ g=g)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00174}\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_aab8445bfc5151ad879e354f46259015d}{00174}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_aab8445bfc5151ad879e354f46259015d}{add}}\ =\ shortcut\ \textcolor{keywordflow}{and}\ c1\ ==\ c2}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00175}00175\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00176}\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_a0744ee5c340b61b27ba8a8c088a159df}{00176}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_a0744ee5c340b61b27ba8a8c088a159df}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00177}00177\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ x\ +\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_a9784dfc74c74622f424c20041de82c30}{cv2}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_af7a65b744bc7774c4d33350d40183316}{cv1}}(x))\ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_aab8445bfc5151ad879e354f46259015d}{add}}\ \textcolor{keywordflow}{else}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_a9784dfc74c74622f424c20041de82c30}{cv2}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv_af7a65b744bc7774c4d33350d40183316}{cv1}}(x))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00178}00178\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00179}00179\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00180}\mbox{\hyperlink{classmodels_1_1common_1_1_c3}{00180}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_c3}{C3}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00181}00181\ \ \ \ \ \textcolor{comment}{\#\ CSP\ Bottleneck\ with\ 3\ convolutions}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00182}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a3bd0255c2a81e9bcdd6f55170cec2c7b}{00182}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a3bd0255c2a81e9bcdd6f55170cec2c7b}{\_\_init\_\_}}(self,\ c1,\ c2,\ n=1,\ shortcut=True,\ g=1,\ e=0.5):\ \ \textcolor{comment}{\#\ ch\_in,\ ch\_out,\ number,\ shortcut,\ groups,\ expansion}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00183}00183\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a3bd0255c2a81e9bcdd6f55170cec2c7b}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00184}00184\ \ \ \ \ \ \ \ \ c\_\ =\ int(c2\ *\ e)\ \ \textcolor{comment}{\#\ hidden\ channels}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00185}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a0dfdab68d86dff6c0ca4029af2407339}{00185}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a0dfdab68d86dff6c0ca4029af2407339}{cv1}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1,\ c\_,\ 1,\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00186}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a63cf8f78eef054075279900dd84e5139}{00186}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a63cf8f78eef054075279900dd84e5139}{cv2}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1,\ c\_,\ 1,\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00187}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a865fc81369279cff14d60572366cb26e}{00187}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a865fc81369279cff14d60572366cb26e}{cv3}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(2\ *\ c\_,\ c2,\ 1)\ \ \textcolor{comment}{\#\ optional\ act=FReLU(c2)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00188}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ad2b3fec6e8d0955a819289b4bd76fba4}{00188}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ad2b3fec6e8d0955a819289b4bd76fba4}{m}}\ =\ nn.Sequential(*(\mbox{\hyperlink{classmodels_1_1common_1_1_bottleneck}{Bottleneck}}(c\_,\ c\_,\ shortcut,\ g,\ e=1.0)\ \textcolor{keywordflow}{for}\ \_\ \textcolor{keywordflow}{in}\ range(n)))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00189}00189\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00190}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a915d4ba897501a9d13c3a5608ae625f9}{00190}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a915d4ba897501a9d13c3a5608ae625f9}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00191}00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a865fc81369279cff14d60572366cb26e}{cv3}}(torch.cat((self.\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ad2b3fec6e8d0955a819289b4bd76fba4}{m}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a0dfdab68d86dff6c0ca4029af2407339}{cv1}}(x)),\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_c3_a63cf8f78eef054075279900dd84e5139}{cv2}}(x)),\ 1))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00193}00193\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00194}\mbox{\hyperlink{classmodels_1_1common_1_1_c3x}{00194}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_c3x}{C3x}}(\mbox{\hyperlink{classmodels_1_1common_1_1_c3}{C3}}):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00195}00195\ \ \ \ \ \textcolor{comment}{\#\ C3\ module\ with\ cross-\/convolutions}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00196}\mbox{\hyperlink{classmodels_1_1common_1_1_c3x_a1f9f675b1cda468c25c6ab0732b7f48f}{00196}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_c3x_a1f9f675b1cda468c25c6ab0732b7f48f}{\_\_init\_\_}}(self,\ c1,\ c2,\ n=1,\ shortcut=True,\ g=1,\ e=0.5):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00197}00197\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_c3x_a1f9f675b1cda468c25c6ab0732b7f48f}{\_\_init\_\_}}(c1,\ c2,\ n,\ shortcut,\ g,\ e)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00198}00198\ \ \ \ \ \ \ \ \ c\_\ =\ int(c2\ *\ e)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00199}\mbox{\hyperlink{classmodels_1_1common_1_1_c3x_a8effd7df49db0d8482dbe0faf3bb15c8}{00199}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ad2b3fec6e8d0955a819289b4bd76fba4}{m}}\mbox{\hyperlink{classmodels_1_1common_1_1_c3x_a8effd7df49db0d8482dbe0faf3bb15c8}{m}}\ =\ nn.Sequential(*(\mbox{\hyperlink{classmodels_1_1common_1_1_cross_conv}{CrossConv}}(c\_,\ c\_,\ 3,\ 1,\ g,\ 1.0,\ shortcut)\ \textcolor{keywordflow}{for}\ \_\ \textcolor{keywordflow}{in}\ range(n)))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00200}00200\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00201}00201\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00202}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_t_r}{00202}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_c3_t_r}{C3TR}}(\mbox{\hyperlink{classmodels_1_1common_1_1_c3}{C3}}):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00203}00203\ \ \ \ \ \textcolor{comment}{\#\ C3\ module\ with\ TransformerBlock()}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00204}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_t_r_a3f4820a16f3f2bf342f1bd54f009b360}{00204}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_c3_t_r_a3f4820a16f3f2bf342f1bd54f009b360}{\_\_init\_\_}}(self,\ c1,\ c2,\ n=1,\ shortcut=True,\ g=1,\ e=0.5):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00205}00205\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_c3_t_r_a3f4820a16f3f2bf342f1bd54f009b360}{\_\_init\_\_}}(c1,\ c2,\ n,\ shortcut,\ g,\ e)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00206}00206\ \ \ \ \ \ \ \ \ c\_\ =\ int(c2\ *\ e)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00207}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_t_r_a949ee9de12ad6dd01e45c2fd051c2371}{00207}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ad2b3fec6e8d0955a819289b4bd76fba4}{m}}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_t_r_a949ee9de12ad6dd01e45c2fd051c2371}{m}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_transformer_block}{TransformerBlock}}(c\_,\ c\_,\ 4,\ n)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00208}00208\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00209}00209\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00210}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_s_p_p}{00210}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_c3_s_p_p}{C3SPP}}(\mbox{\hyperlink{classmodels_1_1common_1_1_c3}{C3}}):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00211}00211\ \ \ \ \ \textcolor{comment}{\#\ C3\ module\ with\ SPP()}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00212}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_s_p_p_a5f747574dbddd4cd5e9012f166d43d80}{00212}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_c3_s_p_p_a5f747574dbddd4cd5e9012f166d43d80}{\_\_init\_\_}}(self,\ c1,\ c2,\ k=(5,\ 9,\ 13),\ n=1,\ shortcut=\textcolor{keyword}{True},\ g=1,\ e=0.5):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00213}00213\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_c3_s_p_p_a5f747574dbddd4cd5e9012f166d43d80}{\_\_init\_\_}}(c1,\ c2,\ n,\ shortcut,\ g,\ e)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00214}00214\ \ \ \ \ \ \ \ \ c\_\ =\ int(c2\ *\ e)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00215}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_s_p_p_a4cc0f38e3177965da4b7d09315d09fe8}{00215}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ad2b3fec6e8d0955a819289b4bd76fba4}{m}}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_s_p_p_a4cc0f38e3177965da4b7d09315d09fe8}{m}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p}{SPP}}(c\_,\ c\_,\ k)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00216}00216\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00217}00217\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00218}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ghost}{00218}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ghost}{C3Ghost}}(\mbox{\hyperlink{classmodels_1_1common_1_1_c3}{C3}}):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00219}00219\ \ \ \ \ \textcolor{comment}{\#\ C3\ module\ with\ GhostBottleneck()}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00220}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ghost_a214452a536aa219aff011315a7d91bad}{00220}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ghost_a214452a536aa219aff011315a7d91bad}{\_\_init\_\_}}(self,\ c1,\ c2,\ n=1,\ shortcut=True,\ g=1,\ e=0.5):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00221}00221\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ghost_a214452a536aa219aff011315a7d91bad}{\_\_init\_\_}}(c1,\ c2,\ n,\ shortcut,\ g,\ e)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00222}00222\ \ \ \ \ \ \ \ \ c\_\ =\ int(c2\ *\ e)\ \ \textcolor{comment}{\#\ hidden\ channels}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00223}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ghost_af7e4e07fd4fd46ed11e5beae99f040bc}{00223}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ad2b3fec6e8d0955a819289b4bd76fba4}{m}}\mbox{\hyperlink{classmodels_1_1common_1_1_c3_ghost_af7e4e07fd4fd46ed11e5beae99f040bc}{m}}\ =\ nn.Sequential(*(\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck}{GhostBottleneck}}(c\_,\ c\_)\ \textcolor{keywordflow}{for}\ \_\ \textcolor{keywordflow}{in}\ range(n)))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00224}00224\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00225}00225\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00226}\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p}{00226}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p}{SPP}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00227}00227\ \ \ \ \ \textcolor{comment}{\#\ Spatial\ Pyramid\ Pooling\ (SPP)\ layer\ https://arxiv.org/abs/1406.4729}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00228}\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_afb456a36fcdc37c18a3ee22128841ede}{00228}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_afb456a36fcdc37c18a3ee22128841ede}{\_\_init\_\_}}(self,\ c1,\ c2,\ k=(5,\ 9,\ 13)):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00229}00229\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_afb456a36fcdc37c18a3ee22128841ede}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00230}00230\ \ \ \ \ \ \ \ \ c\_\ =\ c1\ //\ 2\ \ \textcolor{comment}{\#\ hidden\ channels}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00231}\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_aa09994a5fec19606c495e151e7b66eb8}{00231}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_aa09994a5fec19606c495e151e7b66eb8}{cv1}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1,\ c\_,\ 1,\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00232}\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_adc2184a62fc295b1f23d415effafaadb}{00232}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_adc2184a62fc295b1f23d415effafaadb}{cv2}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c\_\ *\ (len(k)\ +\ 1),\ c2,\ 1,\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00233}\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_ad05feca4b83f58d9dd088c370deecce3}{00233}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_ad05feca4b83f58d9dd088c370deecce3}{m}}\ =\ nn.ModuleList([nn.MaxPool2d(kernel\_size=x,\ stride=1,\ padding=x\ //\ 2)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ k])}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00234}00234\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00235}\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_ac83ebfeb2e92609b6684a08426a37c20}{00235}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_ac83ebfeb2e92609b6684a08426a37c20}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00236}00236\ \ \ \ \ \ \ \ \ x\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_aa09994a5fec19606c495e151e7b66eb8}{cv1}}(x)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00237}00237\ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ warnings.catch\_warnings():}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00238}00238\ \ \ \ \ \ \ \ \ \ \ \ \ warnings.simplefilter(\textcolor{stringliteral}{"{}ignore"{}})\ \ \textcolor{comment}{\#\ suppress\ torch\ 1.9.0\ max\_pool2d()\ warning}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00239}00239\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_adc2184a62fc295b1f23d415effafaadb}{cv2}}(torch.cat([x]\ +\ [\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_ad05feca4b83f58d9dd088c370deecce3}{m}}(x)\ \textcolor{keywordflow}{for}\ m\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_ad05feca4b83f58d9dd088c370deecce3}{m}}],\ 1))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00240}00240\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00241}00241\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00242}\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f}{00242}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f}{SPPF}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00243}00243\ \ \ \ \ \textcolor{comment}{\#\ Spatial\ Pyramid\ Pooling\ -\/\ Fast\ (SPPF)\ layer\ for\ YOLOv5\ by\ Glenn\ Jocher}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00244}\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_abf715131f181442c6b0d274215b4b0ab}{00244}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_abf715131f181442c6b0d274215b4b0ab}{\_\_init\_\_}}(self,\ c1,\ c2,\ k=5):\ \ \textcolor{comment}{\#\ equivalent\ to\ SPP(k=(5,\ 9,\ 13))}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00245}00245\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_abf715131f181442c6b0d274215b4b0ab}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00246}00246\ \ \ \ \ \ \ \ \ c\_\ =\ c1\ //\ 2\ \ \textcolor{comment}{\#\ hidden\ channels}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00247}\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_a4f8a9d121605fb263d10c72d1c3da6a2}{00247}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_a4f8a9d121605fb263d10c72d1c3da6a2}{cv1}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1,\ c\_,\ 1,\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00248}\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_ad53caab4bc2d7d62fc2572082b5ee4fb}{00248}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_ad53caab4bc2d7d62fc2572082b5ee4fb}{cv2}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c\_\ *\ 4,\ c2,\ 1,\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00249}\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_aff48071b35769db4c52d200eb14ac99b}{00249}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_aff48071b35769db4c52d200eb14ac99b}{m}}\ =\ nn.MaxPool2d(kernel\_size=k,\ stride=1,\ padding=k\ //\ 2)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00250}00250\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00251}\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_a7396085a0a00a4cc821267a57e8e334e}{00251}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_a7396085a0a00a4cc821267a57e8e334e}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00252}00252\ \ \ \ \ \ \ \ \ x\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_a4f8a9d121605fb263d10c72d1c3da6a2}{cv1}}(x)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00253}00253\ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ warnings.catch\_warnings():}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00254}00254\ \ \ \ \ \ \ \ \ \ \ \ \ warnings.simplefilter(\textcolor{stringliteral}{"{}ignore"{}})\ \ \textcolor{comment}{\#\ suppress\ torch\ 1.9.0\ max\_pool2d()\ warning}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00255}00255\ \ \ \ \ \ \ \ \ \ \ \ \ y1\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_aff48071b35769db4c52d200eb14ac99b}{m}}(x)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00256}00256\ \ \ \ \ \ \ \ \ \ \ \ \ y2\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_aff48071b35769db4c52d200eb14ac99b}{m}}(y1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00257}00257\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_ad53caab4bc2d7d62fc2572082b5ee4fb}{cv2}}(torch.cat((x,\ y1,\ y2,\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_s_p_p_f_aff48071b35769db4c52d200eb14ac99b}{m}}(y2)),\ 1))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00258}00258\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00259}00259\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00260}\mbox{\hyperlink{classmodels_1_1common_1_1_focus}{00260}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_focus}{Focus}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00261}00261\ \ \ \ \ \textcolor{comment}{\#\ Focus\ wh\ information\ into\ c-\/space}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00262}\mbox{\hyperlink{classmodels_1_1common_1_1_focus_a7537862fe64c5201f1fbd30520aee37e}{00262}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_focus_a7537862fe64c5201f1fbd30520aee37e}{\_\_init\_\_}}(self,\ c1,\ c2,\ k=1,\ s=1,\ p=None,\ g=1,\ act=True):\ \ \textcolor{comment}{\#\ ch\_in,\ ch\_out,\ kernel,\ stride,\ padding,\ groups}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00263}00263\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_focus_a7537862fe64c5201f1fbd30520aee37e}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00264}\mbox{\hyperlink{classmodels_1_1common_1_1_focus_a588438760aa01b64c797ce191a962bfe}{00264}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_focus_a588438760aa01b64c797ce191a962bfe}{conv}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1\ *\ 4,\ c2,\ k,\ s,\ p,\ g,\ act=act)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00265}00265\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ self.contract\ =\ Contract(gain=2)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00266}00266\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00267}\mbox{\hyperlink{classmodels_1_1common_1_1_focus_aada03c39e874c4287f68cf52118329cc}{00267}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_focus_aada03c39e874c4287f68cf52118329cc}{forward}}(self,\ x):\ \ \textcolor{comment}{\#\ x(b,c,w,h)\ -\/>\ y(b,4c,w/2,h/2)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00268}00268\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_focus_a588438760aa01b64c797ce191a962bfe}{conv}}(torch.cat((x[...,\ ::2,\ ::2],\ x[...,\ 1::2,\ ::2],\ x[...,\ ::2,\ 1::2],\ x[...,\ 1::2,\ 1::2]),\ 1))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00269}00269\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ return\ self.conv(self.contract(x))}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00270}00270\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00271}00271\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00272}\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv}{00272}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv}{GhostConv}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00273}00273\ \ \ \ \ \textcolor{comment}{\#\ Ghost\ Convolution\ https://github.com/huawei-\/noah/ghostnet}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00274}\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv_af122fb65ac472a4dd3117b641ad3c8dc}{00274}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv_af122fb65ac472a4dd3117b641ad3c8dc}{\_\_init\_\_}}(self,\ c1,\ c2,\ k=1,\ s=1,\ g=1,\ act=True):\ \ \textcolor{comment}{\#\ ch\_in,\ ch\_out,\ kernel,\ stride,\ groups}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00275}00275\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv_af122fb65ac472a4dd3117b641ad3c8dc}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00276}00276\ \ \ \ \ \ \ \ \ c\_\ =\ c2\ //\ 2\ \ \textcolor{comment}{\#\ hidden\ channels}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00277}\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv_a8db4c0725a3f78b517b37cc467b2c946}{00277}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv_a8db4c0725a3f78b517b37cc467b2c946}{cv1}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1,\ c\_,\ k,\ s,\ \textcolor{keywordtype}{None},\ g,\ act=act)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00278}\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv_a0cdabc7ad26271272285a3a77169a440}{00278}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv_a0cdabc7ad26271272285a3a77169a440}{cv2}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c\_,\ c\_,\ 5,\ 1,\ \textcolor{keywordtype}{None},\ c\_,\ act=act)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00279}00279\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00280}\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv_adff454a330f9a1674441044a45244aad}{00280}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv_adff454a330f9a1674441044a45244aad}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00281}00281\ \ \ \ \ \ \ \ \ y\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv_a8db4c0725a3f78b517b37cc467b2c946}{cv1}}(x)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00282}00282\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ torch.cat((y,\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv_a0cdabc7ad26271272285a3a77169a440}{cv2}}(y)),\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00283}00283\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00284}00284\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00285}\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck}{00285}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck}{GhostBottleneck}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00286}00286\ \ \ \ \ \textcolor{comment}{\#\ Ghost\ Bottleneck\ https://github.com/huawei-\/noah/ghostnet}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00287}\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck_a4e77b2675d30697bb18c9fe4ecbd19c3}{00287}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck_a4e77b2675d30697bb18c9fe4ecbd19c3}{\_\_init\_\_}}(self,\ c1,\ c2,\ k=3,\ s=1):\ \ \textcolor{comment}{\#\ ch\_in,\ ch\_out,\ kernel,\ stride}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00288}00288\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck_a4e77b2675d30697bb18c9fe4ecbd19c3}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00289}00289\ \ \ \ \ \ \ \ \ c\_\ =\ c2\ //\ 2}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00290}\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck_a5e88618f2967bf316949ce34b0a095e4}{00290}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck_a5e88618f2967bf316949ce34b0a095e4}{conv}}\ =\ nn.Sequential(}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00291}00291\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv}{GhostConv}}(c1,\ c\_,\ 1,\ 1),\ \ \textcolor{comment}{\#\ pw}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00292}00292\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classmodels_1_1common_1_1_d_w_conv}{DWConv}}(c\_,\ c\_,\ k,\ s,\ act=\textcolor{keyword}{False})\ \textcolor{keywordflow}{if}\ s\ ==\ 2\ \textcolor{keywordflow}{else}\ nn.Identity(),\ \ \textcolor{comment}{\#\ dw}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00293}00293\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classmodels_1_1common_1_1_ghost_conv}{GhostConv}}(c\_,\ c2,\ 1,\ 1,\ act=\textcolor{keyword}{False}),}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00294}00294\ \ \ \ \ \ \ \ \ )\ \ \textcolor{comment}{\#\ pw-\/linear}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00295}\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck_a87a49d107226dc379011d63df9a9320b}{00295}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck_a87a49d107226dc379011d63df9a9320b}{shortcut}}\ =\ (}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00296}00296\ \ \ \ \ \ \ \ \ \ \ \ \ nn.Sequential(\mbox{\hyperlink{classmodels_1_1common_1_1_d_w_conv}{DWConv}}(c1,\ c1,\ k,\ s,\ act=\textcolor{keyword}{False}),\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1,\ c2,\ 1,\ 1,\ act=\textcolor{keyword}{False}))\ \textcolor{keywordflow}{if}\ s\ ==\ 2\ \textcolor{keywordflow}{else}\ nn.Identity()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00297}00297\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00298}00298\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00299}\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck_a791f185d12330b116358ba5a320e6529}{00299}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck_a791f185d12330b116358ba5a320e6529}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00300}00300\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck_a5e88618f2967bf316949ce34b0a095e4}{conv}}(x)\ +\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_ghost_bottleneck_a87a49d107226dc379011d63df9a9320b}{shortcut}}(x)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00301}00301\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00302}00302\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00303}\mbox{\hyperlink{classmodels_1_1common_1_1_contract}{00303}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_contract}{Contract}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00304}00304\ \ \ \ \ \textcolor{comment}{\#\ Contract\ width-\/height\ into\ channels,\ i.e.\ x(1,64,80,80)\ to\ x(1,256,40,40)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00305}\mbox{\hyperlink{classmodels_1_1common_1_1_contract_a79f3a12aac03848b973cfb33fffb71c8}{00305}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_contract_a79f3a12aac03848b973cfb33fffb71c8}{\_\_init\_\_}}(self,\ gain=2):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00306}00306\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_contract_a79f3a12aac03848b973cfb33fffb71c8}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00307}\mbox{\hyperlink{classmodels_1_1common_1_1_contract_a4ed02bb643cef347799f5488d1d4b631}{00307}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_contract_a4ed02bb643cef347799f5488d1d4b631}{gain}}\ =\ gain}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00308}00308\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00309}\mbox{\hyperlink{classmodels_1_1common_1_1_contract_a546c59aa82de6b94c72a3a6606c75e55}{00309}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_contract_a546c59aa82de6b94c72a3a6606c75e55}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00310}00310\ \ \ \ \ \ \ \ \ b,\ c,\ h,\ w\ =\ x.size()\ \ \textcolor{comment}{\#\ assert\ (h\ /\ s\ ==\ 0)\ and\ (W\ /\ s\ ==\ 0),\ 'Indivisible\ gain'}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00311}00311\ \ \ \ \ \ \ \ \ s\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_contract_a4ed02bb643cef347799f5488d1d4b631}{gain}}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00312}00312\ \ \ \ \ \ \ \ \ x\ =\ x.view(b,\ c,\ h\ //\ s,\ s,\ w\ //\ s,\ s)\ \ \textcolor{comment}{\#\ x(1,64,40,2,40,2)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00313}00313\ \ \ \ \ \ \ \ \ x\ =\ x.permute(0,\ 3,\ 5,\ 1,\ 2,\ 4).contiguous()\ \ \textcolor{comment}{\#\ x(1,2,2,64,40,40)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00314}00314\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ x.view(b,\ c\ *\ s\ *\ s,\ h\ //\ s,\ w\ //\ s)\ \ \textcolor{comment}{\#\ x(1,256,40,40)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00315}00315\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00316}00316\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00317}\mbox{\hyperlink{classmodels_1_1common_1_1_expand}{00317}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_expand}{Expand}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00318}00318\ \ \ \ \ \textcolor{comment}{\#\ Expand\ channels\ into\ width-\/height,\ i.e.\ x(1,64,80,80)\ to\ x(1,16,160,160)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00319}\mbox{\hyperlink{classmodels_1_1common_1_1_expand_aaa46685799587873a01ba3657f23e4be}{00319}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_expand_aaa46685799587873a01ba3657f23e4be}{\_\_init\_\_}}(self,\ gain=2):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00320}00320\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_expand_aaa46685799587873a01ba3657f23e4be}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00321}\mbox{\hyperlink{classmodels_1_1common_1_1_expand_a0301311180036485da4ecedeca55d595}{00321}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_expand_a0301311180036485da4ecedeca55d595}{gain}}\ =\ gain}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00322}00322\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00323}\mbox{\hyperlink{classmodels_1_1common_1_1_expand_a8469c315147b689f1bacccd92ca05a42}{00323}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_expand_a8469c315147b689f1bacccd92ca05a42}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00324}00324\ \ \ \ \ \ \ \ \ b,\ c,\ h,\ w\ =\ x.size()\ \ \textcolor{comment}{\#\ assert\ C\ /\ s\ **\ 2\ ==\ 0,\ 'Indivisible\ gain'}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00325}00325\ \ \ \ \ \ \ \ \ s\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_expand_a0301311180036485da4ecedeca55d595}{gain}}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00326}00326\ \ \ \ \ \ \ \ \ x\ =\ x.view(b,\ s,\ s,\ c\ //\ s**2,\ h,\ w)\ \ \textcolor{comment}{\#\ x(1,2,2,16,80,80)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00327}00327\ \ \ \ \ \ \ \ \ x\ =\ x.permute(0,\ 3,\ 4,\ 1,\ 5,\ 2).contiguous()\ \ \textcolor{comment}{\#\ x(1,16,80,2,80,2)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00328}00328\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ x.view(b,\ c\ //\ s**2,\ h\ *\ s,\ w\ *\ s)\ \ \textcolor{comment}{\#\ x(1,16,160,160)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00329}00329\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00330}00330\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00331}\mbox{\hyperlink{classmodels_1_1common_1_1_concat}{00331}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_concat}{Concat}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00332}00332\ \ \ \ \ \textcolor{comment}{\#\ Concatenate\ a\ list\ of\ tensors\ along\ dimension}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00333}\mbox{\hyperlink{classmodels_1_1common_1_1_concat_af8345d51f451ae179297c70a2f479f03}{00333}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_concat_af8345d51f451ae179297c70a2f479f03}{\_\_init\_\_}}(self,\ dimension=1):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00334}00334\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_concat_af8345d51f451ae179297c70a2f479f03}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00335}\mbox{\hyperlink{classmodels_1_1common_1_1_concat_aba40c68e29f694dd5a83e26e1f253d89}{00335}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_concat_aba40c68e29f694dd5a83e26e1f253d89}{d}}\ =\ dimension}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00336}00336\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00337}\mbox{\hyperlink{classmodels_1_1common_1_1_concat_ad9423e253e0188a68a9cf945dfcae629}{00337}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_concat_ad9423e253e0188a68a9cf945dfcae629}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00338}00338\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ torch.cat(x,\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_concat_aba40c68e29f694dd5a83e26e1f253d89}{d}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00339}00339\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00340}00340\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00341}\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend}{00341}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend}{DetectMultiBackend}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00342}00342\ \ \ \ \ \textcolor{comment}{\#\ YOLOv5\ MultiBackend\ class\ for\ python\ inference\ on\ various\ backends}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00343}\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a15cee4d4f9de61de68124d728d5c1446}{00343}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a15cee4d4f9de61de68124d728d5c1446}{\_\_init\_\_}}(self,\ weights="{}yolov5s.pt"{},\ device=torch.device(\textcolor{stringliteral}{"{}cpu"{}}),\ dnn=\textcolor{keyword}{False},\ data=\textcolor{keywordtype}{None},\ fp16=\textcolor{keyword}{False},\ fuse=\textcolor{keyword}{True}):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00344}00344\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Usage:}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00345}00345\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ PyTorch:\ \ \ \ \ \ \ \ \ \ \ \ \ \ weights\ =\ *.pt}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00346}00346\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ TorchScript:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *.torchscript}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00347}00347\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ ONNX\ Runtime:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *.onnx}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00348}00348\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ ONNX\ OpenCV\ DNN:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *.onnx\ -\/-\/dnn}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00349}00349\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ OpenVINO:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\_openvino\_model}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00350}00350\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ CoreML:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *.mlmodel}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00351}00351\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ TensorRT:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *.engine}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00352}00352\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ TensorFlow\ SavedModel:\ \ \ \ \ \ \ \ \ \ *\_saved\_model}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00353}00353\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ TensorFlow\ GraphDef:\ \ \ \ \ \ \ \ \ \ \ \ *.pb}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00354}00354\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ TensorFlow\ Lite:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *.tflite}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00355}00355\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ TensorFlow\ Edge\ TPU:\ \ \ \ \ \ \ \ \ \ \ \ *\_edgetpu.tflite}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00356}00356\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ PaddlePaddle:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\_paddle\_model}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00357}00357\ \ \ \ \ \ \ \ \ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacemodels_1_1experimental}{models.experimental}}\ \textcolor{keyword}{import}\ attempt\_download,\ attempt\_load\ \ \textcolor{comment}{\#\ scoped\ to\ avoid\ circular\ import}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00358}00358\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00359}00359\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a15cee4d4f9de61de68124d728d5c1446}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00360}00360\ \ \ \ \ \ \ \ \ w\ =\ str(weights[0]\ \textcolor{keywordflow}{if}\ isinstance(weights,\ list)\ \textcolor{keywordflow}{else}\ weights)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00361}00361\ \ \ \ \ \ \ \ \ pt,\ jit,\ onnx,\ xml,\ engine,\ coreml,\ saved\_model,\ pb,\ tflite,\ edgetpu,\ tfjs,\ paddle,\ triton\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a44967ccbbf9583ae1d997dbbdfcf2972}{\_model\_type}}(w)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00362}00362\ \ \ \ \ \ \ \ \ fp16\ \&=\ pt\ \textcolor{keywordflow}{or}\ jit\ \textcolor{keywordflow}{or}\ onnx\ \textcolor{keywordflow}{or}\ engine\ \textcolor{keywordflow}{or}\ triton\ \ \textcolor{comment}{\#\ FP16}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00363}00363\ \ \ \ \ \ \ \ \ nhwc\ =\ coreml\ \textcolor{keywordflow}{or}\ saved\_model\ \textcolor{keywordflow}{or}\ pb\ \textcolor{keywordflow}{or}\ tflite\ \textcolor{keywordflow}{or}\ edgetpu\ \ \textcolor{comment}{\#\ BHWC\ formats\ (vs\ torch\ BCWH)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00364}00364\ \ \ \ \ \ \ \ \ stride\ =\ 32\ \ \textcolor{comment}{\#\ default\ stride}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00365}00365\ \ \ \ \ \ \ \ \ cuda\ =\ torch.cuda.is\_available()\ \textcolor{keywordflow}{and}\ device.type\ !=\ \textcolor{stringliteral}{"{}cpu"{}}\ \ \textcolor{comment}{\#\ use\ CUDA}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00366}00366\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ (pt\ \textcolor{keywordflow}{or}\ triton):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00367}00367\ \ \ \ \ \ \ \ \ \ \ \ \ w\ =\ attempt\_download(w)\ \ \textcolor{comment}{\#\ download\ if\ not\ local}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00368}00368\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00369}00369\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ pt:\ \ \textcolor{comment}{\#\ PyTorch}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00370}00370\ \ \ \ \ \ \ \ \ \ \ \ \ model\ =\ attempt\_load(weights\ \textcolor{keywordflow}{if}\ isinstance(weights,\ list)\ \textcolor{keywordflow}{else}\ w,\ device=device,\ inplace=\textcolor{keyword}{True},\ fuse=fuse)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00371}00371\ \ \ \ \ \ \ \ \ \ \ \ \ stride\ =\ max(int(model.stride.max()),\ 32)\ \ \textcolor{comment}{\#\ model\ stride}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00372}00372\ \ \ \ \ \ \ \ \ \ \ \ \ names\ =\ model.module.names\ \textcolor{keywordflow}{if}\ hasattr(model,\ \textcolor{stringliteral}{"{}module"{}})\ \textcolor{keywordflow}{else}\ model.names\ \ \textcolor{comment}{\#\ get\ class\ names}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00373}00373\ \ \ \ \ \ \ \ \ \ \ \ \ model.half()\ \textcolor{keywordflow}{if}\ fp16\ \textcolor{keywordflow}{else}\ model.float()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00374}\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a033df5e210331fcfa64d74fc55bc2260}{00374}}\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a033df5e210331fcfa64d74fc55bc2260}{model}}\ =\ model\ \ \textcolor{comment}{\#\ explicitly\ assign\ for\ to(),\ cpu(),\ cuda(),\ half()}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00375}00375\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ jit:\ \ \textcolor{comment}{\#\ TorchScript}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00376}00376\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Loading\ \{w\}\ for\ TorchScript\ inference..."{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00377}00377\ \ \ \ \ \ \ \ \ \ \ \ \ extra\_files\ =\ \{\textcolor{stringliteral}{"{}config.txt"{}}:\ \textcolor{stringliteral}{"{}"{}}\}\ \ \textcolor{comment}{\#\ model\ metadata}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00378}00378\ \ \ \ \ \ \ \ \ \ \ \ \ model\ =\ torch.jit.load(w,\ \_extra\_files=extra\_files,\ map\_location=device)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00379}00379\ \ \ \ \ \ \ \ \ \ \ \ \ model.half()\ \textcolor{keywordflow}{if}\ fp16\ \textcolor{keywordflow}{else}\ model.float()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00380}00380\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ extra\_files[\textcolor{stringliteral}{"{}config.txt"{}}]:\ \ \textcolor{comment}{\#\ load\ metadata\ dict}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00381}00381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ d\ =\ json.loads(}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00382}00382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ extra\_files[\textcolor{stringliteral}{"{}config.txt"{}}],}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00383}00383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ object\_hook=\textcolor{keyword}{lambda}\ d:\ \{int(k)\ \textcolor{keywordflow}{if}\ k.isdigit()\ \textcolor{keywordflow}{else}\ k:\ v\ \textcolor{keywordflow}{for}\ k,\ v\ \textcolor{keywordflow}{in}\ d.items()\},}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00384}00384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00385}00385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stride,\ names\ =\ int(d[\textcolor{stringliteral}{"{}stride"{}}]),\ d[\textcolor{stringliteral}{"{}names"{}}]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00386}00386\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ dnn:\ \ \textcolor{comment}{\#\ ONNX\ OpenCV\ DNN}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00387}00387\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Loading\ \{w\}\ for\ ONNX\ OpenCV\ DNN\ inference..."{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00388}00388\ \ \ \ \ \ \ \ \ \ \ \ \ check\_requirements(\textcolor{stringliteral}{"{}opencv-\/python>=4.5.4"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00389}00389\ \ \ \ \ \ \ \ \ \ \ \ \ net\ =\ cv2.dnn.readNetFromONNX(w)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00390}00390\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ onnx:\ \ \textcolor{comment}{\#\ ONNX\ Runtime}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00391}00391\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Loading\ \{w\}\ for\ ONNX\ Runtime\ inference..."{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00392}00392\ \ \ \ \ \ \ \ \ \ \ \ \ check\_requirements((\textcolor{stringliteral}{"{}onnx"{}},\ \textcolor{stringliteral}{"{}onnxruntime-\/gpu"{}}\ \textcolor{keywordflow}{if}\ cuda\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{"{}onnxruntime"{}}))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00393}00393\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{import}\ onnxruntime}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00394}00394\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00395}00395\ \ \ \ \ \ \ \ \ \ \ \ \ providers\ =\ [\textcolor{stringliteral}{"{}CUDAExecutionProvider"{}},\ \textcolor{stringliteral}{"{}CPUExecutionProvider"{}}]\ \textcolor{keywordflow}{if}\ cuda\ \textcolor{keywordflow}{else}\ [\textcolor{stringliteral}{"{}CPUExecutionProvider"{}}]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00396}00396\ \ \ \ \ \ \ \ \ \ \ \ \ session\ =\ onnxruntime.InferenceSession(w,\ providers=providers)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00397}00397\ \ \ \ \ \ \ \ \ \ \ \ \ output\_names\ =\ [x.name\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ session.get\_outputs()]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00398}00398\ \ \ \ \ \ \ \ \ \ \ \ \ meta\ =\ session.get\_modelmeta().custom\_metadata\_map\ \ \textcolor{comment}{\#\ metadata}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00399}00399\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}stride"{}}\ \textcolor{keywordflow}{in}\ meta:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00400}00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stride,\ names\ =\ int(meta[\textcolor{stringliteral}{"{}stride"{}}]),\ eval(meta[\textcolor{stringliteral}{"{}names"{}}])}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00401}00401\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ xml:\ \ \textcolor{comment}{\#\ OpenVINO}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00402}00402\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Loading\ \{w\}\ for\ OpenVINO\ inference..."{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00403}00403\ \ \ \ \ \ \ \ \ \ \ \ \ check\_requirements(\textcolor{stringliteral}{"{}openvino>=2023.0"{}})\ \ \textcolor{comment}{\#\ requires\ openvino-\/dev:\ https://pypi.org/project/openvino-\/dev/}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00404}00404\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{from}\ openvino.runtime\ \textcolor{keyword}{import}\ Core,\ Layout,\ get\_batch}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00405}00405\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00406}00406\ \ \ \ \ \ \ \ \ \ \ \ \ core\ =\ Core()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00407}00407\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ Path(w).is\_file():\ \ \textcolor{comment}{\#\ if\ not\ *.xml}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00408}00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\ =\ next(Path(w).glob(\textcolor{stringliteral}{"{}*.xml"{}}))\ \ \textcolor{comment}{\#\ get\ *.xml\ file\ from\ *\_openvino\_model\ dir}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00409}00409\ \ \ \ \ \ \ \ \ \ \ \ \ ov\_model\ =\ core.read\_model(model=w,\ weights=Path(w).with\_suffix(\textcolor{stringliteral}{"{}.bin"{}}))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00410}00410\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ov\_model.get\_parameters()[0].get\_layout().empty:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00411}00411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ov\_model.get\_parameters()[0].set\_layout(Layout(\textcolor{stringliteral}{"{}NCHW"{}}))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00412}00412\ \ \ \ \ \ \ \ \ \ \ \ \ batch\_dim\ =\ get\_batch(ov\_model)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00413}00413\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ batch\_dim.is\_static:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00414}00414\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ batch\_size\ =\ batch\_dim.get\_length()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00415}00415\ \ \ \ \ \ \ \ \ \ \ \ \ ov\_compiled\_model\ =\ core.compile\_model(ov\_model,\ device\_name=\textcolor{stringliteral}{"{}AUTO"{}})\ \ \textcolor{comment}{\#\ AUTO\ selects\ best\ available\ device}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00416}00416\ \ \ \ \ \ \ \ \ \ \ \ \ stride,\ names\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a43dd9d6acfff7d0e011dbb58750047f1}{\_load\_metadata}}(Path(w).with\_suffix(\textcolor{stringliteral}{"{}.yaml"{}}))\ \ \textcolor{comment}{\#\ load\ metadata}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00417}00417\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ engine:\ \ \textcolor{comment}{\#\ TensorRT}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00418}00418\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Loading\ \{w\}\ for\ TensorRT\ inference..."{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00419}00419\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{import}\ tensorrt\ \textcolor{keyword}{as}\ trt\ \ \textcolor{comment}{\#\ https://developer.nvidia.com/nvidia-\/tensorrt-\/download}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00420}00420\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00421}00421\ \ \ \ \ \ \ \ \ \ \ \ \ check\_version(trt.\_\_version\_\_,\ \textcolor{stringliteral}{"{}7.0.0"{}},\ hard=\textcolor{keyword}{True})\ \ \textcolor{comment}{\#\ require\ tensorrt>=7.0.0}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00422}00422\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ device.type\ ==\ \textcolor{stringliteral}{"{}cpu"{}}:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00423}00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ device\ =\ torch.device(\textcolor{stringliteral}{"{}cuda:0"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00424}00424\ \ \ \ \ \ \ \ \ \ \ \ \ Binding\ =\ namedtuple(\textcolor{stringliteral}{"{}Binding"{}},\ (\textcolor{stringliteral}{"{}name"{}},\ \textcolor{stringliteral}{"{}dtype"{}},\ \textcolor{stringliteral}{"{}shape"{}},\ \textcolor{stringliteral}{"{}data"{}},\ \textcolor{stringliteral}{"{}ptr"{}}))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00425}00425\ \ \ \ \ \ \ \ \ \ \ \ \ logger\ =\ trt.Logger(trt.Logger.INFO)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00426}00426\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ open(w,\ \textcolor{stringliteral}{"{}rb"{}})\ \textcolor{keyword}{as}\ f,\ trt.Runtime(logger)\ \textcolor{keyword}{as}\ runtime:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00427}00427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ model\ =\ runtime.deserialize\_cuda\_engine(f.read())}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00428}00428\ \ \ \ \ \ \ \ \ \ \ \ \ context\ =\ model.create\_execution\_context()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00429}00429\ \ \ \ \ \ \ \ \ \ \ \ \ bindings\ =\ OrderedDict()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00430}00430\ \ \ \ \ \ \ \ \ \ \ \ \ output\_names\ =\ []}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00431}00431\ \ \ \ \ \ \ \ \ \ \ \ \ fp16\ =\ \textcolor{keyword}{False}\ \ \textcolor{comment}{\#\ default\ updated\ below}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00432}00432\ \ \ \ \ \ \ \ \ \ \ \ \ dynamic\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00433}00433\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(model.num\_bindings):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00434}00434\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ name\ =\ model.get\_binding\_name(i)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00435}00435\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dtype\ =\ trt.nptype(model.get\_binding\_dtype(i))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00436}00436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ model.binding\_is\_input(i):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00437}00437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ -\/1\ \textcolor{keywordflow}{in}\ tuple(model.get\_binding\_shape(i)):\ \ \textcolor{comment}{\#\ dynamic}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00438}00438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dynamic\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00439}00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ context.set\_binding\_shape(i,\ tuple(model.get\_profile\_shape(0,\ i)[2]))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00440}00440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ dtype\ ==\ np.float16:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00441}00441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fp16\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00442}00442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:\ \ \textcolor{comment}{\#\ output}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00443}00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_names.append(name)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00444}00444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ shape\ =\ tuple(context.get\_binding\_shape(i))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00445}00445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ torch.from\_numpy(np.empty(shape,\ dtype=dtype)).to(device)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00446}00446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bindings[name]\ =\ Binding(name,\ dtype,\ shape,\ im,\ int(im.data\_ptr()))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00447}00447\ \ \ \ \ \ \ \ \ \ \ \ \ binding\_addrs\ =\ OrderedDict((n,\ d.ptr)\ \textcolor{keywordflow}{for}\ n,\ d\ \textcolor{keywordflow}{in}\ bindings.items())}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00448}00448\ \ \ \ \ \ \ \ \ \ \ \ \ batch\_size\ =\ bindings[\textcolor{stringliteral}{"{}images"{}}].shape[0]\ \ \textcolor{comment}{\#\ if\ dynamic,\ this\ is\ instead\ max\ batch\ size}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00449}00449\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ coreml:\ \ \textcolor{comment}{\#\ CoreML}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00450}00450\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Loading\ \{w\}\ for\ CoreML\ inference..."{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00451}00451\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{import}\ coremltools\ \textcolor{keyword}{as}\ ct}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00452}00452\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00453}00453\ \ \ \ \ \ \ \ \ \ \ \ \ model\ =\ ct.models.MLModel(w)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00454}00454\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ saved\_model:\ \ \textcolor{comment}{\#\ TF\ SavedModel}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00455}00455\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Loading\ \{w\}\ for\ TensorFlow\ SavedModel\ inference..."{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00456}00456\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{import}\ tensorflow\ \textcolor{keyword}{as}\ tf}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00457}00457\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00458}00458\ \ \ \ \ \ \ \ \ \ \ \ \ keras\ =\ \textcolor{keyword}{False}\ \ \textcolor{comment}{\#\ assume\ TF1\ saved\_model}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00459}00459\ \ \ \ \ \ \ \ \ \ \ \ \ model\ =\ tf.keras.models.load\_model(w)\ \textcolor{keywordflow}{if}\ keras\ \textcolor{keywordflow}{else}\ tf.saved\_model.load(w)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00460}00460\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ pb:\ \ \textcolor{comment}{\#\ GraphDef\ https://www.tensorflow.org/guide/migrate\#a\_graphpb\_or\_graphpbtxt}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00461}00461\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Loading\ \{w\}\ for\ TensorFlow\ GraphDef\ inference..."{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00462}00462\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{import}\ tensorflow\ \textcolor{keyword}{as}\ tf}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00463}00463\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00464}00464\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{def\ }wrap\_frozen\_graph(gd,\ inputs,\ outputs):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00465}00465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ tf.compat.v1.wrap\_function(\textcolor{keyword}{lambda}:\ tf.compat.v1.import\_graph\_def(gd,\ name=\textcolor{stringliteral}{"{}"{}}),\ [])\ \ \textcolor{comment}{\#\ wrapped}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00466}00466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ge\ =\ x.graph.as\_graph\_element}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00467}00467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ x.prune(tf.nest.map\_structure(ge,\ inputs),\ tf.nest.map\_structure(ge,\ outputs))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00468}00468\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00469}00469\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{def\ }gd\_outputs(gd):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00470}00470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ name\_list,\ input\_list\ =\ [],\ []}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00471}00471\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ node\ \textcolor{keywordflow}{in}\ gd.node:\ \ \textcolor{comment}{\#\ tensorflow.core.framework.node\_def\_pb2.NodeDef}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00472}00472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ name\_list.append(node.name)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00473}00473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input\_list.extend(node.input)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00474}00474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ sorted(f\textcolor{stringliteral}{"{}\{x\}:0"{}}\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ list(set(name\_list)\ -\/\ set(input\_list))\ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ x.startswith(\textcolor{stringliteral}{"{}NoOp"{}}))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00475}00475\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00476}00476\ \ \ \ \ \ \ \ \ \ \ \ \ gd\ =\ tf.Graph().as\_graph\_def()\ \ \textcolor{comment}{\#\ TF\ GraphDef}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00477}00477\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ open(w,\ \textcolor{stringliteral}{"{}rb"{}})\ \textcolor{keyword}{as}\ f:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00478}00478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gd.ParseFromString(f.read())}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00479}00479\ \ \ \ \ \ \ \ \ \ \ \ \ frozen\_func\ =\ wrap\_frozen\_graph(gd,\ inputs=\textcolor{stringliteral}{"{}x:0"{}},\ outputs=gd\_outputs(gd))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00480}00480\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ tflite\ \textcolor{keywordflow}{or}\ edgetpu:\ \ \textcolor{comment}{\#\ https://www.tensorflow.org/lite/guide/python\#install\_tensorflow\_lite\_for\_python}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00481}00481\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:\ \ \textcolor{comment}{\#\ https://coral.ai/docs/edgetpu/tflite-\/python/\#update-\/existing-\/tf-\/lite-\/code-\/for-\/the-\/edge-\/tpu}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00482}00482\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{from}\ tflite\_runtime.interpreter\ \textcolor{keyword}{import}\ Interpreter,\ load\_delegate}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00483}00483\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ ImportError:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00484}00484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{import}\ tensorflow\ \textcolor{keyword}{as}\ tf}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00485}00485\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00486}00486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Interpreter,\ load\_delegate\ =\ (}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00487}00487\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tf.lite.Interpreter,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00488}00488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tf.lite.experimental.load\_delegate,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00489}00489\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00490}00490\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ edgetpu:\ \ \textcolor{comment}{\#\ TF\ Edge\ TPU\ https://coral.ai/software/\#edgetpu-\/runtime}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00491}00491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Loading\ \{w\}\ for\ TensorFlow\ Lite\ Edge\ TPU\ inference..."{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00492}00492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ delegate\ =\ \{\textcolor{stringliteral}{"{}Linux"{}}:\ \textcolor{stringliteral}{"{}libedgetpu.so.1"{}},\ \textcolor{stringliteral}{"{}Darwin"{}}:\ \textcolor{stringliteral}{"{}libedgetpu.1.dylib"{}},\ \textcolor{stringliteral}{"{}Windows"{}}:\ \textcolor{stringliteral}{"{}edgetpu.dll"{}}\}[}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00493}00493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ platform.system()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00494}00494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00495}00495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interpreter\ =\ Interpreter(model\_path=w,\ experimental\_delegates=[load\_delegate(delegate)])}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00496}00496\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:\ \ \textcolor{comment}{\#\ TFLite}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00497}00497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Loading\ \{w\}\ for\ TensorFlow\ Lite\ inference..."{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00498}00498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ interpreter\ =\ Interpreter(model\_path=w)\ \ \textcolor{comment}{\#\ load\ TFLite\ model}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00499}00499\ \ \ \ \ \ \ \ \ \ \ \ \ interpreter.allocate\_tensors()\ \ \textcolor{comment}{\#\ allocate}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00500}00500\ \ \ \ \ \ \ \ \ \ \ \ \ input\_details\ =\ interpreter.get\_input\_details()\ \ \textcolor{comment}{\#\ inputs}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00501}00501\ \ \ \ \ \ \ \ \ \ \ \ \ output\_details\ =\ interpreter.get\_output\_details()\ \ \textcolor{comment}{\#\ outputs}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00502}00502\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ load\ metadata}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00503}00503\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ contextlib.suppress(zipfile.BadZipFile):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00504}00504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ zipfile.ZipFile(w,\ \textcolor{stringliteral}{"{}r"{}})\ \textcolor{keyword}{as}\ model:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00505}00505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ meta\_file\ =\ model.namelist()[0]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00506}00506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ meta\ =\ ast.literal\_eval(model.read(meta\_file).decode(\textcolor{stringliteral}{"{}utf-\/8"{}}))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00507}00507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stride,\ names\ =\ int(meta[\textcolor{stringliteral}{"{}stride"{}}]),\ meta[\textcolor{stringliteral}{"{}names"{}}]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00508}00508\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ tfjs:\ \ \textcolor{comment}{\#\ TF.js}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00509}00509\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ NotImplementedError(\textcolor{stringliteral}{"{}ERROR:\ YOLOv5\ TF.js\ inference\ is\ not\ supported"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00510}00510\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ paddle:\ \ \textcolor{comment}{\#\ PaddlePaddle}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00511}00511\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Loading\ \{w\}\ for\ PaddlePaddle\ inference..."{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00512}00512\ \ \ \ \ \ \ \ \ \ \ \ \ check\_requirements(\textcolor{stringliteral}{"{}paddlepaddle-\/gpu"{}}\ \textcolor{keywordflow}{if}\ cuda\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{"{}paddlepaddle"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00513}00513\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{import}\ paddle.inference\ \textcolor{keyword}{as}\ pdi}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00514}00514\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00515}00515\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ Path(w).is\_file():\ \ \textcolor{comment}{\#\ if\ not\ *.pdmodel}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00516}00516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\ =\ next(Path(w).rglob(\textcolor{stringliteral}{"{}*.pdmodel"{}}))\ \ \textcolor{comment}{\#\ get\ *.pdmodel\ file\ from\ *\_paddle\_model\ dir}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00517}00517\ \ \ \ \ \ \ \ \ \ \ \ \ weights\ =\ Path(w).with\_suffix(\textcolor{stringliteral}{"{}.pdiparams"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00518}00518\ \ \ \ \ \ \ \ \ \ \ \ \ config\ =\ pdi.Config(str(w),\ str(weights))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00519}00519\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ cuda:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00520}00520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config.enable\_use\_gpu(memory\_pool\_init\_size\_mb=2048,\ device\_id=0)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00521}00521\ \ \ \ \ \ \ \ \ \ \ \ \ predictor\ =\ pdi.create\_predictor(config)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00522}00522\ \ \ \ \ \ \ \ \ \ \ \ \ input\_handle\ =\ predictor.get\_input\_handle(predictor.get\_input\_names()[0])}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00523}00523\ \ \ \ \ \ \ \ \ \ \ \ \ output\_names\ =\ predictor.get\_output\_names()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00524}00524\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ triton:\ \ \textcolor{comment}{\#\ NVIDIA\ Triton\ Inference\ Server}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00525}00525\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Using\ \{w\}\ as\ Triton\ Inference\ Server..."{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00526}00526\ \ \ \ \ \ \ \ \ \ \ \ \ check\_requirements(\textcolor{stringliteral}{"{}tritonclient[all]"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00527}00527\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceutils_1_1triton}{utils.triton}}\ \textcolor{keyword}{import}\ TritonRemoteModel}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00528}00528\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00529}00529\ \ \ \ \ \ \ \ \ \ \ \ \ model\ =\ TritonRemoteModel(url=w)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00530}00530\ \ \ \ \ \ \ \ \ \ \ \ \ nhwc\ =\ model.runtime.startswith(\textcolor{stringliteral}{"{}tensorflow"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00531}00531\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00532}00532\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ NotImplementedError(f\textcolor{stringliteral}{"{}ERROR:\ \{w\}\ is\ not\ a\ supported\ format"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00533}00533\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00534}00534\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ class\ names}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00535}00535\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}names"{}}\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ locals():}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00536}00536\ \ \ \ \ \ \ \ \ \ \ \ \ names\ =\ yaml\_load(data)[\textcolor{stringliteral}{"{}names"{}}]\ \textcolor{keywordflow}{if}\ data\ \textcolor{keywordflow}{else}\ \{i:\ f\textcolor{stringliteral}{"{}class\{i\}"{}}\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(999)\}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00537}00537\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ names[0]\ ==\ \textcolor{stringliteral}{"{}n01440764"{}}\ \textcolor{keywordflow}{and}\ len(names)\ ==\ 1000:\ \ \textcolor{comment}{\#\ ImageNet}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00538}00538\ \ \ \ \ \ \ \ \ \ \ \ \ names\ =\ yaml\_load(ROOT\ /\ \textcolor{stringliteral}{"{}data/ImageNet.yaml"{}})[\textcolor{stringliteral}{"{}names"{}}]\ \ \textcolor{comment}{\#\ human-\/readable\ names}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00539}00539\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00540}00540\ \ \ \ \ \ \ \ \ self.\_\_dict\_\_.update(locals())\ \ \textcolor{comment}{\#\ assign\ all\ variables\ to\ self}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00541}00541\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00542}\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a6dc72a2a512ee6c91c50443150da3a0c}{00542}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a6dc72a2a512ee6c91c50443150da3a0c}{forward}}(self,\ im,\ augment=False,\ visualize=False):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00543}00543\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ YOLOv5\ MultiBackend\ inference}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00544}00544\ \ \ \ \ \ \ \ \ b,\ ch,\ h,\ w\ =\ im.shape\ \ \textcolor{comment}{\#\ batch,\ channel,\ height,\ width}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00545}00545\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.fp16\ \textcolor{keywordflow}{and}\ im.dtype\ !=\ torch.float16:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00546}00546\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im.half()\ \ \textcolor{comment}{\#\ to\ FP16}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00547}00547\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.nhwc:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00548}00548\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im.permute(0,\ 2,\ 3,\ 1)\ \ \textcolor{comment}{\#\ torch\ BCHW\ to\ numpy\ BHWC\ shape(1,320,192,3)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00549}00549\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00550}00550\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.pt:\ \ \textcolor{comment}{\#\ PyTorch}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00551}00551\ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a033df5e210331fcfa64d74fc55bc2260}{model}}(im,\ augment=augment,\ visualize=visualize)\ \textcolor{keywordflow}{if}\ augment\ \textcolor{keywordflow}{or}\ visualize\ \textcolor{keywordflow}{else}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a033df5e210331fcfa64d74fc55bc2260}{model}}(im)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00552}00552\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.jit:\ \ \textcolor{comment}{\#\ TorchScript}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00553}00553\ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a033df5e210331fcfa64d74fc55bc2260}{model}}(im)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00554}00554\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.dnn:\ \ \textcolor{comment}{\#\ ONNX\ OpenCV\ DNN}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00555}00555\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im.cpu().numpy()\ \ \textcolor{comment}{\#\ torch\ to\ numpy}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00556}00556\ \ \ \ \ \ \ \ \ \ \ \ \ self.net.setInput(im)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00557}00557\ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ self.net.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a6dc72a2a512ee6c91c50443150da3a0c}{forward}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00558}00558\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.onnx:\ \ \textcolor{comment}{\#\ ONNX\ Runtime}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00559}00559\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im.cpu().numpy()\ \ \textcolor{comment}{\#\ torch\ to\ numpy}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00560}00560\ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ self.session.run(self.output\_names,\ \{self.session.get\_inputs()[0].name:\ im\})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00561}00561\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.xml:\ \ \textcolor{comment}{\#\ OpenVINO}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00562}00562\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im.cpu().numpy()\ \ \textcolor{comment}{\#\ FP32}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00563}00563\ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ list(self.ov\_compiled\_model(im).values())}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00564}00564\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.engine:\ \ \textcolor{comment}{\#\ TensorRT}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00565}00565\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.dynamic\ \textcolor{keywordflow}{and}\ im.shape\ !=\ self.bindings[\textcolor{stringliteral}{"{}images"{}}].shape:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00566}00566\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ i\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a033df5e210331fcfa64d74fc55bc2260}{model}}.get\_binding\_index(\textcolor{stringliteral}{"{}images"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00567}00567\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.context.set\_binding\_shape(i,\ im.shape)\ \ \textcolor{comment}{\#\ reshape\ if\ dynamic}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00568}00568\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.bindings[\textcolor{stringliteral}{"{}images"{}}]\ =\ self.bindings[\textcolor{stringliteral}{"{}images"{}}].\_replace(shape=im.shape)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00569}00569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ name\ \textcolor{keywordflow}{in}\ self.output\_names:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00570}00570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ i\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a033df5e210331fcfa64d74fc55bc2260}{model}}.get\_binding\_index(name)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00571}00571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.bindings[name].data.resize\_(tuple(self.context.get\_binding\_shape(i)))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00572}00572\ \ \ \ \ \ \ \ \ \ \ \ \ s\ =\ self.bindings[\textcolor{stringliteral}{"{}images"{}}].shape}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00573}00573\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ im.shape\ ==\ s,\ f\textcolor{stringliteral}{"{}input\ size\ \{im.shape\}\ \{'>'\ if\ self.dynamic\ else\ 'not\ equal\ to'\}\ max\ model\ size\ \{s\}"{}}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00574}00574\ \ \ \ \ \ \ \ \ \ \ \ \ self.binding\_addrs[\textcolor{stringliteral}{"{}images"{}}]\ =\ int(im.data\_ptr())}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00575}00575\ \ \ \ \ \ \ \ \ \ \ \ \ self.context.execute\_v2(list(self.binding\_addrs.values()))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00576}00576\ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ [self.bindings[x].data\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ sorted(self.output\_names)]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00577}00577\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.coreml:\ \ \textcolor{comment}{\#\ CoreML}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00578}00578\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im.cpu().numpy()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00579}00579\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ Image.fromarray((im[0]\ *\ 255).astype(\textcolor{stringliteral}{"{}uint8"{}}))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00580}00580\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ im\ =\ im.resize((192,\ 320),\ Image.BILINEAR)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00581}00581\ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a033df5e210331fcfa64d74fc55bc2260}{model}}.\mbox{\hyperlink{namespacepredict}{predict}}(\{\textcolor{stringliteral}{"{}image"{}}:\ im\})\ \ \textcolor{comment}{\#\ coordinates\ are\ xywh\ normalized}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00582}00582\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}confidence"{}}\ \textcolor{keywordflow}{in}\ y:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00583}00583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ box\ =\ xywh2xyxy(y[\textcolor{stringliteral}{"{}coordinates"{}}]\ *\ [[w,\ h,\ w,\ h]])\ \ \textcolor{comment}{\#\ xyxy\ pixels}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00584}00584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ conf,\ cls\ =\ y[\textcolor{stringliteral}{"{}confidence"{}}].max(1),\ y[\textcolor{stringliteral}{"{}confidence"{}}].argmax(1).astype(np.float)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00585}00585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ np.concatenate((box,\ conf.reshape(-\/1,\ 1),\ cls.reshape(-\/1,\ 1)),\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00586}00586\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00587}00587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ list(reversed(y.values()))\ \ \textcolor{comment}{\#\ reversed\ for\ segmentation\ models\ (pred,\ proto)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00588}00588\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.paddle:\ \ \textcolor{comment}{\#\ PaddlePaddle}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00589}00589\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im.cpu().numpy().astype(np.float32)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00590}00590\ \ \ \ \ \ \ \ \ \ \ \ \ self.input\_handle.copy\_from\_cpu(im)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00591}00591\ \ \ \ \ \ \ \ \ \ \ \ \ self.predictor.run()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00592}00592\ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ [self.predictor.get\_output\_handle(x).copy\_to\_cpu()\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ self.output\_names]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00593}00593\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.triton:\ \ \textcolor{comment}{\#\ NVIDIA\ Triton\ Inference\ Server}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00594}00594\ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a033df5e210331fcfa64d74fc55bc2260}{model}}(im)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00595}00595\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:\ \ \textcolor{comment}{\#\ TensorFlow\ (SavedModel,\ GraphDef,\ Lite,\ Edge\ TPU)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00596}00596\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im.cpu().numpy()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00597}00597\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.saved\_model:\ \ \textcolor{comment}{\#\ SavedModel}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00598}00598\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a033df5e210331fcfa64d74fc55bc2260}{model}}(im,\ training=\textcolor{keyword}{False})\ \textcolor{keywordflow}{if}\ self.keras\ \textcolor{keywordflow}{else}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a033df5e210331fcfa64d74fc55bc2260}{model}}(im)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00599}00599\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.pb:\ \ \textcolor{comment}{\#\ GraphDef}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00600}00600\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ self.frozen\_func(x=self.tf.constant(im))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00601}00601\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:\ \ \textcolor{comment}{\#\ Lite\ or\ Edge\ TPU}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00602}00602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input\ =\ self.input\_details[0]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00603}00603\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int8\ =\ input[\textcolor{stringliteral}{"{}dtype"{}}]\ ==\ np.uint8\ \ \textcolor{comment}{\#\ is\ TFLite\ quantized\ uint8\ model}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00604}00604\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ int8:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00605}00605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ scale,\ zero\_point\ =\ input[\textcolor{stringliteral}{"{}quantization"{}}]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00606}00606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ (im\ /\ scale\ +\ zero\_point).astype(np.uint8)\ \ \textcolor{comment}{\#\ de-\/scale}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00607}00607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.interpreter.set\_tensor(input[\textcolor{stringliteral}{"{}index"{}}],\ im)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00608}00608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.interpreter.invoke()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00609}00609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ []}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00610}00610\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ output\ \textcolor{keywordflow}{in}\ self.output\_details:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00611}00611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ self.interpreter.get\_tensor(output[\textcolor{stringliteral}{"{}index"{}}])}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00612}00612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ int8:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00613}00613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ scale,\ zero\_point\ =\ output[\textcolor{stringliteral}{"{}quantization"{}}]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00614}00614\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ (x.astype(np.float32)\ -\/\ zero\_point)\ *\ scale\ \ \textcolor{comment}{\#\ re-\/scale}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00615}00615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ y.append(x)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00616}00616\ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ [x\ \textcolor{keywordflow}{if}\ isinstance(x,\ np.ndarray)\ \textcolor{keywordflow}{else}\ x.numpy()\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ y]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00617}00617\ \ \ \ \ \ \ \ \ \ \ \ \ y[0][...,\ :4]\ *=\ [w,\ h,\ w,\ h]\ \ \textcolor{comment}{\#\ xywh\ normalized\ to\ pixels}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00618}00618\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00619}00619\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ isinstance(y,\ (list,\ tuple)):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00620}00620\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a58410ee261013bf6669a564e24ad3bdd}{from\_numpy}}(y[0])\ \textcolor{keywordflow}{if}\ len(y)\ ==\ 1\ \textcolor{keywordflow}{else}\ [self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a58410ee261013bf6669a564e24ad3bdd}{from\_numpy}}(x)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ y]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00621}00621\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00622}00622\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a58410ee261013bf6669a564e24ad3bdd}{from\_numpy}}(y)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00623}00623\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00624}\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a58410ee261013bf6669a564e24ad3bdd}{00624}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a58410ee261013bf6669a564e24ad3bdd}{from\_numpy}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00625}\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a064f4f675f84aeda2af1e1bfff425e91}{00625}}\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ torch.from\_numpy(x).to(self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a064f4f675f84aeda2af1e1bfff425e91}{device}})\ \textcolor{keywordflow}{if}\ isinstance(x,\ np.ndarray)\ \textcolor{keywordflow}{else}\ x}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00626}00626\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00627}\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a7a587e5a1fcc67d08b1295d2e0b380fb}{00627}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a7a587e5a1fcc67d08b1295d2e0b380fb}{warmup}}(self,\ imgsz=(1,\ 3,\ 640,\ 640)):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00628}00628\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Warmup\ model\ by\ running\ inference\ once}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00629}00629\ \ \ \ \ \ \ \ \ warmup\_types\ =\ self.pt,\ self.jit,\ self.onnx,\ self.engine,\ self.saved\_model,\ self.pb,\ self.triton}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00630}00630\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ any(warmup\_types)\ \textcolor{keywordflow}{and}\ (self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a064f4f675f84aeda2af1e1bfff425e91}{device}}.type\ !=\ \textcolor{stringliteral}{"{}cpu"{}}\ \textcolor{keywordflow}{or}\ self.triton):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00631}00631\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ torch.empty(*imgsz,\ dtype=torch.half\ \textcolor{keywordflow}{if}\ self.fp16\ \textcolor{keywordflow}{else}\ torch.float,\ device=self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a064f4f675f84aeda2af1e1bfff425e91}{device}})\ \ \textcolor{comment}{\#\ input}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00632}00632\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ \_\ \textcolor{keywordflow}{in}\ range(2\ \textcolor{keywordflow}{if}\ self.jit\ \textcolor{keywordflow}{else}\ 1):\ \ \textcolor{comment}{\#}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00633}00633\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a6dc72a2a512ee6c91c50443150da3a0c}{forward}}(im)\ \ \textcolor{comment}{\#\ warmup}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00634}00634\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00635}00635\ \ \ \ \ \textcolor{preprocessor}{@staticmethod}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00636}\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a44967ccbbf9583ae1d997dbbdfcf2972}{00636}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a44967ccbbf9583ae1d997dbbdfcf2972}{\_model\_type}}(p="{}path/to/model.pt"{}):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00637}00637\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Return\ model\ type\ from\ model\ path,\ i.e.\ path='path/to/model.onnx'\ -\/>\ type=onnx}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00638}00638\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ types\ =\ [pt,\ jit,\ onnx,\ xml,\ engine,\ coreml,\ saved\_model,\ pb,\ tflite,\ edgetpu,\ tfjs,\ paddle]}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00639}00639\ \ \ \ \ \ \ \ \ \textcolor{keyword}{from}\ export\ \textcolor{keyword}{import}\ export\_formats}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00640}00640\ \ \ \ \ \ \ \ \ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceutils_1_1downloads}{utils.downloads}}\ \textcolor{keyword}{import}\ is\_url}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00641}00641\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00642}00642\ \ \ \ \ \ \ \ \ sf\ =\ list(export\_formats().Suffix)\ \ \textcolor{comment}{\#\ export\ suffixes}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00643}00643\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ is\_url(p,\ check=\textcolor{keyword}{False}):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00644}00644\ \ \ \ \ \ \ \ \ \ \ \ \ check\_suffix(p,\ sf)\ \ \textcolor{comment}{\#\ checks}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00645}00645\ \ \ \ \ \ \ \ \ url\ =\ urlparse(p)\ \ \textcolor{comment}{\#\ if\ url\ may\ be\ Triton\ inference\ server}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00646}00646\ \ \ \ \ \ \ \ \ types\ =\ [s\ \textcolor{keywordflow}{in}\ Path(p).name\ \textcolor{keywordflow}{for}\ s\ \textcolor{keywordflow}{in}\ sf]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00647}00647\ \ \ \ \ \ \ \ \ types[8]\ \&=\ \textcolor{keywordflow}{not}\ types[9]\ \ \textcolor{comment}{\#\ tflite\ \&=\ not\ edgetpu}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00648}00648\ \ \ \ \ \ \ \ \ triton\ =\ \textcolor{keywordflow}{not}\ any(types)\ \textcolor{keywordflow}{and}\ all([any(s\ \textcolor{keywordflow}{in}\ url.scheme\ \textcolor{keywordflow}{for}\ s\ \textcolor{keywordflow}{in}\ [\textcolor{stringliteral}{"{}http"{}},\ \textcolor{stringliteral}{"{}grpc"{}}]),\ url.netloc])}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00649}00649\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ types\ +\ [triton]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00650}00650\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00651}00651\ \ \ \ \ \textcolor{preprocessor}{@staticmethod}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00652}\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a43dd9d6acfff7d0e011dbb58750047f1}{00652}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detect_multi_backend_a43dd9d6acfff7d0e011dbb58750047f1}{\_load\_metadata}}(f=Path(\textcolor{stringliteral}{"{}path/to/meta.yaml"{}})):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00653}00653\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Load\ metadata\ from\ meta.yaml\ if\ it\ exists}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00654}00654\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ f.exists():}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00655}00655\ \ \ \ \ \ \ \ \ \ \ \ \ d\ =\ yaml\_load(f)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00656}00656\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ d[\textcolor{stringliteral}{"{}stride"{}}],\ d[\textcolor{stringliteral}{"{}names"{}}]\ \ \textcolor{comment}{\#\ assign\ stride,\ names}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00657}00657\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{None},\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00658}00658\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00659}00659\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00660}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape}{00660}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape}{AutoShape}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00661}00661\ \ \ \ \ \textcolor{comment}{\#\ YOLOv5\ input-\/robust\ model\ wrapper\ for\ passing\ cv2/np/PIL/torch\ inputs.\ Includes\ preprocessing,\ inference\ and\ NMS}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00662}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ad77f8b49c05d445e7b827fa283900d60}{00662}}\ \ \ \ \ conf\ =\ 0.25\ \ \textcolor{comment}{\#\ NMS\ confidence\ threshold}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00663}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a901040b0c6da95891d41be3722e18967}{00663}}\ \ \ \ \ iou\ =\ 0.45\ \ \textcolor{comment}{\#\ NMS\ IoU\ threshold}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00664}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a6538c62ab5e5fd43548af5f5aa81142e}{00664}}\ \ \ \ \ agnostic\ =\ \textcolor{keyword}{False}\ \ \textcolor{comment}{\#\ NMS\ class-\/agnostic}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00665}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ad4dc47d550cd2762c9b2952bc8d2a2e7}{00665}}\ \ \ \ \ multi\_label\ =\ \textcolor{keyword}{False}\ \ \textcolor{comment}{\#\ NMS\ multiple\ labels\ per\ box}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00666}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a4bba68d47a222da55c835ba5453ea069}{00666}}\ \ \ \ \ classes\ =\ \textcolor{keywordtype}{None}\ \ \textcolor{comment}{\#\ (optional\ list)\ filter\ by\ class,\ i.e.\ =\ [0,\ 15,\ 16]\ for\ COCO\ persons,\ cats\ and\ dogs}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00667}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ad157e741a7a421dfe79b1ff631104673}{00667}}\ \ \ \ \ max\_det\ =\ 1000\ \ \textcolor{comment}{\#\ maximum\ number\ of\ detections\ per\ image}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00668}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a7f83548813da5763b8d6c24bfb946a99}{00668}}\ \ \ \ \ amp\ =\ \textcolor{keyword}{False}\ \ \textcolor{comment}{\#\ Automatic\ Mixed\ Precision\ (AMP)\ inference}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00669}00669\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00670}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a6bcc33fc1179b2a64293aa809457d423}{00670}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a6bcc33fc1179b2a64293aa809457d423}{\_\_init\_\_}}(self,\ model,\ verbose=True):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00671}00671\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a6bcc33fc1179b2a64293aa809457d423}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00672}00672\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ verbose:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00673}00673\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(\textcolor{stringliteral}{"{}Adding\ AutoShape...\ "{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00674}00674\ \ \ \ \ \ \ \ \ copy\_attr(self,\ model,\ include=(\textcolor{stringliteral}{"{}yaml"{}},\ \textcolor{stringliteral}{"{}nc"{}},\ \textcolor{stringliteral}{"{}hyp"{}},\ \textcolor{stringliteral}{"{}names"{}},\ \textcolor{stringliteral}{"{}stride"{}},\ \textcolor{stringliteral}{"{}abc"{}}),\ exclude=())\ \ \textcolor{comment}{\#\ copy\ attributes}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00675}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_aacc1ad2da4954afe209d99ad3a0bef00}{00675}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_aacc1ad2da4954afe209d99ad3a0bef00}{dmb}}\ =\ isinstance(model,\ DetectMultiBackend)\ \ \textcolor{comment}{\#\ DetectMultiBackend()\ instance}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00676}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a2cdae8dac721200768573321f10c21c6}{00676}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a2cdae8dac721200768573321f10c21c6}{pt}}\ =\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_aacc1ad2da4954afe209d99ad3a0bef00}{dmb}}\ \textcolor{keywordflow}{or}\ model.pt\ \ \textcolor{comment}{\#\ PyTorch\ model}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00677}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_af65251fa5221a675627f5e802ae1e0c5}{00677}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_af65251fa5221a675627f5e802ae1e0c5}{model}}\ =\ model.eval()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00678}00678\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a2cdae8dac721200768573321f10c21c6}{pt}}:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00679}00679\ \ \ \ \ \ \ \ \ \ \ \ \ m\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_af65251fa5221a675627f5e802ae1e0c5}{model}}.model.model[-\/1]\ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_aacc1ad2da4954afe209d99ad3a0bef00}{dmb}}\ \textcolor{keywordflow}{else}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_af65251fa5221a675627f5e802ae1e0c5}{model}}.model[-\/1]\ \ \textcolor{comment}{\#\ Detect()}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00680}00680\ \ \ \ \ \ \ \ \ \ \ \ \ m.inplace\ =\ \textcolor{keyword}{False}\ \ \textcolor{comment}{\#\ Detect.inplace=False\ for\ safe\ multithread\ inference}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00681}00681\ \ \ \ \ \ \ \ \ \ \ \ \ m.export\ =\ \textcolor{keyword}{True}\ \ \textcolor{comment}{\#\ do\ not\ output\ loss\ values}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00682}00682\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00683}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ad5b1b039a23653ec607511868ef0bfb2}{00683}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ad5b1b039a23653ec607511868ef0bfb2}{\_apply}}(self,\ fn):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00684}00684\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Apply\ to(),\ cpu(),\ cuda(),\ half()\ to\ model\ tensors\ that\ are\ not\ parameters\ or\ registered\ buffers}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00685}00685\ \ \ \ \ \ \ \ \ self\ =\ super().\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ad5b1b039a23653ec607511868ef0bfb2}{\_apply}}(fn)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00686}00686\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a2cdae8dac721200768573321f10c21c6}{pt}}:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00687}00687\ \ \ \ \ \ \ \ \ \ \ \ \ m\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_af65251fa5221a675627f5e802ae1e0c5}{model}}.model.model[-\/1]\ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_aacc1ad2da4954afe209d99ad3a0bef00}{dmb}}\ \textcolor{keywordflow}{else}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_af65251fa5221a675627f5e802ae1e0c5}{model}}.model[-\/1]\ \ \textcolor{comment}{\#\ Detect()}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00688}00688\ \ \ \ \ \ \ \ \ \ \ \ \ m.stride\ =\ fn(m.stride)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00689}00689\ \ \ \ \ \ \ \ \ \ \ \ \ m.grid\ =\ list(map(fn,\ m.grid))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00690}00690\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ isinstance(m.anchor\_grid,\ list):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00691}00691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m.anchor\_grid\ =\ list(map(fn,\ m.anchor\_grid))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00692}00692\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00693}00693\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00694}00694\ \ \ \ \ \textcolor{preprocessor}{@smart\_inference\_mode()}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00695}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ad5719a5c55164358f369554c1602962a}{00695}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ad5719a5c55164358f369554c1602962a}{forward}}(self,\ ims,\ size=640,\ augment=False,\ profile=False):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00696}00696\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Inference\ from\ various\ sources.\ For\ size(height=640,\ width=1280),\ RGB\ images\ example\ inputs\ are:}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00697}00697\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ file:\ \ \ \ \ \ \ \ ims\ =\ 'data/images/zidane.jpg'\ \ \#\ str\ or\ PosixPath}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00698}00698\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ URI:\ \ \ \ \ \ \ \ \ \ \ \ \ =\ 'https://ultralytics.com/images/zidane.jpg'}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00699}00699\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ OpenCV:\ \ \ \ \ \ \ \ \ \ =\ cv2.imread('image.jpg')[:,:,::-\/1]\ \ \#\ HWC\ BGR\ to\ RGB\ x(640,1280,3)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00700}00700\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ PIL:\ \ \ \ \ \ \ \ \ \ \ \ \ =\ Image.open('image.jpg')\ or\ ImageGrab.grab()\ \ \#\ HWC\ x(640,1280,3)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00701}00701\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ numpy:\ \ \ \ \ \ \ \ \ \ \ =\ np.zeros((640,1280,3))\ \ \#\ HWC}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00702}00702\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ torch:\ \ \ \ \ \ \ \ \ \ \ =\ torch.zeros(16,3,320,640)\ \ \#\ BCHW\ (scaled\ to\ size=640,\ 0-\/1\ values)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00703}00703\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ multiple:\ \ \ \ \ \ \ \ =\ [Image.open('image1.jpg'),\ Image.open('image2.jpg'),\ ...]\ \ \#\ list\ of\ images}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00704}00704\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00705}00705\ \ \ \ \ \ \ \ \ dt\ =\ (\mbox{\hyperlink{classutils_1_1general_1_1_profile}{Profile}}(),\ \mbox{\hyperlink{classutils_1_1general_1_1_profile}{Profile}}(),\ \mbox{\hyperlink{classutils_1_1general_1_1_profile}{Profile}}())}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00706}00706\ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ dt[0]:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00707}00707\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ isinstance(size,\ int):\ \ \textcolor{comment}{\#\ expand}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00708}00708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ size\ =\ (size,\ size)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00709}00709\ \ \ \ \ \ \ \ \ \ \ \ \ p\ =\ next(self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_af65251fa5221a675627f5e802ae1e0c5}{model}}.parameters())\ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a2cdae8dac721200768573321f10c21c6}{pt}}\ \textcolor{keywordflow}{else}\ torch.empty(1,\ device=self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_af65251fa5221a675627f5e802ae1e0c5}{model}}.device)\ \ \textcolor{comment}{\#\ param}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00710}00710\ \ \ \ \ \ \ \ \ \ \ \ \ autocast\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a7f83548813da5763b8d6c24bfb946a99}{amp}}\ \textcolor{keywordflow}{and}\ (p.device.type\ !=\ \textcolor{stringliteral}{"{}cpu"{}})\ \ \textcolor{comment}{\#\ Automatic\ Mixed\ Precision\ (AMP)\ inference}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00711}00711\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ isinstance(ims,\ torch.Tensor):\ \ \textcolor{comment}{\#\ torch}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00712}00712\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ amp.autocast(autocast):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00713}00713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_af65251fa5221a675627f5e802ae1e0c5}{model}}(ims.to(p.device).type\_as(p),\ augment=augment)\ \ \textcolor{comment}{\#\ inference}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00714}00714\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00715}00715\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Pre-\/process}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00716}00716\ \ \ \ \ \ \ \ \ \ \ \ \ n,\ ims\ =\ (len(ims),\ list(ims))\ \textcolor{keywordflow}{if}\ isinstance(ims,\ (list,\ tuple))\ \textcolor{keywordflow}{else}\ (1,\ [ims])\ \ \textcolor{comment}{\#\ number,\ list\ of\ images}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00717}00717\ \ \ \ \ \ \ \ \ \ \ \ \ shape0,\ shape1,\ files\ =\ [],\ [],\ []\ \ \textcolor{comment}{\#\ image\ and\ inference\ shapes,\ filenames}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00718}00718\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ im\ \textcolor{keywordflow}{in}\ enumerate(ims):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00719}00719\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\ =\ f\textcolor{stringliteral}{"{}image\{i\}"{}}\ \ \textcolor{comment}{\#\ filename}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00720}00720\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ isinstance(im,\ (str,\ Path)):\ \ \textcolor{comment}{\#\ filename\ or\ uri}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00721}00721\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im,\ f\ =\ Image.open(requests.get(im,\ stream=\textcolor{keyword}{True}).raw\ \textcolor{keywordflow}{if}\ str(im).startswith(\textcolor{stringliteral}{"{}http"{}})\ \textcolor{keywordflow}{else}\ im),\ im}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00722}00722\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ np.asarray(exif\_transpose(im))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00723}00723\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ isinstance(im,\ Image.Image):\ \ \textcolor{comment}{\#\ PIL\ Image}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00724}00724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im,\ f\ =\ np.asarray(exif\_transpose(im)),\ getattr(im,\ \textcolor{stringliteral}{"{}filename"{}},\ f)\ \textcolor{keywordflow}{or}\ f}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00725}00725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ files.append(Path(f).with\_suffix(\textcolor{stringliteral}{"{}.jpg"{}}).name)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00726}00726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ im.shape[0]\ <\ 5:\ \ \textcolor{comment}{\#\ image\ in\ CHW}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00727}00727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im.transpose((1,\ 2,\ 0))\ \ \textcolor{comment}{\#\ reverse\ dataloader\ .transpose(2,\ 0,\ 1)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00728}00728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ im[...,\ :3]\ \textcolor{keywordflow}{if}\ im.ndim\ ==\ 3\ \textcolor{keywordflow}{else}\ cv2.cvtColor(im,\ cv2.COLOR\_GRAY2BGR)\ \ \textcolor{comment}{\#\ enforce\ 3ch\ input}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00729}00729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ s\ =\ im.shape[:2]\ \ \textcolor{comment}{\#\ HWC}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00730}00730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ shape0.append(s)\ \ \textcolor{comment}{\#\ image\ shape}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00731}00731\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ g\ =\ max(size)\ /\ max(s)\ \ \textcolor{comment}{\#\ gain}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00732}00732\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ shape1.append([int(y\ *\ g)\ \textcolor{keywordflow}{for}\ y\ \textcolor{keywordflow}{in}\ s])}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00733}00733\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ims[i]\ =\ im\ \textcolor{keywordflow}{if}\ im.data.contiguous\ \textcolor{keywordflow}{else}\ np.ascontiguousarray(im)\ \ \textcolor{comment}{\#\ update}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00734}00734\ \ \ \ \ \ \ \ \ \ \ \ \ shape1\ =\ [make\_divisible(x,\ self.stride)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ np.array(shape1).max(0)]\ \ \textcolor{comment}{\#\ inf\ shape}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00735}00735\ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ [letterbox(im,\ shape1,\ auto=\textcolor{keyword}{False})[0]\ \textcolor{keywordflow}{for}\ im\ \textcolor{keywordflow}{in}\ ims]\ \ \textcolor{comment}{\#\ pad}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00736}00736\ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ np.ascontiguousarray(np.array(x).transpose((0,\ 3,\ 1,\ 2)))\ \ \textcolor{comment}{\#\ stack\ and\ BHWC\ to\ BCHW}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00737}00737\ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ torch.from\_numpy(x).to(p.device).type\_as(p)\ /\ 255\ \ \textcolor{comment}{\#\ uint8\ to\ fp16/32}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00738}00738\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00739}00739\ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ amp.autocast(autocast):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00740}00740\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Inference}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00741}00741\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ dt[1]:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00742}00742\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_af65251fa5221a675627f5e802ae1e0c5}{model}}(x,\ augment=augment)\ \ \textcolor{comment}{\#\ forward}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00743}00743\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00744}00744\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Post-\/process}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00745}00745\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ dt[2]:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00746}00746\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ non\_max\_suppression(}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00747}00747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ y\ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_aacc1ad2da4954afe209d99ad3a0bef00}{dmb}}\ \textcolor{keywordflow}{else}\ y[0],}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00748}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_adaca55eda4b18916a84ed3b4368af027}{00748}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ad77f8b49c05d445e7b827fa283900d60}{conf}}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_adaca55eda4b18916a84ed3b4368af027}{conf}},}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00749}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a81f5ae5b8267330aa090a48917a14b27}{00749}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a901040b0c6da95891d41be3722e18967}{iou}}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a81f5ae5b8267330aa090a48917a14b27}{iou}},}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00750}00750\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a4bba68d47a222da55c835ba5453ea069}{classes}},}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00751}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ae1f3063653b4b7f8f510fb03d476c83b}{00751}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a6538c62ab5e5fd43548af5f5aa81142e}{agnostic}}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ae1f3063653b4b7f8f510fb03d476c83b}{agnostic}},}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00752}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ae3f1c2257d8a6a2fbe2f7e844c800f42}{00752}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ad4dc47d550cd2762c9b2952bc8d2a2e7}{multi\_label}}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ae3f1c2257d8a6a2fbe2f7e844c800f42}{multi\_label}},}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00753}00753\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_det=self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_ad157e741a7a421dfe79b1ff631104673}{max\_det}},}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00754}00754\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \ \textcolor{comment}{\#\ NMS}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00755}00755\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(n):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00756}00756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ scale\_boxes(shape1,\ y[i][:,\ :4],\ shape0[i])}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00757}00757\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00758}\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a0b6bb47329f4536a3924e7947581cda1}{00758}}\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classmodels_1_1common_1_1_detections}{Detections}}(ims,\ y,\ files,\ dt,\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_auto_shape_a0b6bb47329f4536a3924e7947581cda1}{names}},\ x.shape)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00759}00759\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00760}00760\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00761}\mbox{\hyperlink{classmodels_1_1common_1_1_detections}{00761}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections}{Detections}}:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00762}00762\ \ \ \ \ \textcolor{comment}{\#\ YOLOv5\ detections\ class\ for\ inference\ results}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00763}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a7cabbf7f6864f8dc863c800356257b68}{00763}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a7cabbf7f6864f8dc863c800356257b68}{\_\_init\_\_}}(self,\ ims,\ pred,\ files,\ times=(0,\ 0,\ 0),\ names=\textcolor{keywordtype}{None},\ shape=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00764}00764\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a7cabbf7f6864f8dc863c800356257b68}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00765}00765\ \ \ \ \ \ \ \ \ d\ =\ pred[0].device\ \ \textcolor{comment}{\#\ device}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00766}00766\ \ \ \ \ \ \ \ \ gn\ =\ [torch.tensor([*(im.shape[i]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ [1,\ 0,\ 1,\ 0]),\ 1,\ 1],\ device=d)\ \textcolor{keywordflow}{for}\ im\ \textcolor{keywordflow}{in}\ ims]\ \ \textcolor{comment}{\#\ normalizations}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00767}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a328d72d46f6125448104c390e6624038}{00767}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a328d72d46f6125448104c390e6624038}{ims}}\ =\ ims\ \ \textcolor{comment}{\#\ list\ of\ images\ as\ numpy\ arrays}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00768}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a53abcc899896b0d2c20b6f84cbe2c452}{00768}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a53abcc899896b0d2c20b6f84cbe2c452}{pred}}\ =\ pred\ \ \textcolor{comment}{\#\ list\ of\ tensors\ pred[0]\ =\ (xyxy,\ conf,\ cls)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00769}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a2dda184aebfe28da2ebc08bfdb9e5ca1}{00769}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a2dda184aebfe28da2ebc08bfdb9e5ca1}{names}}\ =\ names\ \ \textcolor{comment}{\#\ class\ names}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00770}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ad1954b98e196b97d1abc1584b3a02cc5}{00770}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ad1954b98e196b97d1abc1584b3a02cc5}{files}}\ =\ files\ \ \textcolor{comment}{\#\ image\ filenames}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00771}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ab4e09d9b38889ca7688f018d45bd9749}{00771}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ab4e09d9b38889ca7688f018d45bd9749}{times}}\ =\ times\ \ \textcolor{comment}{\#\ profiling\ times}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00772}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_add00e5d41899caaab82ce8e2622792da}{00772}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_add00e5d41899caaab82ce8e2622792da}{xyxy}}\ =\ pred\ \ \textcolor{comment}{\#\ xyxy\ pixels}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00773}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ae5ad76f9bf2ab8768c38df77d469d1fb}{00773}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ae5ad76f9bf2ab8768c38df77d469d1fb}{xywh}}\ =\ [xyxy2xywh(x)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ pred]\ \ \textcolor{comment}{\#\ xywh\ pixels}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00774}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_aacee967fb197fb165980a081357616f5}{00774}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_aacee967fb197fb165980a081357616f5}{xyxyn}}\ =\ [x\ /\ g\ \textcolor{keywordflow}{for}\ x,\ g\ \textcolor{keywordflow}{in}\ zip(self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_add00e5d41899caaab82ce8e2622792da}{xyxy}},\ gn)]\ \ \textcolor{comment}{\#\ xyxy\ normalized}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00775}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a1e37cb9176b051fd2cb85fc9e075710f}{00775}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a1e37cb9176b051fd2cb85fc9e075710f}{xywhn}}\ =\ [x\ /\ g\ \textcolor{keywordflow}{for}\ x,\ g\ \textcolor{keywordflow}{in}\ zip(self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ae5ad76f9bf2ab8768c38df77d469d1fb}{xywh}},\ gn)]\ \ \textcolor{comment}{\#\ xywh\ normalized}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00776}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ae3661db10a63e7b2684d7a3f228c1edf}{00776}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ae3661db10a63e7b2684d7a3f228c1edf}{n}}\ =\ len(self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a53abcc899896b0d2c20b6f84cbe2c452}{pred}})\ \ \textcolor{comment}{\#\ number\ of\ images\ (batch\ size)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00777}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a2cb25f61622692501fc0a2a51f125e02}{00777}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a2cb25f61622692501fc0a2a51f125e02}{t}}\ =\ tuple(x.t\ /\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ae3661db10a63e7b2684d7a3f228c1edf}{n}}\ *\ 1e3\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ times)\ \ \textcolor{comment}{\#\ timestamps\ (ms)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00778}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ad030cbc7bc0c29869cf4f67ecf7257e8}{00778}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ad030cbc7bc0c29869cf4f67ecf7257e8}{s}}\ =\ tuple(shape)\ \ \textcolor{comment}{\#\ inference\ BCHW\ shape}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00779}00779\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00780}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ab8d2b0d35180e2f4e8730ea9541c2fc7}{00780}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ab8d2b0d35180e2f4e8730ea9541c2fc7}{\_run}}(self,\ pprint=False,\ show=False,\ save=False,\ crop=False,\ render=False,\ labels=True,\ save\_dir=Path(\textcolor{stringliteral}{"{}"{}})):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00781}00781\ \ \ \ \ \ \ \ \ s,\ crops\ =\ \textcolor{stringliteral}{"{}"{}},\ []}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00782}00782\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ (im,\ pred)\ \textcolor{keywordflow}{in}\ enumerate(zip(self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a328d72d46f6125448104c390e6624038}{ims}},\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a53abcc899896b0d2c20b6f84cbe2c452}{pred}})):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00783}00783\ \ \ \ \ \ \ \ \ \ \ \ \ s\ +=\ f\textcolor{stringliteral}{"{}\(\backslash\)nimage\ \{i\ +\ 1\}/\{len(self.pred)\}:\ \{im.shape[0]\}x\{im.shape[1]\}\ "{}}\ \ \textcolor{comment}{\#\ string}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00784}00784\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ pred.shape[0]:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00785}00785\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ c\ \textcolor{keywordflow}{in}\ pred[:,\ -\/1].unique():}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00786}00786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ n\ =\ (pred[:,\ -\/1]\ ==\ c).sum()\ \ \textcolor{comment}{\#\ detections\ per\ class}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00787}00787\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ s\ +=\ f\textcolor{stringliteral}{"{}\{n\}\ \{self.names[int(c)]\}\{'s'\ *\ (n\ >\ 1)\},\ "{}}\ \ \textcolor{comment}{\#\ add\ to\ string}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00788}00788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ s\ =\ s.rstrip(\textcolor{stringliteral}{"{},\ "{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00789}00789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ show\ \textcolor{keywordflow}{or}\ save\ \textcolor{keywordflow}{or}\ render\ \textcolor{keywordflow}{or}\ crop:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00790}00790\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ annotator\ =\ Annotator(im,\ example=str(self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a2dda184aebfe28da2ebc08bfdb9e5ca1}{names}}))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00791}00791\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ *box,\ conf,\ cls\ \textcolor{keywordflow}{in}\ reversed(pred):\ \ \textcolor{comment}{\#\ xyxy,\ confidence,\ class}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00792}00792\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ label\ =\ f\textcolor{stringliteral}{"{}\{self.names[int(cls)]\}\ \{conf:.2f\}"{}}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00793}00793\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ crop:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00794}00794\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file\ =\ save\_dir\ /\ \textcolor{stringliteral}{"{}crops"{}}\ /\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a2dda184aebfe28da2ebc08bfdb9e5ca1}{names}}[int(cls)]\ /\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ad1954b98e196b97d1abc1584b3a02cc5}{files}}[i]\ \textcolor{keywordflow}{if}\ save\ \textcolor{keywordflow}{else}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00795}00795\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ crops.append(}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00796}00796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00797}00797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}box"{}}:\ box,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00798}00798\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}conf"{}}:\ conf,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00799}00799\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}cls"{}}:\ cls,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00800}00800\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}label"{}}:\ label,}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00801}00801\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}im"{}}:\ save\_one\_box(box,\ im,\ file=file,\ save=save),}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00802}00802\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00803}00803\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00804}00804\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:\ \ \textcolor{comment}{\#\ all\ others}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00805}00805\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ annotator.box\_label(box,\ label\ \textcolor{keywordflow}{if}\ labels\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{"{}"{}},\ color=colors(cls))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00806}00806\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ annotator.im}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00807}00807\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00808}00808\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ s\ +=\ \textcolor{stringliteral}{"{}(no\ detections)"{}}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00809}00809\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00810}00810\ \ \ \ \ \ \ \ \ \ \ \ \ im\ =\ Image.fromarray(im.astype(np.uint8))\ \textcolor{keywordflow}{if}\ isinstance(im,\ np.ndarray)\ \textcolor{keywordflow}{else}\ im\ \ \textcolor{comment}{\#\ from\ np}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00811}00811\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ show:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00812}00812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ is\_jupyter():}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00813}00813\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{from}\ IPython.display\ \textcolor{keyword}{import}\ display}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00814}00814\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00815}00815\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ display(im)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00816}00816\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00817}00817\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im.show(self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ad1954b98e196b97d1abc1584b3a02cc5}{files}}[i])}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00818}00818\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ save:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00819}00819\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\ =\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ad1954b98e196b97d1abc1584b3a02cc5}{files}}[i]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00820}00820\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im.save(save\_dir\ /\ f)\ \ \textcolor{comment}{\#\ save}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00821}00821\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ i\ ==\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ae3661db10a63e7b2684d7a3f228c1edf}{n}}\ -\/\ 1:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00822}00822\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Saved\ \{self.n\}\ image\{'s'\ *\ (self.n\ >\ 1)\}\ to\ \{colorstr('bold',\ save\_dir)\}"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00823}00823\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ render:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00824}00824\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a328d72d46f6125448104c390e6624038}{ims}}[i]\ =\ np.asarray(im)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00825}00825\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ pprint:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00826}00826\ \ \ \ \ \ \ \ \ \ \ \ \ s\ =\ s.lstrip(\textcolor{stringliteral}{"{}\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00827}00827\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ f\textcolor{stringliteral}{"{}\{s\}\(\backslash\)nSpeed:\ \%.1fms\ pre-\/process,\ \%.1fms\ inference,\ \%.1fms\ NMS\ per\ image\ at\ shape\ \{self.s\}"{}}\ \%\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a2cb25f61622692501fc0a2a51f125e02}{t}}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00828}00828\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ crop:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00829}00829\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ save:}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00830}00830\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}Saved\ results\ to\ \{save\_dir\}\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00831}00831\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ crops}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00832}00832\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00833}00833\ \ \ \ \ \textcolor{preprocessor}{@TryExcept("{}Showing\ images\ is\ not\ supported\ in\ this\ environment"{})}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00834}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a8884d741f2db7cf10afb8877531c2c68}{00834}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a8884d741f2db7cf10afb8877531c2c68}{show}}(self,\ labels=True):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00835}00835\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ab8d2b0d35180e2f4e8730ea9541c2fc7}{\_run}}(show=\textcolor{keyword}{True},\ labels=labels)\ \ \textcolor{comment}{\#\ show\ results}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00836}00836\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00837}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a2e79481231f155169c422abfc9f39d1a}{00837}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a2e79481231f155169c422abfc9f39d1a}{save}}(self,\ labels=True,\ save\_dir="{}runs/detect/exp"{},\ exist\_ok=False):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00838}00838\ \ \ \ \ \ \ \ \ save\_dir\ =\ increment\_path(save\_dir,\ exist\_ok,\ mkdir=\textcolor{keyword}{True})\ \ \textcolor{comment}{\#\ increment\ save\_dir}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00839}00839\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ab8d2b0d35180e2f4e8730ea9541c2fc7}{\_run}}(save=\textcolor{keyword}{True},\ labels=labels,\ save\_dir=save\_dir)\ \ \textcolor{comment}{\#\ save\ results}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00840}00840\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00841}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a32fe63190b5abc177e83c2ca076fdced}{00841}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a32fe63190b5abc177e83c2ca076fdced}{crop}}(self,\ save=True,\ save\_dir="{}runs/detect/exp"{},\ exist\_ok=False):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00842}00842\ \ \ \ \ \ \ \ \ save\_dir\ =\ increment\_path(save\_dir,\ exist\_ok,\ mkdir=\textcolor{keyword}{True})\ \textcolor{keywordflow}{if}\ save\ \textcolor{keywordflow}{else}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00843}00843\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ab8d2b0d35180e2f4e8730ea9541c2fc7}{\_run}}(crop=\textcolor{keyword}{True},\ save=save,\ save\_dir=save\_dir)\ \ \textcolor{comment}{\#\ crop\ results}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00844}00844\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00845}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a821629cd63a6f3b6714f05795ce09214}{00845}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a821629cd63a6f3b6714f05795ce09214}{render}}(self,\ labels=True):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00846}00846\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ab8d2b0d35180e2f4e8730ea9541c2fc7}{\_run}}(render=\textcolor{keyword}{True},\ labels=labels)\ \ \textcolor{comment}{\#\ render\ results}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00847}00847\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a328d72d46f6125448104c390e6624038}{ims}}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00848}00848\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00849}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a89a224a8212fa23658621b8dea1a64a4}{00849}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a89a224a8212fa23658621b8dea1a64a4}{pandas}}(self):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00850}00850\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ return\ detections\ as\ pandas\ DataFrames,\ i.e.\ print(results.pandas().xyxy[0])}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00851}00851\ \ \ \ \ \ \ \ \ new\ =\ copy(self)\ \ \textcolor{comment}{\#\ return\ copy}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00852}00852\ \ \ \ \ \ \ \ \ ca\ =\ \textcolor{stringliteral}{"{}xmin"{}},\ \textcolor{stringliteral}{"{}ymin"{}},\ \textcolor{stringliteral}{"{}xmax"{}},\ \textcolor{stringliteral}{"{}ymax"{}},\ \textcolor{stringliteral}{"{}confidence"{}},\ \textcolor{stringliteral}{"{}class"{}},\ \textcolor{stringliteral}{"{}name"{}}\ \ \textcolor{comment}{\#\ xyxy\ columns}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00853}00853\ \ \ \ \ \ \ \ \ cb\ =\ \textcolor{stringliteral}{"{}xcenter"{}},\ \textcolor{stringliteral}{"{}ycenter"{}},\ \textcolor{stringliteral}{"{}width"{}},\ \textcolor{stringliteral}{"{}height"{}},\ \textcolor{stringliteral}{"{}confidence"{}},\ \textcolor{stringliteral}{"{}class"{}},\ \textcolor{stringliteral}{"{}name"{}}\ \ \textcolor{comment}{\#\ xywh\ columns}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00854}00854\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ k,\ c\ \textcolor{keywordflow}{in}\ zip([\textcolor{stringliteral}{"{}xyxy"{}},\ \textcolor{stringliteral}{"{}xyxyn"{}},\ \textcolor{stringliteral}{"{}xywh"{}},\ \textcolor{stringliteral}{"{}xywhn"{}}],\ [ca,\ ca,\ cb,\ cb]):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00855}00855\ \ \ \ \ \ \ \ \ \ \ \ \ a\ =\ [[x[:5]\ +\ [int(x[5]),\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a2dda184aebfe28da2ebc08bfdb9e5ca1}{names}}[int(x[5])]]\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ x.tolist()]\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ getattr(self,\ k)]\ \ \textcolor{comment}{\#\ update}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00856}00856\ \ \ \ \ \ \ \ \ \ \ \ \ setattr(new,\ k,\ [pd.DataFrame(x,\ columns=c)\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ a])}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00857}00857\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ new}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00858}00858\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00859}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a61bb44c52a37ba54dd9f4bbfd751fb07}{00859}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a61bb44c52a37ba54dd9f4bbfd751fb07}{tolist}}(self):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00860}00860\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ return\ a\ list\ of\ Detections\ objects,\ i.e.\ 'for\ result\ in\ results.tolist():'}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00861}00861\ \ \ \ \ \ \ \ \ r\ =\ range(self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ae3661db10a63e7b2684d7a3f228c1edf}{n}})\ \ \textcolor{comment}{\#\ iterable}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00862}00862\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00863}00863\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classmodels_1_1common_1_1_detections}{Detections}}(}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00864}00864\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a328d72d46f6125448104c390e6624038}{ims}}[i]],}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00865}00865\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a53abcc899896b0d2c20b6f84cbe2c452}{pred}}[i]],}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00866}00866\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ad1954b98e196b97d1abc1584b3a02cc5}{files}}[i]],}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00867}00867\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ab4e09d9b38889ca7688f018d45bd9749}{times}},}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00868}00868\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a2dda184aebfe28da2ebc08bfdb9e5ca1}{names}},}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00869}00869\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ad030cbc7bc0c29869cf4f67ecf7257e8}{s}},}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00870}00870\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00871}00871\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ r}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00872}00872\ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00873}00873\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00874}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a48be44feb30c38a16cf310b850811045}{00874}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a48be44feb30c38a16cf310b850811045}{print}}(self):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00875}00875\ \ \ \ \ \ \ \ \ LOGGER.info(self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a7e1647c69c4df05f712dc606b14f2819}{\_\_str\_\_}}())}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00876}00876\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00877}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a57a79600d475d33d71ffd2a7464b9efa}{00877}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a57a79600d475d33d71ffd2a7464b9efa}{\_\_len\_\_}}(self):\ \ \textcolor{comment}{\#\ override\ len(results)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00878}00878\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ae3661db10a63e7b2684d7a3f228c1edf}{n}}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00879}00879\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00880}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a7e1647c69c4df05f712dc606b14f2819}{00880}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a7e1647c69c4df05f712dc606b14f2819}{\_\_str\_\_}}(self):\ \ \textcolor{comment}{\#\ override\ print(results)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00881}00881\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_ab8d2b0d35180e2f4e8730ea9541c2fc7}{\_run}}(pprint=\textcolor{keyword}{True})\ \ \textcolor{comment}{\#\ print\ results}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00882}00882\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00883}\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a1dbb0a8cd81f5fd73d521085ebb9d190}{00883}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a1dbb0a8cd81f5fd73d521085ebb9d190}{\_\_repr\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00884}00884\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ f\textcolor{stringliteral}{"{}YOLOv5\ \{self.\_\_class\_\_\}\ instance\(\backslash\)n"{}}\ +\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_detections_a7e1647c69c4df05f712dc606b14f2819}{\_\_str\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00885}00885\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00886}00886\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00887}\mbox{\hyperlink{classmodels_1_1common_1_1_proto}{00887}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_proto}{Proto}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00888}00888\ \ \ \ \ \textcolor{comment}{\#\ YOLOv5\ mask\ Proto\ module\ for\ segmentation\ models}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00889}\mbox{\hyperlink{classmodels_1_1common_1_1_proto_abbb3d71a30f02467048c98b403d1a24c}{00889}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_proto_abbb3d71a30f02467048c98b403d1a24c}{\_\_init\_\_}}(self,\ c1,\ c\_=256,\ c2=32):\ \ \textcolor{comment}{\#\ ch\_in,\ number\ of\ protos,\ number\ of\ masks}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00890}00890\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_proto_abbb3d71a30f02467048c98b403d1a24c}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00891}\mbox{\hyperlink{classmodels_1_1common_1_1_proto_ab6a542eef5eee3465627ba4506e22f41}{00891}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_proto_ab6a542eef5eee3465627ba4506e22f41}{cv1}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1,\ c\_,\ k=3)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00892}\mbox{\hyperlink{classmodels_1_1common_1_1_proto_a579a85525191d169afe3db9318135c4d}{00892}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_proto_a579a85525191d169afe3db9318135c4d}{upsample}}\ =\ nn.Upsample(scale\_factor=2,\ mode=\textcolor{stringliteral}{"{}nearest"{}})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00893}\mbox{\hyperlink{classmodels_1_1common_1_1_proto_a206019d0151cae1865908b0b46ce7a8a}{00893}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_proto_a206019d0151cae1865908b0b46ce7a8a}{cv2}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c\_,\ c\_,\ k=3)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00894}\mbox{\hyperlink{classmodels_1_1common_1_1_proto_a85bac2f85801e95f60becfe2210f0f21}{00894}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_proto_a85bac2f85801e95f60becfe2210f0f21}{cv3}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c\_,\ c2)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00895}00895\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00896}\mbox{\hyperlink{classmodels_1_1common_1_1_proto_a53ad18bcb0a5d0bd611c9fb6b3151d3f}{00896}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_proto_a53ad18bcb0a5d0bd611c9fb6b3151d3f}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00897}00897\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_proto_a85bac2f85801e95f60becfe2210f0f21}{cv3}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_proto_a206019d0151cae1865908b0b46ce7a8a}{cv2}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_proto_a579a85525191d169afe3db9318135c4d}{upsample}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_proto_ab6a542eef5eee3465627ba4506e22f41}{cv1}}(x))))}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00898}00898\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00899}00899\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00900}\mbox{\hyperlink{classmodels_1_1common_1_1_classify}{00900}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classmodels_1_1common_1_1_classify}{Classify}}(nn.Module):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00901}00901\ \ \ \ \ \textcolor{comment}{\#\ YOLOv5\ classification\ head,\ i.e.\ x(b,c1,20,20)\ to\ x(b,c2)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00902}\mbox{\hyperlink{classmodels_1_1common_1_1_classify_acc7e7f9511dcdcfc63b53415c3c86cf3}{00902}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_classify_acc7e7f9511dcdcfc63b53415c3c86cf3}{\_\_init\_\_}}(}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00903}00903\ \ \ \ \ \ \ \ \ self,\ c1,\ c2,\ k=1,\ s=1,\ p=None,\ g=1,\ dropout\_p=0.0}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00904}00904\ \ \ \ \ ):\ \ \textcolor{comment}{\#\ ch\_in,\ ch\_out,\ kernel,\ stride,\ padding,\ groups,\ dropout\ probability}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00905}00905\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{classmodels_1_1common_1_1_classify_acc7e7f9511dcdcfc63b53415c3c86cf3}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00906}00906\ \ \ \ \ \ \ \ \ c\_\ =\ 1280\ \ \textcolor{comment}{\#\ efficientnet\_b0\ size}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00907}\mbox{\hyperlink{classmodels_1_1common_1_1_classify_a38319cf51b76b66281fae0aeb9af7d4e}{00907}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_classify_a38319cf51b76b66281fae0aeb9af7d4e}{conv}}\ =\ \mbox{\hyperlink{classmodels_1_1common_1_1_conv}{Conv}}(c1,\ c\_,\ k,\ s,\ autopad(k,\ p),\ g)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00908}\mbox{\hyperlink{classmodels_1_1common_1_1_classify_ada2126a3f0e659e50db07b62b62e359b}{00908}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_classify_ada2126a3f0e659e50db07b62b62e359b}{pool}}\ =\ nn.AdaptiveAvgPool2d(1)\ \ \textcolor{comment}{\#\ to\ x(b,c\_,1,1)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00909}\mbox{\hyperlink{classmodels_1_1common_1_1_classify_afc61a8c56393da7dc8b46f23014e7bd7}{00909}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_classify_afc61a8c56393da7dc8b46f23014e7bd7}{drop}}\ =\ nn.Dropout(p=dropout\_p,\ inplace=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00910}\mbox{\hyperlink{classmodels_1_1common_1_1_classify_a1ed551131fb097af6aced7e9c90b8b2c}{00910}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classmodels_1_1common_1_1_classify_a1ed551131fb097af6aced7e9c90b8b2c}{linear}}\ =\ nn.Linear(c\_,\ c2)\ \ \textcolor{comment}{\#\ to\ x(b,c2)}}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00911}00911\ }
\DoxyCodeLine{\Hypertarget{common_8py_source_l00912}\mbox{\hyperlink{classmodels_1_1common_1_1_classify_aacee93995ee060a005257a7fce5add52}{00912}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classmodels_1_1common_1_1_classify_aacee93995ee060a005257a7fce5add52}{forward}}(self,\ x):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00913}00913\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ isinstance(x,\ list):}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00914}00914\ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ torch.cat(x,\ 1)}
\DoxyCodeLine{\Hypertarget{common_8py_source_l00915}00915\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{classmodels_1_1common_1_1_classify_a1ed551131fb097af6aced7e9c90b8b2c}{linear}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_classify_afc61a8c56393da7dc8b46f23014e7bd7}{drop}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_classify_ada2126a3f0e659e50db07b62b62e359b}{pool}}(self.\mbox{\hyperlink{classmodels_1_1common_1_1_classify_a38319cf51b76b66281fae0aeb9af7d4e}{conv}}(x)).flatten(1)))}

\end{DoxyCode}
