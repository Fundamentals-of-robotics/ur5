\doxysection{benchmarks.\+py}
\hypertarget{benchmarks_8py_source}{}\label{benchmarks_8py_source}\index{C:/Users/dorij/OneDrive/Desktop/ur5/vision/yolo/benchmarks.py@{C:/Users/dorij/OneDrive/Desktop/ur5/vision/yolo/benchmarks.py}}
\mbox{\hyperlink{benchmarks_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00001}\mbox{\hyperlink{namespacebenchmarks}{00001}}\ \textcolor{comment}{\#\ YOLOv5\ ðŸš€\ by\ Ultralytics,\ AGPL-\/3.0\ license}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00002}00002\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00003}00003\ \textcolor{stringliteral}{Run\ YOLOv5\ benchmarks\ on\ all\ supported\ export\ formats.}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00004}00004\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00005}00005\ \textcolor{stringliteral}{Format\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \`{}export.py\ -\/-\/include\`{}\ \ \ \ \ \ \ \ \ |\ Model}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00006}00006\ \textcolor{stringliteral}{-\/-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ -\/-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ -\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00007}00007\ \textcolor{stringliteral}{PyTorch\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ -\/\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ yolov5s.pt}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00008}00008\ \textcolor{stringliteral}{TorchScript\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \`{}torchscript\`{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ yolov5s.torchscript}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00009}00009\ \textcolor{stringliteral}{ONNX\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \`{}onnx\`{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ yolov5s.onnx}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00010}00010\ \textcolor{stringliteral}{OpenVINO\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \`{}openvino\`{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ yolov5s\_openvino\_model/}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00011}00011\ \textcolor{stringliteral}{TensorRT\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \`{}engine\`{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ yolov5s.engine}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00012}00012\ \textcolor{stringliteral}{CoreML\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \`{}coreml\`{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ yolov5s.mlmodel}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00013}00013\ \textcolor{stringliteral}{TensorFlow\ SavedModel\ \ \ \ \ \ \ |\ \`{}saved\_model\`{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ yolov5s\_saved\_model/}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00014}00014\ \textcolor{stringliteral}{TensorFlow\ GraphDef\ \ \ \ \ \ \ \ \ |\ \`{}pb\`{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ yolov5s.pb}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00015}00015\ \textcolor{stringliteral}{TensorFlow\ Lite\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \`{}tflite\`{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ yolov5s.tflite}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00016}00016\ \textcolor{stringliteral}{TensorFlow\ Edge\ TPU\ \ \ \ \ \ \ \ \ |\ \`{}edgetpu\`{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ yolov5s\_edgetpu.tflite}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00017}00017\ \textcolor{stringliteral}{TensorFlow.js\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \`{}tfjs\`{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ yolov5s\_web\_model/}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00018}00018\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00019}00019\ \textcolor{stringliteral}{Requirements:}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00020}00020\ \textcolor{stringliteral}{\ \ \ \ \$\ pip\ install\ -\/r\ requirements.txt\ coremltools\ onnx\ onnx-\/simplifier\ onnxruntime\ openvino-\/dev\ tensorflow-\/cpu\ \ \#\ CPU}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00021}00021\ \textcolor{stringliteral}{\ \ \ \ \$\ pip\ install\ -\/r\ requirements.txt\ coremltools\ onnx\ onnx-\/simplifier\ onnxruntime-\/gpu\ openvino-\/dev\ tensorflow\ \ \#\ GPU}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00022}00022\ \textcolor{stringliteral}{\ \ \ \ \$\ pip\ install\ -\/U\ nvidia-\/tensorrt\ -\/-\/index-\/url\ https://pypi.ngc.nvidia.com\ \ \#\ TensorRT}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00023}00023\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00024}00024\ \textcolor{stringliteral}{Usage:}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00025}00025\ \textcolor{stringliteral}{\ \ \ \ \$\ python\ benchmarks.py\ -\/-\/weights\ yolov5s.pt\ -\/-\/img\ 640}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00026}00026\ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00028}00028\ \textcolor{keyword}{import}\ argparse}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00029}00029\ \textcolor{keyword}{import}\ platform}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00030}00030\ \textcolor{keyword}{import}\ sys}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00031}00031\ \textcolor{keyword}{import}\ time}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00032}00032\ \textcolor{keyword}{from}\ pathlib\ \textcolor{keyword}{import}\ Path}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00033}00033\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00034}00034\ \textcolor{keyword}{import}\ pandas\ \textcolor{keyword}{as}\ pd}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00035}00035\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00036}\mbox{\hyperlink{namespacebenchmarks_aec626caa437b94fbcaa05390e9771510}{00036}}\ FILE\ =\ Path(\_\_file\_\_).resolve()}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00037}\mbox{\hyperlink{namespacebenchmarks_a783652233b34d5ee8aa4e4eb2304cbd6}{00037}}\ ROOT\ =\ FILE.parents[0]\ \ \textcolor{comment}{\#\ YOLOv5\ root\ directory}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00038}00038\ \textcolor{keywordflow}{if}\ str(ROOT)\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ sys.path:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00039}00039\ \ \ \ \ sys.path.append(str(ROOT))\ \ \textcolor{comment}{\#\ add\ ROOT\ to\ PATH}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00040}00040\ \textcolor{comment}{\#\ ROOT\ =\ ROOT.relative\_to(Path.cwd())\ \ \#\ relative}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00042}00042\ \textcolor{keyword}{import}\ export}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00043}00043\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacemodels_1_1experimental}{models.experimental}}\ \textcolor{keyword}{import}\ attempt\_load}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00044}00044\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacemodels_1_1yolo}{models.yolo}}\ \textcolor{keyword}{import}\ SegmentationModel}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00045}00045\ \textcolor{keyword}{from}\ segment.val\ \textcolor{keyword}{import}\ run\ \textcolor{keyword}{as}\ val\_seg}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00046}00046\ \textcolor{keyword}{from}\ utils\ \textcolor{keyword}{import}\ notebook\_init}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00047}00047\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceutils_1_1general}{utils.general}}\ \textcolor{keyword}{import}\ LOGGER,\ check\_yaml,\ file\_size,\ print\_args}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00048}00048\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceutils_1_1torch__utils}{utils.torch\_utils}}\ \textcolor{keyword}{import}\ select\_device}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00049}00049\ \textcolor{keyword}{from}\ val\ \textcolor{keyword}{import}\ run\ \textcolor{keyword}{as}\ val\_det}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00050}00050\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00051}00051\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00052}\mbox{\hyperlink{namespacebenchmarks_ade05a8dbc202c6aacb5761e8e4c5ea5e}{00052}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacebenchmarks_ade05a8dbc202c6aacb5761e8e4c5ea5e}{run}}(}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00053}00053\ \ \ \ \ weights=ROOT\ /\ "{}yolov5s.pt"{},\ \ \textcolor{comment}{\#\ weights\ path}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00054}00054\ \ \ \ \ imgsz=640,\ \ \textcolor{comment}{\#\ inference\ size\ (pixels)}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00055}00055\ \ \ \ \ batch\_size=1,\ \ \textcolor{comment}{\#\ batch\ size}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00056}00056\ \ \ \ \ data=ROOT\ /\ "{}data/coco128.yaml"{},\ \ \textcolor{comment}{\#\ dataset.yaml\ path}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00057}00057\ \ \ \ \ device="{}"{},\ \ \textcolor{comment}{\#\ cuda\ device,\ i.e.\ 0\ or\ 0,1,2,3\ or\ cpu}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00058}00058\ \ \ \ \ half=False,\ \ \textcolor{comment}{\#\ use\ FP16\ half-\/precision\ inference}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00059}00059\ \ \ \ \ test=False,\ \ \textcolor{comment}{\#\ test\ exports\ only}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00060}00060\ \ \ \ \ pt\_only=False,\ \ \textcolor{comment}{\#\ test\ PyTorch\ only}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00061}00061\ \ \ \ \ hard\_fail=False,\ \ \textcolor{comment}{\#\ throw\ error\ on\ benchmark\ failure}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00062}00062\ ):}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00063}00063\ \ \ \ \ y,\ t\ =\ [],\ time.time()}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00064}00064\ \ \ \ \ device\ =\ select\_device(device)}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00065}00065\ \ \ \ \ model\_type\ =\ type(attempt\_load(weights,\ fuse=\textcolor{keyword}{False}))\ \ \textcolor{comment}{\#\ DetectionModel,\ SegmentationModel,\ etc.}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00066}00066\ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ (name,\ f,\ suffix,\ cpu,\ gpu)\ \textcolor{keywordflow}{in}\ \mbox{\hyperlink{namespaceexport_a7b6acfbbcfc1f6745013f12b2b35d076}{export.export\_formats}}().iterrows():\ \ \textcolor{comment}{\#\ index,\ (name,\ file,\ suffix,\ CPU,\ GPU)}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00067}00067\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ i\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ (9,\ 10),\ \textcolor{stringliteral}{"{}inference\ not\ supported"{}}\ \ \textcolor{comment}{\#\ Edge\ TPU\ and\ TF.js\ are\ unsupported}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00069}00069\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ i\ !=\ 5\ \textcolor{keywordflow}{or}\ platform.system()\ ==\ \textcolor{stringliteral}{"{}Darwin"{}},\ \textcolor{stringliteral}{"{}inference\ only\ supported\ on\ macOS>=10.13"{}}\ \ \textcolor{comment}{\#\ CoreML}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}cpu"{}}\ \textcolor{keywordflow}{in}\ device.type:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ cpu,\ \textcolor{stringliteral}{"{}inference\ not\ supported\ on\ CPU"{}}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00072}00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}cuda"{}}\ \textcolor{keywordflow}{in}\ device.type:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ gpu,\ \textcolor{stringliteral}{"{}inference\ not\ supported\ on\ GPU"{}}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00074}00074\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Export}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ f\ ==\ \textcolor{stringliteral}{"{}-\/"{}}:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\ =\ weights\ \ \textcolor{comment}{\#\ PyTorch\ format}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ w\ =\ \mbox{\hyperlink{namespaceexport_a2198bfcdd3f9c6bd185a38ea5f0d9495}{export.run}}(}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ weights=weights,\ imgsz=[imgsz],\ include=[f],\ batch\_size=batch\_size,\ device=device,\ half=half}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )[-\/1]\ \ \textcolor{comment}{\#\ all\ others}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ suffix\ \textcolor{keywordflow}{in}\ str(w),\ \textcolor{stringliteral}{"{}export\ failed"{}}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00083}00083\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Validate}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ model\_type\ ==\ SegmentationModel:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ result\ =\ val\_seg(data,\ w,\ batch\_size,\ imgsz,\ plots=\textcolor{keyword}{False},\ device=device,\ task=\textcolor{stringliteral}{"{}speed"{}},\ half=half)}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ metric\ =\ result[0][7]\ \ \textcolor{comment}{\#\ (box(p,\ r,\ map50,\ map),\ mask(p,\ r,\ map50,\ map),\ *loss(box,\ obj,\ cls))}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:\ \ \textcolor{comment}{\#\ DetectionModel:}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ result\ =\ val\_det(data,\ w,\ batch\_size,\ imgsz,\ plots=\textcolor{keyword}{False},\ device=device,\ task=\textcolor{stringliteral}{"{}speed"{}},\ half=half)}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ metric\ =\ result[0][3]\ \ \textcolor{comment}{\#\ (p,\ r,\ map50,\ map,\ *loss(box,\ obj,\ cls))}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \ \ \ speed\ =\ result[2][1]\ \ \textcolor{comment}{\#\ times\ (preprocess,\ inference,\ postprocess)}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \ \ \ y.append([name,\ round(file\_size(w),\ 1),\ round(metric,\ 4),\ round(speed,\ 2)])\ \ \textcolor{comment}{\#\ MB,\ mAP,\ t\_inference}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00093}00093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ hard\_fail:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ type(e)\ \textcolor{keywordflow}{is}\ AssertionError,\ f\textcolor{stringliteral}{"{}Benchmark\ -\/-\/hard-\/fail\ for\ \{name\}:\ \{e\}"{}}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00096}00096\ \ \ \ \ \ \ \ \ \ \ \ \ LOGGER.warning(f\textcolor{stringliteral}{"{}WARNING\ âš ï¸\ Benchmark\ failure\ for\ \{name\}:\ \{e\}"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \ \ \ y.append([name,\ \textcolor{keywordtype}{None},\ \textcolor{keywordtype}{None},\ \textcolor{keywordtype}{None}])\ \ \textcolor{comment}{\#\ mAP,\ t\_inference}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00098}00098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ pt\_only\ \textcolor{keywordflow}{and}\ i\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break}\ \ \textcolor{comment}{\#\ break\ after\ PyTorch}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00100}00100\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00101}00101\ \ \ \ \ \textcolor{comment}{\#\ Print\ results}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00102}00102\ \ \ \ \ LOGGER.info(\textcolor{stringliteral}{"{}\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00103}00103\ \ \ \ \ \mbox{\hyperlink{namespacebenchmarks_a0d5f1198ff50977ed087410f1e961b21}{parse\_opt}}()}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00104}00104\ \ \ \ \ notebook\_init()\ \ \textcolor{comment}{\#\ print\ system\ info}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00105}00105\ \ \ \ \ c\ =\ [\textcolor{stringliteral}{"{}Format"{}},\ \textcolor{stringliteral}{"{}Size\ (MB)"{}},\ \textcolor{stringliteral}{"{}mAP50-\/95"{}},\ \textcolor{stringliteral}{"{}Inference\ time\ (ms)"{}}]\ \textcolor{keywordflow}{if}\ map\ \textcolor{keywordflow}{else}\ [\textcolor{stringliteral}{"{}Format"{}},\ \textcolor{stringliteral}{"{}Export"{}},\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{stringliteral}{"{}"{}}]}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00106}00106\ \ \ \ \ py\ =\ pd.DataFrame(y,\ columns=c)}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00107}00107\ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}\(\backslash\)nBenchmarks\ complete\ (\{time.time()\ -\/\ t:.2f\}s)"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00108}00108\ \ \ \ \ LOGGER.info(str(py\ \textcolor{keywordflow}{if}\ map\ \textcolor{keywordflow}{else}\ py.iloc[:,\ :2]))}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00109}00109\ \ \ \ \ \textcolor{keywordflow}{if}\ hard\_fail\ \textcolor{keywordflow}{and}\ isinstance(hard\_fail,\ str):}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00110}00110\ \ \ \ \ \ \ \ \ metrics\ =\ py[\textcolor{stringliteral}{"{}mAP50-\/95"{}}].array\ \ \textcolor{comment}{\#\ values\ to\ compare\ to\ floor}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00111}00111\ \ \ \ \ \ \ \ \ floor\ =\ eval(hard\_fail)\ \ \textcolor{comment}{\#\ minimum\ metric\ floor\ to\ pass,\ i.e.\ =\ 0.29\ mAP\ for\ YOLOv5n}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00112}00112\ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ all(x\ >\ floor\ \textcolor{keywordflow}{for}\ x\ \textcolor{keywordflow}{in}\ metrics\ \textcolor{keywordflow}{if}\ pd.notna(x)),\ f\textcolor{stringliteral}{"{}HARD\ FAIL:\ mAP50-\/95\ <\ floor\ \{floor\}"{}}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00113}00113\ \ \ \ \ \textcolor{keywordflow}{return}\ py}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00114}00114\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00115}00115\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00116}\mbox{\hyperlink{namespacebenchmarks_a64ada08bd2cbc822a6f715b7ee100cdf}{00116}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacebenchmarks_a64ada08bd2cbc822a6f715b7ee100cdf}{test}}(}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00117}00117\ \ \ \ \ weights=ROOT\ /\ "{}yolov5s.pt"{},\ \ \textcolor{comment}{\#\ weights\ path}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00118}00118\ \ \ \ \ imgsz=640,\ \ \textcolor{comment}{\#\ inference\ size\ (pixels)}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00119}00119\ \ \ \ \ batch\_size=1,\ \ \textcolor{comment}{\#\ batch\ size}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00120}00120\ \ \ \ \ data=ROOT\ /\ "{}data/coco128.yaml"{},\ \ \textcolor{comment}{\#\ dataset.yaml\ path}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00121}00121\ \ \ \ \ device="{}"{},\ \ \textcolor{comment}{\#\ cuda\ device,\ i.e.\ 0\ or\ 0,1,2,3\ or\ cpu}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00122}00122\ \ \ \ \ half=False,\ \ \textcolor{comment}{\#\ use\ FP16\ half-\/precision\ inference}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00123}00123\ \ \ \ \ test=False,\ \ \textcolor{comment}{\#\ test\ exports\ only}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00124}00124\ \ \ \ \ pt\_only=False,\ \ \textcolor{comment}{\#\ test\ PyTorch\ only}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00125}00125\ \ \ \ \ hard\_fail=False,\ \ \textcolor{comment}{\#\ throw\ error\ on\ benchmark\ failure}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00126}00126\ ):}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00127}00127\ \ \ \ \ y,\ t\ =\ [],\ time.time()}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00128}00128\ \ \ \ \ device\ =\ select\_device(device)}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00129}00129\ \ \ \ \ \textcolor{keywordflow}{for}\ i,\ (name,\ f,\ suffix,\ gpu)\ \textcolor{keywordflow}{in}\ \mbox{\hyperlink{namespaceexport_a7b6acfbbcfc1f6745013f12b2b35d076}{export.export\_formats}}().iterrows():\ \ \textcolor{comment}{\#\ index,\ (name,\ file,\ suffix,\ gpu-\/capable)}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00130}00130\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00131}00131\ \ \ \ \ \ \ \ \ \ \ \ \ w\ =\ (}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00132}00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ weights}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00133}00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ f\ ==\ \textcolor{stringliteral}{"{}-\/"{}}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00134}00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \mbox{\hyperlink{namespaceexport_a2198bfcdd3f9c6bd185a38ea5f0d9495}{export.run}}(weights=weights,\ imgsz=[imgsz],\ include=[f],\ device=device,\ half=half)[-\/1]}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00135}00135\ \ \ \ \ \ \ \ \ \ \ \ \ )\ \ \textcolor{comment}{\#\ weights}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00136}00136\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{assert}\ suffix\ \textcolor{keywordflow}{in}\ str(w),\ \textcolor{stringliteral}{"{}export\ failed"{}}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \ \ \ y.append([name,\ \textcolor{keyword}{True}])}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00139}00139\ \ \ \ \ \ \ \ \ \ \ \ \ y.append([name,\ \textcolor{keyword}{False}])\ \ \textcolor{comment}{\#\ mAP,\ t\_inference}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00140}00140\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00141}00141\ \ \ \ \ \textcolor{comment}{\#\ Print\ results}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00142}00142\ \ \ \ \ LOGGER.info(\textcolor{stringliteral}{"{}\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00143}00143\ \ \ \ \ \mbox{\hyperlink{namespacebenchmarks_a0d5f1198ff50977ed087410f1e961b21}{parse\_opt}}()}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00144}00144\ \ \ \ \ notebook\_init()\ \ \textcolor{comment}{\#\ print\ system\ info}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00145}00145\ \ \ \ \ py\ =\ pd.DataFrame(y,\ columns=[\textcolor{stringliteral}{"{}Format"{}},\ \textcolor{stringliteral}{"{}Export"{}}])}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00146}00146\ \ \ \ \ LOGGER.info(f\textcolor{stringliteral}{"{}\(\backslash\)nExports\ complete\ (\{time.time()\ -\/\ t:.2f\}s)"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00147}00147\ \ \ \ \ LOGGER.info(str(py))}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00148}00148\ \ \ \ \ \textcolor{keywordflow}{return}\ py}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00149}00149\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00150}00150\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00151}\mbox{\hyperlink{namespacebenchmarks_a0d5f1198ff50977ed087410f1e961b21}{00151}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacebenchmarks_a0d5f1198ff50977ed087410f1e961b21}{parse\_opt}}():}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00152}00152\ \ \ \ \ parser\ =\ argparse.ArgumentParser()}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00153}00153\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/weights"{}},\ type=str,\ default=ROOT\ /\ \textcolor{stringliteral}{"{}yolov5s.pt"{}},\ help=\textcolor{stringliteral}{"{}weights\ path"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00154}00154\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/imgsz"{}},\ \textcolor{stringliteral}{"{}-\/-\/img"{}},\ \textcolor{stringliteral}{"{}-\/-\/img-\/size"{}},\ type=int,\ default=640,\ help=\textcolor{stringliteral}{"{}inference\ size\ (pixels)"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00155}00155\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/batch-\/size"{}},\ type=int,\ default=1,\ help=\textcolor{stringliteral}{"{}batch\ size"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00156}00156\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/data"{}},\ type=str,\ default=ROOT\ /\ \textcolor{stringliteral}{"{}data/coco128.yaml"{}},\ help=\textcolor{stringliteral}{"{}dataset.yaml\ path"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00157}00157\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/device"{}},\ default=\textcolor{stringliteral}{"{}"{}},\ help=\textcolor{stringliteral}{"{}cuda\ device,\ i.e.\ 0\ or\ 0,1,2,3\ or\ cpu"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00158}00158\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/half"{}},\ action=\textcolor{stringliteral}{"{}store\_true"{}},\ help=\textcolor{stringliteral}{"{}use\ FP16\ half-\/precision\ inference"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00159}00159\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/test"{}},\ action=\textcolor{stringliteral}{"{}store\_true"{}},\ help=\textcolor{stringliteral}{"{}test\ exports\ only"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00160}00160\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/pt-\/only"{}},\ action=\textcolor{stringliteral}{"{}store\_true"{}},\ help=\textcolor{stringliteral}{"{}test\ PyTorch\ only"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00161}00161\ \ \ \ \ parser.add\_argument(\textcolor{stringliteral}{"{}-\/-\/hard-\/fail"{}},\ nargs=\textcolor{stringliteral}{"{}?"{}},\ const=\textcolor{keyword}{True},\ default=\textcolor{keyword}{False},\ help=\textcolor{stringliteral}{"{}Exception\ on\ error\ or\ <\ min\ metric"{}})}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00162}00162\ \ \ \ \ opt\ =\ parser.parse\_args()}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00163}00163\ \ \ \ \ opt.data\ =\ check\_yaml(opt.data)\ \ \textcolor{comment}{\#\ check\ YAML}}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00164}00164\ \ \ \ \ print\_args(vars(opt))}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00165}00165\ \ \ \ \ \textcolor{keywordflow}{return}\ opt}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00166}00166\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00167}00167\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00168}\mbox{\hyperlink{namespacebenchmarks_a88da04a12f0c6fa3141393e587ee79f7}{00168}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacebenchmarks_a88da04a12f0c6fa3141393e587ee79f7}{main}}(opt):}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00169}00169\ \ \ \ \ \mbox{\hyperlink{namespacebenchmarks_a64ada08bd2cbc822a6f715b7ee100cdf}{test}}(**vars(opt))\ \textcolor{keywordflow}{if}\ opt.test\ \textcolor{keywordflow}{else}\ run(**vars(opt))}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00170}00170\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00171}00171\ }
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00172}00172\ \textcolor{keywordflow}{if}\ \_\_name\_\_\ ==\ \textcolor{stringliteral}{"{}\_\_main\_\_"{}}:}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00173}\mbox{\hyperlink{namespacebenchmarks_a110ebb765dff3038f95f6c95bd7c63f7}{00173}}\ \ \ \ \ opt\ =\ \mbox{\hyperlink{namespacebenchmarks_a0d5f1198ff50977ed087410f1e961b21}{parse\_opt}}()}
\DoxyCodeLine{\Hypertarget{benchmarks_8py_source_l00174}00174\ \ \ \ \ \mbox{\hyperlink{namespacebenchmarks_a88da04a12f0c6fa3141393e587ee79f7}{main}}(opt)}

\end{DoxyCode}
